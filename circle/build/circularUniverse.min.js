/**
 * @module ND
 * @description N-dimensional graphics.
 *
 * @author [Andrej Hristoliubov]{@link https://anhr.github.io/AboutMe/}
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.ND={})}(this,function(N){"use strict";function M(e,t){var n=e.__state.conversionName.toString(),o=Math.round(e.r),i=Math.round(e.g),r=Math.round(e.b),a=e.a,s=Math.round(e.h),l=e.s.toFixed(1),c=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var u=e.hex.toString(16);u.length<6;)u="0"+u;return"#"+u}return"CSS_RGB"===n?"rgb("+o+","+i+","+r+")":"CSS_RGBA"===n?"rgba("+o+","+i+","+r+","+a+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+o+","+i+","+r+"]":"RGBA_ARRAY"===n?"["+o+","+i+","+r+","+a+"]":"RGB_OBJ"===n?"{r:"+o+",g:"+i+",b:"+r+"}":"RGBA_OBJ"===n?"{r:"+o+",g:"+i+",b:"+r+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+",a:"+a+"}":"unknown format"}var F,D=Array.prototype.forEach,V=Array.prototype.slice,f={BREAK:{},extend:function(n){return this.each(V.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(t[e])||(n[e]=t[e])}.bind(this))},this),n},defaults:function(n){return this.each(V.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(n[e])&&(n[e]=t[e])}.bind(this))},this),n},compose:function(){var n=V.call(arguments);return function(){for(var e=V.call(arguments),t=n.length-1;0<=t;t--)e=[n[t].apply(this,e)];return e[0]}},each:function(e,t,n){if(e)if(D&&e.forEach&&e.forEach===D)e.forEach(t,n);else if(e.length===e.length+0){for(var o=void 0,o=0,i=e.length;o<i;o++)if(o in e&&t.call(n,e[o],o)===this.BREAK)return}else for(var r in e)if(t.call(n,e[r],r)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(o,i,r){var a=void 0;return function(){var e=this,t=arguments;var n=r||!a;clearTimeout(a),a=setTimeout(function(){a=null,r||o.apply(e,t)},i),n&&o.apply(e,t)}},toArray:function(e){return e.toArray?e.toArray():V.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:(F=function(e){return isNaN(e)},I.toString=function(){return F.toString()},I),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}};function I(e){return F.apply(this,arguments)}function R(){G=!1;var n=1<arguments.length?f.toArray(arguments):arguments[0];return f.each(B,function(e){if(e.litmus(n))return f.each(e.conversions,function(e,t){if(H=e.read(n),!1===G&&!1!==H)return(G=H).conversionName=t,H.conversion=e,f.BREAK}),f.BREAK}),G}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var j,B=[{litmus:f.isString,conversions:{THREE_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:M},SIX_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:M},CSS_RGB:{read:function(e){e=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:M},CSS_RGBA:{read:function(e){e=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:M}}},{litmus:f.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:f.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:f.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(f.isNumber(e.r)&&f.isNumber(e.g)&&f.isNumber(e.b)&&f.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(f.isNumber(e.r)&&f.isNumber(e.g)&&f.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(f.isNumber(e.h)&&f.isNumber(e.s)&&f.isNumber(e.v)&&f.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(f.isNumber(e.h)&&f.isNumber(e.s)&&f.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],H=void 0,G=void 0,U={hsv_to_rgb:function(e,t,n){var o=Math.floor(e/60)%6,e=e/60-Math.floor(e/60),i=n*(1-t),r=n*(1-e*t),e=n*(1-(1-e)*t),t=[[n,e,i],[r,n,i],[i,n,e],[i,r,n],[e,i,n],[n,i,r]][o];return{r:255*t[0],g:255*t[1],b:255*t[2]}},rgb_to_hsv:function(e,t,n){var o=Math.min(e,t,n),i=Math.max(e,t,n),o=i-o,r=void 0;return 0===i?{h:NaN,s:0,v:0}:(r=e===i?(t-n)/o:t===i?2+(n-e)/o:4+(e-t)/o,(r/=6)<0&&(r+=1),{h:360*r,s:o/i,v:i/255})},rgb_to_hex:function(e,t,n){e=this.hex_with_component(0,2,e),e=this.hex_with_component(e,1,t);return this.hex_with_component(e,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,n){return n<<(j=8*t)|e&~(255<<j)}},X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e=function(e,t,n){return t&&q(e.prototype,t),n&&q(e,n),e};function q(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function i(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);return void 0!==o?"value"in o?o.value:void 0!==(o=o.get)?o.call(n):void 0:null!==(o=Object.getPrototypeOf(e))?i(o,t,n):void 0}function t(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function m(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}e(W,[{key:"toString",value:function(){return M(this)}},{key:"toHexString",value:function(){return M(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]);var h=W;function W(){if(p(this,W),this.__state=R.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}function Y(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"!==this.__state.space&&h.recalculateRGB(this,t,n),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(h.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function Z(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"!==this.__state.space&&h.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(h.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}h.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=U.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");f.extend(e.__state,U.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},h.recalculateHSV=function(e){var t=U.rgb_to_hsv(e.r,e.g,e.b);f.extend(e.__state,{s:t.s,v:t.v}),f.isNaN(t.h)?f.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},h.COMPONENTS=["r","g","b","h","s","v","hex","a"],Y(h.prototype,"r",2),Y(h.prototype,"g",1),Y(h.prototype,"b",0),Z(h.prototype,"h"),Z(h.prototype,"s"),Z(h.prototype,"v"),Object.defineProperty(h.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(h.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=U.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});e(K,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]);var J=K;function K(e,t){p(this,K),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}var Q={},$=(f.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){f.each(e,function(e){Q[e]=t})}),/(\d+(\.\d+)?)px/);function n(e){return"0"===e||f.isUndefined(e)||(e=e.match($),f.isNull(e))?0:parseFloat(e[1])}var g={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){f.isUndefined(t)&&(t=!0),f.isUndefined(n)&&(n=!0),e.style.position="absolute",t&&(e.style.left=0,e.style.right=0),n&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,o){var i=n||{},n=Q[t];if(!n)throw new Error("Event type "+t+" not supported.");var r=document.createEvent(n);switch(n){case"MouseEvents":var a=i.x||i.clientX||0,s=i.y||i.clientY||0;r.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,a,s,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":a=r.initKeyboardEvent||r.initKeyEvent;f.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),a(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:r.initEvent(t,i.bubbles||!1,i.cancelable||!0)}f.defaults(r,o),e.dispatchEvent(r)},bind:function(e,t,n,o){return e.addEventListener?e.addEventListener(t,n,{passive:o||!1}):e.attachEvent&&e.attachEvent("on"+t,n),g},unbind:function(e,t,n,o){return e.removeEventListener?e.removeEventListener(t,n,o||!1):e.detachEvent&&e.detachEvent("on"+t,n),g},addClass:function(e,t){var n;return void 0===e.className?e.className=t:e.className!==t&&-1===(n=e.className.split(/ +/)).indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,"")),g},removeClass:function(e,t){var n;return t?e.className===t?e.removeAttribute("class"):-1!==(t=(n=e.className.split(/ +/)).indexOf(t))&&(n.splice(t,1),e.className=n.join(" ")):e.className=void 0,g},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){e=getComputedStyle(e);return n(e["border-left-width"])+n(e["border-right-width"])+n(e["padding-left"])+n(e["padding-right"])+n(e.width)},getHeight:function(e){e=getComputedStyle(e);return n(e["border-top-width"])+n(e["border-bottom-width"])+n(e["padding-top"])+n(e["padding-bottom"])+n(e.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)for(;n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent;);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},ee=(t(o,J),e(o,[{key:"setValue",value:function(e){e=i(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),e}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),i(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"updateDisplay",this).call(this)}}]),o);function o(e,t){p(this,o);var e=m(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e,t)),n=e;return e.__prev=e.getValue(),e.__checkbox=document.createElement("input"),e.__checkbox.setAttribute("type","checkbox"),g.bind(e.__checkbox,"change",function(){n.setValue(!n.__prev)},!1),e.domElement.appendChild(e.__checkbox),e.updateDisplay(),e}t(r,J),e(r,[{key:"setValue",value:function(e){e=i(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),e}},{key:"updateDisplay",value:function(){return g.isActive(this.__select)?this:(this.__select.value=this.getValue(),i(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"updateDisplay",this).call(this))}}]);var te=r;function r(e,t,n){p(this,r);var o,e=m(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,t)),t=n,i=e;return e.__select=document.createElement("select"),f.isArray(t)&&(o={},f.each(t,function(e){o[e]=e}),t=o),f.each(t,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),i.__select.appendChild(n)}),e.updateDisplay(),g.bind(e.__select,"change",function(){var e=this.options[this.selectedIndex].value;i.setValue(e)}),e.domElement.appendChild(e.__select),e}t(oe,J),e(oe,[{key:"updateDisplay",value:function(){return g.isActive(this.__input)||(this.__input.value=this.getValue()),i(oe.prototype.__proto__||Object.getPrototypeOf(oe.prototype),"updateDisplay",this).call(this)}}]);var ne=oe;function oe(e,t){p(this,oe);var e=m(this,(oe.__proto__||Object.getPrototypeOf(oe)).call(this,e,t)),n=e;function o(){n.setValue(n.__input.value)}return e.__input=document.createElement("input"),e.__input.setAttribute("type","text"),g.bind(e.__input,"keyup",o),g.bind(e.__input,"change",o),g.bind(e.__input,"blur",function(){n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())}),g.bind(e.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),e.updateDisplay(),e.domElement.appendChild(e.__input),e}function ie(e){e=e.toString();return-1<e.indexOf(".")?e.length-e.indexOf(".")-1:0}t(re,J),e(re,[{key:"setValue",value:function(e){return void 0!==this.__min&&e<this.__min?e=this.__min:void 0!==this.__max&&e>this.__max&&(e=this.__max),void 0!==this.__step&&e%this.__step!=0&&(e=Math.round(e/this.__step)*this.__step),i(re.prototype.__proto__||Object.getPrototypeOf(re.prototype),"setValue",this).call(this,e)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=ie(e),this}}]);var a=re;function re(e,t,n){p(this,re);e=m(this,(re.__proto__||Object.getPrototypeOf(re)).call(this,e,t)),t=n||{};return e.__min=t.min,e.__max=t.max,e.__step=t.step,f.isUndefined(e.__step)?0===e.initialValue?e.__impliedStep=1:e.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(e.initialValue))/Math.LN10))/10:e.__impliedStep=e.__step,e.__precision=ie(e.__impliedStep),e}t(se,a),e(se,[{key:"updateDisplay",value:function(){var e,t;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),t=this.__precision,t=Math.pow(10,t),Math.round(e*t)/t),i(se.prototype.__proto__||Object.getPrototypeOf(se.prototype),"updateDisplay",this).call(this)}}]);var ae=se;function se(e,t,n){p(this,se);var e=m(this,(se.__proto__||Object.getPrototypeOf(se)).call(this,e,t,n)),o=(e.__truncationSuspended=!1,e),i=void 0;function r(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function a(e){var t=i-e.clientY;o.setValue(o.getValue()+t*o.__impliedStep),i=e.clientY}function s(){g.unbind(window,"mousemove",a),g.unbind(window,"mouseup",s),r()}return e.__input=document.createElement("input"),e.__input.setAttribute("type","text"),g.bind(e.__input,"change",function(){var e=parseFloat(o.__input.value);f.isNaN(e)||o.setValue(e)}),g.bind(e.__input,"blur",function(){r()}),g.bind(e.__input,"mousedown",function(e){g.bind(window,"mousemove",a),g.bind(window,"mouseup",s),i=e.clientY}),g.bind(e.__input,"keydown",function(e){13===e.keyCode&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,r())}),e.updateDisplay(),e.domElement.appendChild(e.__input),e}function le(e,t,n,o,i){return o+(e-t)/(n-t)*(i-o)}t(ue,a),e(ue,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",i(ue.prototype.__proto__||Object.getPrototypeOf(ue.prototype),"updateDisplay",this).call(this)}}]);var ce=ue;function ue(e,t,n,o,i,r){p(this,ue);var e=m(this,(ue.__proto__||Object.getPrototypeOf(ue)).call(this,e,t,{min:n,max:o,step:i})),a=e;function s(e){a.newBool||e.preventDefault();var t=a.__background.getBoundingClientRect();return a.setValue(le(e.clientX,t.left,t.right,a.__min,a.__max)),!1}function l(){g.unbind(window,"mousemove",s),g.unbind(window,"mouseup",l),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function c(e){var e=e.touches[0].clientX,t=a.__background.getBoundingClientRect();a.setValue(le(e,t.left,t.right,a.__min,a.__max))}function u(){g.unbind(window,"touchmove",c),g.unbind(window,"touchend",u),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}return e.__background=document.createElement("div"),e.__foreground=document.createElement("div"),e.newBool=r,g.bind(e.__background,"mousedown",function(e){document.activeElement.blur(),g.bind(window,"mousemove",s),g.bind(window,"mouseup",l),s(e)},r),g.bind(e.__background,"touchstart",function(e){1===e.touches.length&&(g.bind(window,"touchmove",c),g.bind(window,"touchend",u),c(e))}),g.addClass(e.__background,"slider"),g.addClass(e.__foreground,"slider-fg"),e.updateDisplay(),e.__background.appendChild(e.__foreground),e.domElement.appendChild(e.__background),e}t(pe,J),e(pe,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]);var de=pe;function pe(e,t,n){p(this,pe);var e=m(this,(pe.__proto__||Object.getPrototypeOf(pe)).call(this,e,t)),o=e;return e.__button=document.createElement("div"),e.__button.innerHTML=void 0===n?"Fire":n,g.bind(e.__button,"click",function(e){return e.preventDefault(),o.fire(),!1}),g.addClass(e.__button,"button"),e.domElement.appendChild(e.__button),e}t(ye,J),e(ye,[{key:"updateDisplay",value:function(){var t,n=R(this.getValue()),e=(!1!==n&&(t=!1,f.each(h.COMPONENTS,function(e){if(!f.isUndefined(n[e])&&!f.isUndefined(this.__color.__state[e])&&n[e]!==this.__color.__state[e])return t=!0,{}},this),t)&&f.extend(this.__color.__state,n),f.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1,this.__color.v<.5||.5<this.__color.s?255:0),o=255-e;f.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+e+","+e+","+e+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,be(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),f.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+e+","+e+","+e+")",textShadow:this.__input_textShadow+"rgba("+o+","+o+","+o+",.7)"})}}]);var fe=ye;function ye(e,t){p(this,ye);var n,e=m(this,(ye.__proto__||Object.getPrototypeOf(ye)).call(this,e,t)),o=(e.__color=new h(e.getValue()),e.__temp=new h(0),e),t=(e.domElement=document.createElement("div"),g.makeSelectable(e.domElement,!1),e.__selector=document.createElement("div"),e.__selector.className="selector",e.__saturation_field=document.createElement("div"),e.__saturation_field.className="saturation-field",e.__field_knob=document.createElement("div"),e.__field_knob.className="field-knob",e.__field_knob_border="2px solid ",e.__hue_knob=document.createElement("div"),e.__hue_knob.className="hue-knob",e.__hue_field=document.createElement("div"),e.__hue_field.className="hue-field",e.__input=document.createElement("input"),e.__input.type="text",e.__input_textShadow="0 1px 1px ",g.bind(e.__input,"keydown",function(e){13===e.keyCode&&l.call(this)}),g.bind(e.__input,"blur",l),g.bind(e.__selector,"mousedown",function(){g.addClass(this,"drag").bind(window,"mouseup",function(){g.removeClass(o.__selector,"drag")})}),g.bind(e.__selector,"touchstart",function(){g.addClass(this,"drag").bind(window,"touchend",function(){g.removeClass(o.__selector,"drag")})}),document.createElement("div"));function i(e){u(e),g.bind(window,"mousemove",u),g.bind(window,"touchmove",u),g.bind(window,"mouseup",a),g.bind(window,"touchend",a)}function r(e){d(e),g.bind(window,"mousemove",d),g.bind(window,"touchmove",d),g.bind(window,"mouseup",s),g.bind(window,"touchend",s)}function a(){g.unbind(window,"mousemove",u),g.unbind(window,"touchmove",u),g.unbind(window,"mouseup",a),g.unbind(window,"touchend",a),c()}function s(){g.unbind(window,"mousemove",d),g.unbind(window,"touchmove",d),g.unbind(window,"mouseup",s),g.unbind(window,"touchend",s),c()}function l(){var e=R(this.value);!1!==e?(o.__color.__state=e,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function c(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}function u(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__saturation_field.getBoundingClientRect(),e=e.touches&&e.touches[0]||e,n=e.clientX,e=e.clientY,n=(n-t.left)/(t.right-t.left),e=1-(e-t.top)/(t.bottom-t.top);return 1<e?e=1:e<0&&(e=0),1<n?n=1:n<0&&(n=0),o.__color.v=e,o.__color.s=n,o.setValue(o.__color.toOriginal()),!1}function d(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__hue_field.getBoundingClientRect(),e=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return 1<e?e=1:e<0&&(e=0),o.__color.h=360*e,o.setValue(o.__color.toOriginal()),!1}return f.extend(e.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),f.extend(e.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:e.__field_knob_border+(e.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),f.extend(e.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),f.extend(e.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),f.extend(t.style,{width:"100%",height:"100%",background:"none"}),be(t,"top","rgba(0,0,0,0)","#000"),f.extend(e.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(n=e.__hue_field).style.background="",n.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",n.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",f.extend(e.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:e.__input_textShadow+"rgba(0,0,0,0.7)"}),g.bind(e.__saturation_field,"mousedown",i),g.bind(e.__saturation_field,"touchstart",i),g.bind(e.__field_knob,"mousedown",i),g.bind(e.__field_knob,"touchstart",i),g.bind(e.__hue_field,"mousedown",r),g.bind(e.__hue_field,"touchstart",r),e.__saturation_field.appendChild(t),e.__selector.appendChild(e.__field_knob),e.__selector.appendChild(e.__saturation_field),e.__selector.appendChild(e.__hue_field),e.__hue_field.appendChild(e.__hue_knob),e.domElement.appendChild(e.__input),e.domElement.appendChild(e.__selector),e.updateDisplay(),e}var ve=["-moz-","-o-","-webkit-","-ms-",""];function be(t,n,o,i){t.style.background="",f.each(ve,function(e){t.style.cssText+="background: "+e+"linear-gradient("+n+", "+o+" 0%, "+i+" 100%); "})}function _e(e,t){var n=e[t];return f.isArray(arguments[2])||f.isObject(arguments[2])?new te(e,t,arguments[2]):f.isNumber(n)?f.isNumber(arguments[2])&&f.isNumber(arguments[3])?f.isNumber(arguments[4])?new ce(e,t,arguments[2],arguments[3],arguments[4],arguments[5]):new ce(e,t,arguments[2],arguments[3]):f.isNumber(arguments[4])?new ae(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new ae(e,t,{min:arguments[2],max:arguments[3]}):f.isString(n)?new ne(e,t):f.isFunction(n)?new de(e,t,""):f.isBoolean(n)?new ee(e,t):null}t(xe,J),e(xe,[{key:"controller",set:function(e){this._controller=e},get:function(){return this._controller}}]);a=xe;function xe(e,t){p(this,xe);var n=m(this,(xe.__proto__||Object.getPrototypeOf(xe)).call(this,e,t));return n.arguments={object:e,property:t,opts:Array.prototype.slice.call(arguments,2)},e.property&&(n.property=e.property(n)),n}var we=function(e,t){var t=t||document,n=document.createElement("style"),e=(n.type="text/css",n.innerHTML=e,t.getElementsByTagName("head")[0]);try{e.appendChild(n)}catch(e){}};var Se=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},Te=(e(Ee,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),f.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var e,t=this;g.bind(this.domElement,"webkitTransitionEnd",e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",g.unbind(t.domElement,"webkitTransitionEnd",e),g.unbind(t.domElement,"transitionend",e),g.unbind(t.domElement,"oTransitionEnd",e)}),g.bind(this.domElement,"transitionend",e),g.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-g.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-g.getHeight(this.domElement)/2+"px"}}]),Ee);function Ee(){p(this,Ee),this.backgroundElement=document.createElement("div"),f.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),g.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),f.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;g.bind(this.backgroundElement,"click",function(){e.hide()})}we(function(e){var t;if(e&&"undefined"!=typeof window)return(t=document.createElement("style")).setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var Ce="Default",Ae=function(){try{return!!window.localStorage}catch(e){return!1}}(),Pe=void 0,Oe=!0,ke=void 0,ze=!1,Le=[],y=function t(e){var n,o,i,r=this,a=e||{},s=(this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),g.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],a=f.defaults(a,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),a=f.defaults(a,{resizable:a.autoPlace,hideable:a.autoPlace}),f.isUndefined(a.load)?a.load={preset:Ce}:a.preset&&(a.load.preset=a.preset),f.isUndefined(a.parent)&&a.hideable&&Le.push(this),a.resizable=f.isUndefined(a.parent)&&a.resizable,a.autoPlace&&f.isUndefined(a.scrollable)&&(a.scrollable=!0),Ae&&"true"===localStorage.getItem(Ie(0,"isLocal"))),l=void 0,c=void 0;function u(e){return e.preventDefault(),n.width+=o-e.clientX,n.onResize(),o=e.clientX,!1}function d(){g.removeClass(n.__closeButton,y.CLASS_DRAG),g.unbind(window,"mousemove",u),g.unbind(window,"mouseup",d)}function p(e){return e.preventDefault(),o=e.clientX,g.addClass(n.__closeButton,y.CLASS_DRAG),g.bind(window,"mousemove",u),g.bind(window,"mouseup",d),!1}Object.defineProperties(this,{parent:{get:function(){return a.parent}},scrollable:{get:function(){return a.scrollable}},autoPlace:{get:function(){return a.autoPlace}},closeOnTop:{get:function(){return a.closeOnTop}},preset:{get:function(){return(r.parent?r.getRoot():a.load).preset},set:function(e){r.parent?r.getRoot().preset=e:a.load.preset=e;for(var t=this,n=0;n<t.__preset_select.length;n++)t.__preset_select[n].value===t.preset&&(t.__preset_select.selectedIndex=n);r.revert()}},width:{get:function(){return a.width},set:function(e){a.width=e,Be(r,e)}},name:{get:function(){return a.name},set:function(e){a.name=e,c&&(c.innerHTML=a.name)}},closed:{get:function(){return a.closed},set:function(e){a.closed=e,a.closed?g.addClass(r.__ul,t.CLASS_CLOSED):g.removeClass(r.__ul,t.CLASS_CLOSED),this.onResize(),r.__closeButton&&(r.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return a.load}},useLocalStorage:{get:function(){return s},set:function(e){Ae&&((s=e)?g.bind(window,"unload",l):g.unbind(window,"unload",l),localStorage.setItem(Ie(0,"isLocal"),e))}}}),f.isUndefined(a.parent)?(this.closed=a.closed||!1,g.addClass(this.domElement,t.CLASS_MAIN),g.makeSelectable(this.domElement,!1),Ae&&s&&(r.useLocalStorage=!0,e=localStorage.getItem(Ie(0,"gui")))&&(a.load=JSON.parse(e)),this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,g.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),a.closeOnTop?(g.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(g.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),g.bind(this.__closeButton,"click",function(){r.closed=!r.closed})):(void 0===a.closed&&(a.closed=!0),e=document.createTextNode(a.name),g.addClass(e,"controller-name"),c=Ne(r,e),g.addClass(this.__ul,t.CLASS_CLOSED),g.addClass(c,"title"),g.bind(c,"click",function(e){return e.preventDefault(),r.closed=!r.closed,!1}),a.closed||(this.closed=!1)),a.autoPlace&&(f.isUndefined(a.parent)&&(Oe&&(ke=document.createElement("div"),g.addClass(ke,"dg"),g.addClass(ke,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(ke),Oe=!1),ke.appendChild(this.domElement),g.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||Be(r,a.width)),this.__resizeHandler=function(){r.onResizeDebounced()},g.bind(window,"resize",this.__resizeHandler),g.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),g.bind(this.__ul,"transitionend",this.__resizeHandler),g.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),a.resizable&&(o=void 0,(n=this).__resize_handle=document.createElement("div"),f.extend(n.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),g.bind(n.__resize_handle,"mousedown",p),g.bind(n.__closeButton,"mousedown",p),n.domElement.insertBefore(n.__resize_handle,n.domElement.firstElementChild)),l=function(){Ae&&"true"===localStorage.getItem(Ie(0,"isLocal"))&&localStorage.setItem(Ie(0,"gui"),JSON.stringify(r.getSaveObject()))},this.saveToLocalStorageIfPossible=l,a.parent||((i=r.getRoot()).width+=1,f.defer(function(){--i.width}))};function Ne(e,t,n){var o=document.createElement("li");return t&&o.appendChild(t),n?e.__ul.insertBefore(o,n):e.__ul.appendChild(o),e.onResize(),o}function Me(e){g.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&g.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function Fe(e,t){e=e.__preset_select[e.__preset_select.selectedIndex];e.innerHTML=t?e.value+"*":e.value}function De(e,t){var n=e.getRoot(),o=n.__rememberedObjects.indexOf(t.object);if(-1!==o){var i=n.__rememberedObjectIndecesToControllers[o];if(void 0===i&&(n.__rememberedObjectIndecesToControllers[o]=i={}),i[t.property]=t,n.load&&n.load.remembered){i=n.load.remembered,n=void 0;if(i[e.preset])n=i[e.preset];else{if(!i[Ce])return;n=i[Ce]}n[o]&&void 0!==n[o][t.property]&&(e=n[o][t.property],t.initialValue=e,t.setValue(e))}}}function Ve(e,t,n,o){var i;if(t.arguments&&(t=(i=t).arguments.object,n=i.arguments.property,o={factoryArgs:i.arguments.opts}),void 0===i&&void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var r=void 0,a=(null===(r=o.color?new fe(t,n):void 0!==i&&"string"==typeof i.property?i:(t=[t,n].concat(o.factoryArgs),_e.apply(e,t)))?r=i:void 0!==i&&(i.controller=r),o.before instanceof J&&(o.before=o.before.__li),De(e,r),g.addClass(r.domElement,"c"),document.createElement("span"));if(g.addClass(a,"property-name"),void 0!==i&&"object"===X(i.property))for(var s in i.property)a.appendChild(i.property[s]);else a.innerHTML=r.property;var l,c,u,d,n=document.createElement("div"),t=(n.appendChild(a),n.appendChild(r.domElement),Ne(e,n,o.before));return g.addClass(t,y.CLASS_CONTROLLER_ROW),r instanceof fe?g.addClass(t,"color"):g.addClass(t,X(r.getValue())),l=e,c=t,(u=r).__li=c,u.__gui=l,f.extend(u,{options:function(e){var t;return 1<arguments.length?(t=u.__li.nextElementSibling,u.remove(),Ve(l,u.object,u.property,{before:t,factoryArgs:[f.toArray(arguments)]})):f.isArray(e)||f.isObject(e)?(t=u.__li.nextElementSibling,u.remove(),Ve(l,u.object,u.property,{before:t,factoryArgs:[e]})):void 0},name:function(e){return u.__li.firstElementChild.firstElementChild.innerHTML=e,u},listen:function(){return u.__gui.listen(u),u},remove:function(){return u.__gui.remove(u),u}}),u instanceof ce?(d=new ae(u.object,u.property,{min:u.__min,max:u.__max,step:u.__step}),f.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(e){var t=u[e],n=d[e];u[e]=d[e]=function(){var e=Array.prototype.slice.call(arguments);return n.apply(d,e),t.apply(u,e)}}),g.addClass(c,"has-slider"),u.domElement.insertBefore(d.domElement,u.domElement.firstElementChild)):u instanceof ae?(u.min=f.compose(n=function(e){var t,n,o;return f.isNumber(u.__min)&&f.isNumber(u.__max)?(t=u.__li.firstElementChild.firstElementChild.innerHTML,n=-1<u.__gui.__listening.indexOf(u),u.remove(),(o=Ve(l,u.object,u.property,{before:u.__li.nextElementSibling,factoryArgs:[u.__min,u.__max,u.__step]})).name(t),n&&o.listen(),o):e},u.min),u.max=f.compose(n,u.max)):u instanceof ee?(g.bind(c,"click",function(){g.fakeEvent(u.__checkbox,"click")}),g.bind(u.__checkbox,"click",function(e){e.stopPropagation()})):u instanceof de?(g.bind(c,"click",function(){g.fakeEvent(u.__button,"click")}),g.bind(c,"mouseover",function(){g.addClass(u.__button,"hover")}),g.bind(c,"mouseout",function(){g.removeClass(u.__button,"hover")})):u instanceof fe&&(g.addClass(c,"color"),u.updateDisplay=f.compose(function(e){return c.style.borderLeftColor=u.__color.toString(),e},u.updateDisplay),u.updateDisplay()),u.setValue=f.compose(function(e){return l.getRoot().__preset_select&&u.isModified()&&Fe(l.getRoot(),!0),e},u.setValue),e.__controllers.push(r),r}function Ie(e,t){return document.location.href+"."+t}function Re(e,t,n){var o=document.createElement("option");o.innerHTML=t,o.value=t,e.__preset_select.appendChild(o),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function je(e,t){t.style.display=e.useLocalStorage?"block":"none"}function Be(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function He(i,r){var a={};return f.each(i.__rememberedObjects,function(e,t){var n={},o=i.__rememberedObjectIndecesToControllers[t];f.each(o,function(e,t){n[t]=r?e.initialValue:e.getValue()}),a[t]=n}),a}y.toggleHide=function(){ze=!ze,f.each(Le,function(e){e.domElement.style.display=ze?"none":""})},y.CLASS_AUTO_PLACE="a",y.CLASS_AUTO_PLACE_CONTAINER="ac",y.CLASS_MAIN="main",y.CLASS_CONTROLLER_ROW="cr",y.CLASS_TOO_TALL="taller-than-window",y.CLASS_CLOSED="closed",y.CLASS_CLOSE_BUTTON="close-button",y.CLASS_CLOSE_TOP="close-top",y.CLASS_CLOSE_BOTTOM="close-bottom",y.CLASS_DRAG="drag",y.DEFAULT_WIDTH=245,y.TEXT_CLOSED="Close Controls",y.TEXT_OPEN="Open Controls",y._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||y.toggleHide()},g.bind(window,"keydown",y._keydownHandler,!1),f.extend(y.prototype,{add:function(e,t){return Ve(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return Ve(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;f.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&ke.removeChild(this.domElement);var t=this;f.each(this.__folders,function(e){t.removeFolder(e)}),g.unbind(window,"keydown",y._keydownHandler,!1),Me(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this},t=(t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]),new y(t)),e=(this.__folders[e]=t,Ne(this,t.domElement));return g.addClass(e,"folder"),t},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],Me(t);var e=this;f.each(t.__folders,function(e){t.removeFolder(e)}),f.defer(function(){e.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e,t,n=this.getRoot();n.scrollable&&(e=g.getOffset(n.__ul).top,t=0,f.each(n.__ul.childNodes,function(e){n.autoPlace&&e===n.__save_row||(t+=g.getHeight(e))}),window.innerHeight-e-20<t?(g.addClass(n.domElement,y.CLASS_TOO_TALL),n.__ul.style.height=window.innerHeight-e-20+"px"):(g.removeClass(n.domElement,y.CLASS_TOO_TALL),n.__ul.style.height="auto")),n.__resize_handle&&f.defer(function(){n.__resize_handle.style.height=n.__ul.offsetHeight+"px"}),n.__closeButton&&(n.__closeButton.style.width=n.width+"px")},onResizeDebounced:f.debounce(function(){this.onResize()},50),remember:function(){if(f.isUndefined(Pe)&&((Pe=new Te).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var u=this;f.each(Array.prototype.slice.call(arguments),function(e){var n,t,o,i,r,a,s,l,c;0===u.__rememberedObjects.length&&(t=(n=u).__save_row=document.createElement("li"),g.addClass(n.domElement,"has-save"),n.__ul.insertBefore(t,n.__ul.firstChild),g.addClass(t,"save-row"),(o=document.createElement("span")).innerHTML="&nbsp;",g.addClass(o,"button gears"),(i=document.createElement("span")).innerHTML="Save",g.addClass(i,"button"),g.addClass(i,"save"),(r=document.createElement("span")).innerHTML="New",g.addClass(r,"button"),g.addClass(r,"save-as"),(a=document.createElement("span")).innerHTML="Revert",g.addClass(a,"button"),g.addClass(a,"revert"),s=n.__preset_select=document.createElement("select"),n.load&&n.load.remembered?f.each(n.load.remembered,function(e,t){Re(n,t,t===n.preset)}):Re(n,Ce,!1),g.bind(s,"change",function(){for(var e=0;e<n.__preset_select.length;e++)n.__preset_select[e].innerHTML=n.__preset_select[e].value;n.preset=this.value}),t.appendChild(s),t.appendChild(o),t.appendChild(i),t.appendChild(r),t.appendChild(a),Ae&&(l=document.getElementById("dg-local-explain"),s=document.getElementById("dg-local-storage"),document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(Ie(0,"isLocal"))&&s.setAttribute("checked","checked"),je(n,l),g.bind(s,"change",function(){n.useLocalStorage=!n.useLocalStorage,je(n,l)})),c=document.getElementById("dg-new-constructor"),g.bind(c,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||Pe.hide()}),g.bind(o,"click",function(){c.innerHTML=JSON.stringify(n.getSaveObject(),void 0,2),Pe.show(),c.focus(),c.select()}),g.bind(i,"click",function(){n.save()}),g.bind(r,"click",function(){var e=prompt("Enter a new preset name.");e&&n.saveAs(e)}),g.bind(a,"click",function(){n.revert()})),-1===u.__rememberedObjects.indexOf(e)&&u.__rememberedObjects.push(e)}),this.autoPlace&&Be(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var n=this.load;return n.closed=this.closed,0<this.__rememberedObjects.length&&(n.preset=this.preset,n.remembered||(n.remembered={}),n.remembered[this.preset]=He(this)),n.folders={},f.each(this.__folders,function(e,t){n.folders[t]=e.getSaveObject()}),n},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=He(this),Fe(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[Ce]=He(this,!0)),this.load.remembered[e]=He(this),this.preset=e,Re(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(t){f.each(this.__controllers,function(e){this.getRoot().load.remembered?De(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())},this),f.each(this.__folders,function(e){e.revert(e)}),t||Fe(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&function e(t){0!==t.length&&Se.call(window,function(){e(t)});f.each(t,function(e){e.updateDisplay()})}(this.__listening)},updateDisplay:function(){f.each(this.__controllers,function(e){e.updateDisplay()}),f.each(this.__folders,function(e){e.updateDisplay()})}});var Ge,Ue,Xe,E,e=a,we=y,qe=function(e,t){t=t||{};var n=document.createElement("span");function o(e){e=(e=e||window.event).deltaY||e.detail||e.wheelDelta;t.onwheel(e)}return n.innerHTML=e,void 0!==t.title&&(n.title=t.title),void 0!==t.onclick&&(n.style.cursor="pointer",n.onclick=t.onclick),void 0!==t.onwheel&&(n.style.cursor="n-resize",n.addEventListener?"onwheel"in document?n.addEventListener("wheel",o,{passive:!0}):"onmousewheel"in document?n.addEventListener("mousewheel",o):n.addEventListener("MozMousePixelScroll",o):n.attachEvent("onmousewheel",o)),n.style.margin="0px 2px",n};class We{constructor(){}set THREE(t){if(Ge)Object.is(t,Ge)||console.error("three: duplicate THREE. Please use one instance of the THREE library.");else{Xe=this;const s=(Ge=t).Float32BufferAttribute,a=t.Line3,l=t.Plane,c=t.Triangle,Y=t.Vector3,Z=(this.ConvexHull=(new n).ConvexHull,E.THREE.Vector2),i=E.THREE.Box3,L=E.THREE.BufferAttribute,o=E.THREE.Uint16BufferAttribute,r=E.THREE.Uint32BufferAttribute,u=E.THREE.Sphere,d=E.THREE.Object3D,p=E.THREE.Matrix4,f=E.THREE.Matrix3,m=E.THREE.arrayMax,h=E.THREE.MathUtils;class g{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){var n;return void 0!==this._listeners&&void 0!==(n=this._listeners)[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){var n;void 0!==this._listeners&&void 0!==(e=this._listeners[e])&&-1!==(n=e.indexOf(t))&&e.splice(n,1)}dispatchEvent(n){if(void 0!==this._listeners){var e=this._listeners[n.type];if(void 0!==e){n.target=this;var o=e.slice(0);for(let e=0,t=o.length;e<t;e++)o[e].call(this,n);n.target=null}}}}let e=0;const y=new p,v=new d,b=new Y,_=new i,x=new i,w=new Y;class S extends g{constructor(){super(),Object.defineProperty(this,"id",{value:e++}),this.uuid=h.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(65535<m(e)?r:o)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){var t=this.attributes.position,t=(void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0),this.attributes.normal),n=(void 0!==t&&(n=(new f).getNormalMatrix(e),t.applyNormalMatrix(n),t.needsUpdate=!0),this.attributes.tangent);return void 0!==n&&(n.transformDirection(e),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return y.makeRotationFromQuaternion(e),this.applyMatrix4(y),this}rotateX(e){return y.makeRotationX(e),this.applyMatrix4(y),this}rotateY(e){return y.makeRotationY(e),this.applyMatrix4(y),this}rotateZ(e){return y.makeRotationZ(e),this.applyMatrix4(y),this}translate(e,t,n){return y.makeTranslation(e,t,n),this.applyMatrix4(y),this}scale(e,t,n){return y.makeScale(e,t,n),this.applyMatrix4(y),this}lookAt(e){return v.lookAt(e),v.updateMatrix(),this.applyMatrix4(v.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(b).negate(),this.translate(b.x,b.y,b.z),this}setFromPoints(n){var o=[];for(let e=0,t=n.length;e<t;e++){var i=n[e];o.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new s(o,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new i);var e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new Y(-1/0,-1/0,-1/0),new Y(1/0,1/0,1/0));else{if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),n)for(let e=0,t=n.length;e<t;e++){var o=n[e];_.setFromBufferAttribute(o),this.morphTargetsRelative?(w.addVectors(this.boundingBox.min,_.min),this.boundingBox.expandByPoint(w),w.addVectors(this.boundingBox.max,_.max),this.boundingBox.expandByPoint(w)):(this.boundingBox.expandByPoint(_.min),this.boundingBox.expandByPoint(_.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new u);var o=this.attributes.position,i=this.morphAttributes.position;if(o&&o.isGLBufferAttribute)console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new Y,1/0);else if(o){var r=this.boundingSphere.center;if(_.setFromBufferAttribute(o),i)for(let e=0,t=i.length;e<t;e++){var a=i[e];x.setFromBufferAttribute(a),this.morphTargetsRelative?(w.addVectors(_.min,x.min),_.expandByPoint(w),w.addVectors(_.max,x.max),_.expandByPoint(w)):(_.expandByPoint(x.min),_.expandByPoint(x.max))}_.getCenter(r);let n=0;for(let e=0,t=o.count;e<t;e++)w.fromBufferAttribute(o,e),n=Math.max(n,r.distanceToSquared(w));if(i)for(let e=0,t=i.length;e<t;e++){var s=i[e],l=this.morphTargetsRelative;for(let e=0,t=s.count;e<t;e++)w.fromBufferAttribute(s,e),l&&(b.fromBufferAttribute(o,e),w.add(b)),n=Math.max(n,r.distanceToSquared(w))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){var e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");else{var o=e.array;const m=t.position.array,h=t.normal.array,g=t.uv.array;var i,r,a,s,l=m.length/3;void 0===t.tangent&&this.setAttribute("tangent",new L(new Float32Array(4*l),4));const y=t.tangent.array,v=[],b=[];for(let e=0;e<l;e++)v[e]=new Y,b[e]=new Y;const _=new Y,x=new Y,w=new Y,S=new Z,T=new Z,E=new Z,C=new Y,A=new Y;let n=this.groups;for(let e=0,t=(n=0===n.length?[{start:0,count:o.length}]:n).length;e<t;++e){var c=n[e],u=c.start;for(let e=u,t=u+c.count;e<t;e+=3)i=o[e+0],r=o[e+1],a=o[e+2],s=void 0,_.fromArray(m,3*i),x.fromArray(m,3*r),w.fromArray(m,3*a),S.fromArray(g,2*i),T.fromArray(g,2*r),E.fromArray(g,2*a),x.sub(_),w.sub(_),T.sub(S),E.sub(S),s=1/(T.x*E.y-E.x*T.y),isFinite(s)&&(C.copy(x).multiplyScalar(E.y).addScaledVector(w,-T.y).multiplyScalar(s),A.copy(w).multiplyScalar(T.x).addScaledVector(x,-E.x).multiplyScalar(s),v[i].add(C),v[r].add(C),v[a].add(C),b[i].add(A),b[r].add(A),b[a].add(A))}const P=new Y,O=new Y,k=new Y,z=new Y;for(let e=0,t=n.length;e<t;++e){var d=n[e],p=d.start;for(let e=p,t=p+d.count;e<t;e+=3)f(o[e+0]),f(o[e+1]),f(o[e+2])}function f(e){k.fromArray(h,3*e),z.copy(k);var t=v[e],t=(P.copy(t),P.sub(k.multiplyScalar(k.dot(t))).normalize(),O.crossVectors(z,t),O.dot(b[e])),t=t<0?-1:1;y[4*e]=P.x,y[4*e+1]=P.y,y[4*e+2]=P.z,y[4*e+3]=t}}}computeVertexNormals(){var o=this.index,i=this.getAttribute("position");if(void 0!==i){let n=this.getAttribute("normal");if(void 0===n)n=new L(new Float32Array(3*i.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);var r=new Y,a=new Y,s=new Y,l=new Y,c=new Y,u=new Y,d=new Y,p=new Y;if(o)for(let e=0,t=o.count;e<t;e+=3){var f=o.getX(e+0),m=o.getX(e+1),h=o.getX(e+2);r.fromBufferAttribute(i,f),a.fromBufferAttribute(i,m),s.fromBufferAttribute(i,h),d.subVectors(s,a),p.subVectors(r,a),d.cross(p),l.fromBufferAttribute(n,f),c.fromBufferAttribute(n,m),u.fromBufferAttribute(n,h),l.add(d),c.add(d),u.add(d),n.setXYZ(f,l.x,l.y,l.z),n.setXYZ(m,c.x,c.y,c.z),n.setXYZ(h,u.x,u.y,u.z)}else for(let e=0,t=i.count;e<t;e+=3)r.fromBufferAttribute(i,e+0),a.fromBufferAttribute(i,e+1),s.fromBufferAttribute(i,e+2),d.subVectors(s,a),p.subVectors(r,a),d.cross(p),n.setXYZ(e+0,d.x,d.y,d.z),n.setXYZ(e+1,d.x,d.y,d.z),n.setXYZ(e+2,d.x,d.y,d.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(const s in n)if(void 0!==e.attributes[s]){var o=n[s].array,i=e.attributes[s],r=i.array,i=i.itemSize*t,a=Math.min(r.length,o.length-i);for(let e=0,t=i;e<a;e++,t++)o[t]=r[e]}return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)}normalizeNormals(){var n=this.attributes.normal;for(let e=0,t=n.count;e<t;e++)w.fromBufferAttribute(n,e),w.normalize(),n.setXYZ(e,w.x,w.y,w.z)}toNonIndexed(){function n(n,o){var i=n.array,r=n.itemSize,e=n.normalized,a=new i.constructor(o.length*r);let s=0,l=0;for(let e=0,t=o.length;e<t;e++){s=n.isInterleavedBufferAttribute?o[e]*n.data.stride+n.offset:o[e]*r;for(let e=0;e<r;e++)a[l++]=i[s++]}return new L(a,r,e)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var o=new S,i=this.index.array,e=this.attributes;for(const d in e){var t=n(e[d],i);o.setAttribute(d,t)}var r=this.morphAttributes;for(const p in r){var a=[],s=r[p];for(let e=0,t=s.length;e<t;e++){var l=n(s[e],i);a.push(l)}o.morphAttributes[p]=a}o.morphTargetsRelative=this.morphTargetsRelative;var c=this.groups;for(let e=0,t=c.length;e<t;e++){var u=c[e];o.addGroup(u.start,u.count,u.materialIndex)}return o}toJSON(){var n={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),0<Object.keys(this.userData).length&&(n.userData=this.userData),void 0!==this.parameters){var e=this.parameters;for(const c in e)void 0!==e[c]&&(n[c]=e[c])}else{n.data={attributes:{}};var t=this.index,o=(null!==t&&(n.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)}),this.attributes);for(const u in o){var i=o[u];n.data.attributes[u]=i.toJSON(n.data)}var r={};let e=!1;for(const d in this.morphAttributes){var a=this.morphAttributes[d],s=[];for(let e=0,t=a.length;e<t;e++){var l=a[e];s.push(l.toJSON(n.data))}0<s.length&&(r[d]=s,e=!0)}e&&(n.data.morphAttributes=r,n.data.morphTargetsRelative=this.morphTargetsRelative);t=this.groups,t=(0<t.length&&(n.data.groups=JSON.parse(JSON.stringify(t))),this.boundingSphere);null!==t&&(n.data.boundingSphere={center:t.center.toArray(),radius:t.radius})}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var n={},t=(this.name=e.name,e.index),o=(null!==t&&this.setIndex(t.clone(n)),e.attributes);for(const u in o){var i=o[u];this.setAttribute(u,i.clone(n))}var r=e.morphAttributes;for(const d in r){var a=[],s=r[d];for(let e=0,t=s.length;e<t;e++)a.push(s[e].clone(n));this.morphAttributes[d]=a}this.morphTargetsRelative=e.morphTargetsRelative;var l=e.groups;for(let e=0,t=l.length;e<t;e++){var c=l[e];this.addGroup(c.start,c.count,c.materialIndex)}t=e.boundingBox,null!==t&&(this.boundingBox=t.clone()),t=e.boundingSphere;return null!==t&&(this.boundingSphere=t.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}S.prototype.isBufferGeometry=!0;S;this.ConvexGeometry=class extends S{constructor(e){super();var n=[],o=[],i=(new Xe.ConvexHull).setFromPoints(e).faces;for(let t=0;t<i.length;t++){var r=i[t];let e=r.edge;do{var a=e.head().point;n.push(a.x,a.y,a.z),o.push(r.normal.x,r.normal.y,r.normal.z),e=e.next}while(e!==r.edge)}this.setAttribute("position",new s(n,3)),this.setAttribute("normal",new s(o,3))}};const J=E.THREE.MOUSE,K=E.THREE.Quaternion,Q=E.THREE.Spherical,$=E.THREE.TOUCH,ee={type:"change"},te={type:"start"},ne={type:"end"};class T extends g{constructor(e,t){super(),void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new Y,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:J.ROTATE,MIDDLE:J.DOLLY,RIGHT:J.PAN},this.touches={ONE:$.ROTATE,TWO:$.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return f.phi},this.getAzimuthalAngle=function(){return f.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",U),this._domElementKeyEvents=e},this.saveState=function(){c.target0.copy(c.target),c.position0.copy(c.object.position),c.zoom0=c.object.zoom},this.reset=function(){c.target.copy(c.target0),c.object.position.copy(c.position0),c.object.zoom=c.zoom0,c.object.updateProjectionMatrix(),c.dispatchEvent(ee),c.update(),d=u.NONE},this.update=function(){const o=new Y,i=(new K).setFromUnitVectors(e.up,new Y(0,1,0)),r=i.clone().invert(),a=new Y,s=new K,l=2*Math.PI;return function(){var e=c.object.position;o.copy(e).sub(c.target),o.applyQuaternion(i),f.setFromVector3(o),c.autoRotate&&d===u.NONE&&S(2*Math.PI/60/60*c.autoRotateSpeed),c.enableDamping?(f.theta+=m.theta*c.dampingFactor,f.phi+=m.phi*c.dampingFactor):(f.theta+=m.theta,f.phi+=m.phi);let t=c.minAzimuthAngle,n=c.maxAzimuthAngle;return isFinite(t)&&isFinite(n)&&(t<-Math.PI?t+=l:t>Math.PI&&(t-=l),n<-Math.PI?n+=l:n>Math.PI&&(n-=l),t<=n?f.theta=Math.max(t,Math.min(n,f.theta)):f.theta=f.theta>(t+n)/2?Math.max(t,f.theta):Math.min(n,f.theta)),f.phi=Math.max(c.minPolarAngle,Math.min(c.maxPolarAngle,f.phi)),f.makeSafe(),f.radius*=h,f.radius=Math.max(c.minDistance,Math.min(c.maxDistance,f.radius)),!0===c.enableDamping?c.target.addScaledVector(g,c.dampingFactor):c.target.add(g),o.setFromSpherical(f),o.applyQuaternion(r),e.copy(c.target).add(o),c.object.lookAt(c.target),!0===c.enableDamping?(m.theta*=1-c.dampingFactor,m.phi*=1-c.dampingFactor,g.multiplyScalar(1-c.dampingFactor)):(m.set(0,0,0),g.set(0,0,0)),h=1,!(!(y||a.distanceToSquared(c.object.position)>p||8*(1-s.dot(c.object.quaternion))>p)||(c.dispatchEvent(ee),a.copy(c.object.position),s.copy(c.object.quaternion),y=!1))}}(),this.dispose=function(){c.domElement.removeEventListener("contextmenu",X),c.domElement.removeEventListener("pointerdown",B),c.domElement.removeEventListener("pointercancel",H),c.domElement.removeEventListener("wheel",G),c.domElement.removeEventListener("pointermove",N),c.domElement.removeEventListener("pointerup",M),null!==c._domElementKeyEvents&&c._domElementKeyEvents.removeEventListener("keydown",U)};const c=this,u={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let d=u.NONE;const p=1e-6,f=new Q,m=new Q;let h=1;const g=new Y;let y=!1;const o=new Z,i=new Z,r=new Z,a=new Z,s=new Z,l=new Z,v=new Z,b=new Z,_=new Z,x=[],n={};function w(){return Math.pow(.95,c.zoomSpeed)}function S(e){m.theta-=e}function T(e){m.phi-=e}const E=function(){const n=new Y;return function(e,t){n.setFromMatrixColumn(t,0),n.multiplyScalar(-e),g.add(n)}}(),C=function(){const n=new Y;return function(e,t){!0===c.screenSpacePanning?n.setFromMatrixColumn(t,1):(n.setFromMatrixColumn(t,0),n.crossVectors(c.object.up,n)),n.multiplyScalar(e),g.add(n)}}(),A=function(){const i=new Y;return function(e,t){var n,o=c.domElement;c.object.isPerspectiveCamera?(n=c.object.position,i.copy(n).sub(c.target),n=i.length(),n*=Math.tan(c.object.fov/2*Math.PI/180),E(2*e*n/o.clientHeight,c.object.matrix),C(2*t*n/o.clientHeight,c.object.matrix)):c.object.isOrthographicCamera?(E(e*(c.object.right-c.object.left)/c.object.zoom/o.clientWidth,c.object.matrix),C(t*(c.object.top-c.object.bottom)/c.object.zoom/o.clientHeight,c.object.matrix)):(console.warn("WARNING: OrbitControls encountered an unknown camera type - pan disabled."),c.enablePan=!1)}}();function P(e){c.object.isPerspectiveCamera?h/=e:c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom*e)),c.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function O(e){c.object.isPerspectiveCamera?h*=e:c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom/e)),c.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function k(e){o.set(e.clientX,e.clientY)}function z(e){a.set(e.clientX,e.clientY)}function L(){var e,t;1===x.length?o.set(x[0].pageX,x[0].pageY):(e=.5*(x[0].pageX+x[1].pageX),t=.5*(x[0].pageY+x[1].pageY),o.set(e,t))}function D(){var e,t;1===x.length?a.set(x[0].pageX,x[0].pageY):(e=.5*(x[0].pageX+x[1].pageX),t=.5*(x[0].pageY+x[1].pageY),a.set(e,t))}function V(){var e=x[0].pageX-x[1].pageX,t=x[0].pageY-x[1].pageY,e=Math.sqrt(e*e+t*t);v.set(0,e)}function I(e){1==x.length?i.set(e.pageX,e.pageY):(n=F(e),t=.5*(e.pageX+n.x),e=.5*(e.pageY+n.y),i.set(t,e)),r.subVectors(i,o).multiplyScalar(c.rotateSpeed);var t,n=c.domElement;S(2*Math.PI*r.x/n.clientHeight),T(2*Math.PI*r.y/n.clientHeight),o.copy(i)}function R(e){var t,n;1===x.length?s.set(e.pageX,e.pageY):(t=F(e),n=.5*(e.pageX+t.x),e=.5*(e.pageY+t.y),s.set(n,e)),l.subVectors(s,a).multiplyScalar(c.panSpeed),A(l.x,l.y),a.copy(s)}function j(e){var t=F(e),n=e.pageX-t.x,e=e.pageY-t.y,t=Math.sqrt(n*n+e*e);b.set(0,t),_.set(0,Math.pow(b.y/v.y,c.zoomSpeed)),P(_.y),v.copy(b)}function B(t){if(!1!==c.enabled){var e;if(0===x.length&&(c.domElement.setPointerCapture(t.pointerId),c.domElement.addEventListener("pointermove",N),c.domElement.addEventListener("pointerup",M)),e=t,x.push(e),"touch"!==t.pointerType){var n=t;let e;switch(n.button){case 0:e=c.mouseButtons.LEFT;break;case 1:e=c.mouseButtons.MIDDLE;break;case 2:e=c.mouseButtons.RIGHT;break;default:e=-1}switch(e){case J.DOLLY:if(!1===c.enableZoom)return;!function(e){v.set(e.clientX,e.clientY)}(n),d=u.DOLLY;break;case J.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(!1===c.enablePan)return;z(n),d=u.PAN}else{if(!1===c.enableRotate)return;k(n),d=u.ROTATE}break;case J.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(!1===c.enableRotate)return;k(n),d=u.ROTATE}else{if(!1===c.enablePan)return;z(n),d=u.PAN}break;default:d=u.NONE}}else switch(W(t),x.length){case 1:switch(c.touches.ONE){case $.ROTATE:if(!1===c.enableRotate)return;L(),d=u.TOUCH_ROTATE;break;case $.PAN:if(!1===c.enablePan)return;D(),d=u.TOUCH_PAN;break;default:d=u.NONE}break;case 2:switch(c.touches.TWO){case $.DOLLY_PAN:if(!1===c.enableZoom&&!1===c.enablePan)return;c.enableZoom&&V(),c.enablePan&&D(),d=u.TOUCH_DOLLY_PAN;break;case $.DOLLY_ROTATE:if(!1===c.enableZoom&&!1===c.enableRotate)return;c.enableZoom&&V(),c.enableRotate&&L(),d=u.TOUCH_DOLLY_ROTATE;break;default:d=u.NONE}break;default:d=u.NONE}d!==u.NONE&&c.dispatchEvent(te)}}function N(e){if(!1!==c.enabled)if("touch"===e.pointerType){var t=e;switch(W(t),d){case u.TOUCH_ROTATE:!1!==c.enableRotate&&(I(t),c.update());break;case u.TOUCH_PAN:!1!==c.enablePan&&(R(t),c.update());break;case u.TOUCH_DOLLY_PAN:!1===c.enableZoom&&!1===c.enablePan||(!function(e){c.enableZoom&&j(e),c.enablePan&&R(e)}(t),c.update());break;case u.TOUCH_DOLLY_ROTATE:!1===c.enableZoom&&!1===c.enableRotate||(!function(e){c.enableZoom&&j(e),c.enableRotate&&I(e)}(t),c.update());break;default:d=u.NONE}}else{var n=e;if(!1!==c.enabled)switch(d){case u.ROTATE:!1!==c.enableRotate&&!function(e){i.set(e.clientX,e.clientY),r.subVectors(i,o).multiplyScalar(c.rotateSpeed),e=c.domElement,S(2*Math.PI*r.x/e.clientHeight),T(2*Math.PI*r.y/e.clientHeight),o.copy(i),c.update()}(n);break;case u.DOLLY:!1!==c.enableZoom&&!function(e){b.set(e.clientX,e.clientY),_.subVectors(b,v),0<_.y?P(w()):_.y<0&&O(w()),v.copy(b),c.update()}(n);break;case u.PAN:!1!==c.enablePan&&!function(e){s.set(e.clientX,e.clientY),l.subVectors(s,a).multiplyScalar(c.panSpeed),A(l.x,l.y),a.copy(s),c.update()}(n)}}}function M(e){!1!==c.enabled&&(d=(e.pointerType,c.dispatchEvent(ne),u.NONE),q(e),0===x.length)&&(c.domElement.releasePointerCapture(e.pointerId),c.domElement.removeEventListener("pointermove",N),c.domElement.removeEventListener("pointerup",M))}function H(e){q(e)}function G(e){!1===c.enabled||!1===c.enableZoom||d!==u.NONE&&d!==u.ROTATE||(e.preventDefault(),c.dispatchEvent(te),(e=e).deltaY<0?O(w()):0<e.deltaY&&P(w()),c.update(),c.dispatchEvent(ne))}function U(t){if(!1!==c.enabled&&!1!==c.enablePan){let e=!1;switch(t.code){case c.keys.UP:A(0,c.keyPanSpeed),e=!0;break;case c.keys.BOTTOM:A(0,-c.keyPanSpeed),e=!0;break;case c.keys.LEFT:A(c.keyPanSpeed,0),e=!0;break;case c.keys.RIGHT:A(-c.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),c.update())}}function X(e){!1!==c.enabled&&e.preventDefault()}function q(t){delete n[t.pointerId];for(let e=0;e<x.length;e++)if(x[e].pointerId==t.pointerId)return void x.splice(e,1)}function W(e){let t=n[e.pointerId];void 0===t&&(t=new Z,n[e.pointerId]=t),t.set(e.pageX,e.pageY)}function F(e){e=e.pointerId===x[0].pointerId?x[1]:x[0];return n[e.pointerId]}c.domElement.addEventListener("contextmenu",X),c.domElement.addEventListener("pointerdown",B),c.domElement.addEventListener("pointercancel",H),c.domElement.addEventListener("wheel",G,{passive:!1}),this.update()}}function n(){const t=new Y,_=new a,x=new l,w=new Y,o=new c;this.ConvexHull=class{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new e,this.unassigned=new e,this.vertices=[]}setFromPoints(n){!0!==Array.isArray(n)&&console.error("THREE.ConvexHull: Points parameter is not an array."),n.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(let e=0,t=n.length;e<t;e++)this.vertices.push(new r(n[e]));return this.compute(),this}setFromObject(e){const r=[];return e.updateMatrixWorld(!0),e.traverse(function(n){var e=n.geometry;if(void 0!==e)if(e.isGeometry)console.error("THREE.ConvexHull no longer supports Geometry. Use THREE.BufferGeometry instead.");else if(e.isBufferGeometry){var o=e.attributes.position;if(void 0!==o)for(let e=0,t=o.count;e<t;e++){var i=new Y;i.fromBufferAttribute(o,e).applyMatrix4(n.matrixWorld),r.push(i)}}}),this.setFromPoints(r)}containsPoint(n){var o=this.faces;for(let e=0,t=o.length;e<t;e++)if(o[e].distanceToPoint(n)>this.tolerance)return!1;return!0}intersectRay(n,e){var o=this.faces;let i=-1/0,r=1/0;for(let e=0,t=o.length;e<t;e++){var a=o[e],s=a.distanceToPoint(n.origin),a=a.normal.dot(n.direction);if(0<s&&0<=a)return null;s=0!==a?-s/a:0;if(!(s<=0)&&(0<a?r=Math.min(s,r):i=Math.max(s,i),i>r))return null}return i!==-1/0?n.at(i,e):n.at(r,e),e}intersectsRay(e){return null!==this.intersectRay(e,t)}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(e,t){return null===(e.face=t).outside?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this}removeVertexFromFace(e,t){return e===t.outside&&(null!==e.next&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this}removeAllVerticesFromFace(t){if(null!==t.outside){var n=t.outside;let e=t.outside;for(;null!==e.next&&e.next.face===t;)e=e.next;return this.assigned.removeSubList(n,e),n.prev=e.next=null,t.outside=null,n}}deleteFaceVertices(t,n){t=this.removeAllVerticesFromFace(t);if(void 0!==t)if(void 0===n)this.unassigned.appendChain(t);else{let e=t;do{var o=e.next;n.distanceToPoint(e.point)>this.tolerance?this.addVertexToFace(e,n):this.unassigned.append(e),e=o}while(null!==e)}return this}resolveUnassignedPoints(i){if(!1===this.unassigned.isEmpty()){let o=this.unassigned.first();do{var e=o.next;let t=this.tolerance,n=null;for(let e=0;e<i.length;e++){var r=i[e];if(0===r.mark){var a=r.distanceToPoint(o.point);if(a>t&&(t=a,n=r),t>1e3*this.tolerance)break}}null!==n&&this.addVertexToFace(o,n),o=e}while(null!==o)}return this}computeExtremes(){var n=new Y,o=new Y,i=[],r=[];for(let e=0;e<3;e++)i[e]=r[e]=this.vertices[0];n.copy(this.vertices[0].point),o.copy(this.vertices[0].point);for(let e=0,t=this.vertices.length;e<t;e++){var a=this.vertices[e],s=a.point;for(let e=0;e<3;e++)s.getComponent(e)<n.getComponent(e)&&(n.setComponent(e,s.getComponent(e)),i[e]=a);for(let e=0;e<3;e++)s.getComponent(e)>o.getComponent(e)&&(o.setComponent(e,s.getComponent(e)),r[e]=a)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(n.x),Math.abs(o.x))+Math.max(Math.abs(n.y),Math.abs(o.y))+Math.max(Math.abs(n.z),Math.abs(o.z))),{min:i,max:r}}computeInitialHull(){var n=this.vertices,e=this.computeExtremes(),t=e.min,o=e.max;let i=0,r=0;for(let e=0;e<3;e++){var a=o[e].point.getComponent(e)-t[e].point.getComponent(e);a>i&&(i=a,r=e)}var s=t[r],l=o[r];let c,u;i=0,_.set(s.point,l.point);for(let e=0,t=this.vertices.length;e<t;e++){var d,p=n[e];p!==s&&p!==l&&(_.closestPointToPoint(p.point,!0,w),(d=w.distanceToSquared(p.point))>i)&&(i=d,c=p)}i=-1,x.setFromCoplanarPoints(s.point,l.point,c.point);for(let e=0,t=this.vertices.length;e<t;e++){var f,m=n[e];m!==s&&m!==l&&m!==c&&(f=Math.abs(x.distanceToPoint(m.point)))>i&&(i=f,u=m)}var h=[];if(x.distanceToPoint(u.point)<0){h.push(S.create(s,l,c),S.create(u,l,s),S.create(u,c,l),S.create(u,s,c));for(let e=0;e<3;e++){var g=(e+1)%3;h[e+1].getEdge(2).setTwin(h[0].getEdge(g)),h[e+1].getEdge(1).setTwin(h[1+g].getEdge(0))}}else{h.push(S.create(s,c,l),S.create(u,s,l),S.create(u,l,c),S.create(u,c,s));for(let e=0;e<3;e++){var y=(e+1)%3;h[e+1].getEdge(2).setTwin(h[0].getEdge((3-e)%3)),h[e+1].getEdge(0).setTwin(h[1+y].getEdge(1))}}for(let e=0;e<4;e++)this.faces.push(h[e]);for(let e=0,t=n.length;e<t;e++){var v=n[e];if(v!==s&&v!==l&&v!==c&&v!==u){i=this.tolerance;let t=null;for(let e=0;e<4;e++){var b=this.faces[e].distanceToPoint(v.point);b>i&&(i=b,t=this.faces[e])}null!==t&&this.addVertexToFace(v,t)}}return this}reindexFaces(){var t=[];for(let e=0;e<this.faces.length;e++){var n=this.faces[e];0===n.mark&&t.push(n)}return this.faces=t,this}nextVertexToAdd(){if(!1===this.assigned.isEmpty()){let e,t=0;var o=this.assigned.first().face;let n=o.outside;do{var i=o.distanceToPoint(n.point);i>t&&(t=i,e=n),n=n.next}while(null!==n&&n.face===o);return e}}computeHorizon(e,t,n,o){this.deleteFaceVertices(n),n.mark=1;let i;i=null===t?t=n.getEdge(0):t.next;do{var r=i.twin,a=r.face;0===a.mark&&(a.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,r,a,o):o.push(i)),i=i.next}while(i!==t);return this}addAdjoiningFace(e,t){e=S.create(e,t.tail(),t.head());return this.faces.push(e),e.getEdge(-1).setTwin(t.twin),e.getEdge(0)}addNewFaces(t,n){this.newFaces=[];let o=null,i=null;for(let e=0;e<n.length;e++){var r=n[e],r=this.addAdjoiningFace(t,r);null===o?o=r:r.next.setTwin(i),this.newFaces.push(r.face),i=r}return o.next.setTwin(i),this}addVertexToHull(e){var t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){var e;for(this.computeInitialHull();void 0!==(e=this.nextVertexToAdd());)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}};class S{constructor(){this.normal=new Y,this.midpoint=new Y,this.area=0,this.constant=0,this.outside=null,this.mark=0,this.edge=null}static create(e,t,n){var o=new S,e=new i(e,o),t=new i(t,o),n=new i(n,o);return((e.next=n.prev=t).next=e.prev=n).next=t.prev=e,o.edge=e,o.compute()}getEdge(e){let t=this.edge;for(;0<e;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t}compute(){var e=this.edge.tail(),t=this.edge.head(),n=this.edge.next.head();return o.set(e.point,t.point,n.point),o.getNormal(this.normal),o.getMidpoint(this.midpoint),this.area=o.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(e){return this.normal.dot(e)-this.constant}}class i{constructor(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceTo(e.point):-1}lengthSquared(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceToSquared(e.point):-1}setTwin(e){return(this.twin=e).twin=this}}class r{constructor(e){this.point=e,this.prev=null,this.next=null,this.face=null}}class e{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(e,t){return t.prev=e.prev,t.next=e,null===t.prev?this.head=t:t.prev.next=t,e.prev=t,this}insertAfter(e,t){return t.prev=e,t.next=e.next,null===t.next?this.tail=t:t.next.prev=t,e.next=t,this}append(e){return null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this}appendChain(e){for(null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail;null!==e.next;)e=e.next;return this.tail=e,this}remove(e){return null===e.prev?this.head=e.next:e.prev.next=e.next,null===e.next?this.tail=e.prev:e.next.prev=e.prev,this}removeSubList(e,t){return null===e.prev?this.head=t.next:e.prev.next=t.next,null===t.next?this.tail=e.prev:t.next.prev=e.prev,this}isEmpty(){return null===this.head}}}this.OrbitControls=T}}get THREE(){return void 0===Ge&&console.error("three: invalid _THREE = "+Ge+". Call three.THREE = THREE first."),Ge}set dat(e){Ue?Object.is(e,Ue)||console.error("three: duplicate dat. Please use one instance of the dat library."):Ue=e}get dat(){return Ue}}window.__myThree__=window.__myThree__||{},window.__myThree__.three?E=window.__myThree__.three:((E=new We).isThree=function(){return Ge},window.__myThree__.three=E);var me=E;
/**
 * @module ScaleController
 * @description is dat.GUI graphical user interface controller for control of the scale of threejs 3D object
 *
 * @see {@link https://threejs.org/} about threejs
 * @see {@link https://github.com/dataarts/dat.gui} about dat.GUI
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */class Ye extends e{constructor(i,r){(r=r||{}).settings=r.settings||{},r.settings.zoomMultiplier=r.settings.zoomMultiplier||1.1,super({multiplier:r.settings.zoomMultiplier,property:function(e){var t={zoom:"Zoom",in:"in",out:"out",wheelZoom:"Scroll the mouse wheel to zoom"},n=void 0===r.getLanguageCode?"en":r.getLanguageCode(),n=("ru"===n?(t.zoom="Изменить",t.in="увеличить",t.out="уменьшить",t.wheelZoom="Прокрутите колесико мыши для изменения масштаба"):void 0!==r.lang&&r.lang.languageCode==n&&Object.keys(r.lang).forEach(function(e){void 0!==t[e]&&(t[e]=r.lang[e])}),{}),o=qe;return n.zoomLabel=o(t.zoom,{title:t.wheelZoom,onwheel:function(n){i(e,function(e,t){return 0<n?e*=t:e/=t,e})}}),n.in=o("↑",{title:t.in,onclick:function(){i(e,function(e,t){return e*=t})}}),n.out=o("↓",{title:t.out,onclick:function(){i(e,function(e,t){return e/=t})}}),n}},"multiplier",1.1,10,.1,r.newBool),void 0===this.property&&console.error("init() returns "+this.property)}}
/**
 * PositionController is dat.GUI graphical user interface controller for control of the position of threejs 3D object
 *
 * @see {@link https://threejs.org/} about threejs
 * @see {@link https://github.com/dataarts/dat.gui} about dat.GUI
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
class Ze extends e{constructor(i,r){(r=r||{}).settings=r.settings||{};var e=r.settings;void 0===r.min&&(r.min=.1),void 0===r.max&&(r.max=10),void 0===e.offset&&(e.offset=.1),void 0===r.step&&(r.step=.1),super({offset:e.offset,property:function(n){var t={offset:"Offset",add:"add",subtract:"subtract",wheelPosition:"Scroll the mouse wheel to change the position"},e=void 0===r.getLanguageCode?"en":r.getLanguageCode(),e=("ru"===e?(t.offset="Сдвиг",t.add="добавить",t.subtract="вычесть",t.wheelPosition="Прокрутите колесико мыши для изменения позиции"):void 0!==r.lang&&r.lang.languageCode==e&&Object.keys(r.lang).forEach(function(e){void 0!==t[e]&&(t[e]=r.lang[e])}),{}),o=qe;return e.Label=o(t.offset,{title:t.wheelPosition,onwheel:function(e){var t=n.controller.getValue();i(0<e?t:-t)}}),e.in=o("↑",{title:t.add,onclick:function(){i(n.controller.getValue())}}),e.out=o("↓",{title:t.subtract,onclick:function(){i(-n.controller.getValue())}}),e}},"offset",r.min,r.max,r.step),void 0===this.property&&console.error("init() returns "+this.property)}}function Je(e,t){var n=e.__state.conversionName.toString(),o=Math.round(e.r),i=Math.round(e.g),r=Math.round(e.b),a=e.a,s=Math.round(e.h),l=e.s.toFixed(1),c=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var u=e.hex.toString(16);u.length<6;)u="0"+u;return"#"+u}return"CSS_RGB"===n?"rgb("+o+","+i+","+r+")":"CSS_RGBA"===n?"rgba("+o+","+i+","+r+","+a+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+o+","+i+","+r+"]":"RGBA_ARRAY"===n?"["+o+","+i+","+r+","+a+"]":"RGB_OBJ"===n?"{r:"+o+",g:"+i+",b:"+r+"}":"RGBA_OBJ"===n?"{r:"+o+",g:"+i+",b:"+r+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+",a:"+a+"}":"unknown format"}var Ke,Qe=Array.prototype.forEach,$e=Array.prototype.slice,v={BREAK:{},extend:function(n){return this.each($e.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(t[e])||(n[e]=t[e])}.bind(this))},this),n},defaults:function(n){return this.each($e.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(e){this.isUndefined(n[e])&&(n[e]=t[e])}.bind(this))},this),n},compose:function(){var n=$e.call(arguments);return function(){for(var e=$e.call(arguments),t=n.length-1;0<=t;t--)e=[n[t].apply(this,e)];return e[0]}},each:function(e,t,n){if(e)if(Qe&&e.forEach&&e.forEach===Qe)e.forEach(t,n);else if(e.length===e.length+0){for(var o=void 0,o=0,i=e.length;o<i;o++)if(o in e&&t.call(n,e[o],o)===this.BREAK)return}else for(var r in e)if(t.call(n,e[r],r)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(o,i,r){var a=void 0;return function(){var e=this,t=arguments;var n=r||!a;clearTimeout(a),a=setTimeout(function(){a=null,r||o.apply(e,t)},i),n&&o.apply(e,t)}},toArray:function(e){return e.toArray?e.toArray():$e.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:(Ke=function(e){return isNaN(e)},et.toString=function(){return Ke.toString()},et),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}};function et(e){return Ke.apply(this,arguments)}function tt(){rt=!1;var n=1<arguments.length?v.toArray(arguments):arguments[0];return v.each(ot,function(e){if(e.litmus(n))return v.each(e.conversions,function(e,t){if(it=e.read(n),!1===rt&&!1!==it)return(rt=it).conversionName=t,it.conversion=e,v.BREAK}),v.BREAK}),rt}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var nt,ot=[{litmus:v.isString,conversions:{THREE_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:Je},SIX_CHAR_HEX:{read:function(e){e=e.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:Je},CSS_RGB:{read:function(e){e=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:Je},CSS_RGBA:{read:function(e){e=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:Je}}},{litmus:v.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:v.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:v.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(v.isNumber(e.r)&&v.isNumber(e.g)&&v.isNumber(e.b)&&v.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(v.isNumber(e.r)&&v.isNumber(e.g)&&v.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(v.isNumber(e.h)&&v.isNumber(e.s)&&v.isNumber(e.v)&&v.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(v.isNumber(e.h)&&v.isNumber(e.s)&&v.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],it=void 0,rt=void 0,at={hsv_to_rgb:function(e,t,n){var o=Math.floor(e/60)%6,e=e/60-Math.floor(e/60),i=n*(1-t),r=n*(1-e*t),e=n*(1-(1-e)*t),t=[[n,e,i],[r,n,i],[i,n,e],[i,r,n],[e,i,n],[n,i,r]][o];return{r:255*t[0],g:255*t[1],b:255*t[2]}},rgb_to_hsv:function(e,t,n){var o=Math.min(e,t,n),i=Math.max(e,t,n),o=i-o,r=void 0;return 0===i?{h:NaN,s:0,v:0}:(r=e===i?(t-n)/o:t===i?2+(n-e)/o:4+(e-t)/o,(r/=6)<0&&(r+=1),{h:360*r,s:o/i,v:i/255})},rgb_to_hex:function(e,t,n){e=this.hex_with_component(0,2,e),e=this.hex_with_component(e,1,t);return this.hex_with_component(e,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,n){return n<<(nt=8*t)|e&~(255<<nt)}},st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n){return t&&lt(e.prototype,t),n&&lt(e,n),e};function lt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function ct(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);return void 0!==o?"value"in o?o.value:void 0!==(o=o.get)?o.call(n):void 0:null!==(o=Object.getPrototypeOf(e))?ct(o,t,n):void 0}function ut(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function dt(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}a(pt,[{key:"toString",value:function(){return Je(this)}},{key:"toHexString",value:function(){return Je(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]);var _=pt;function pt(){if(b(this,pt),this.__state=tt.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}function ft(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"!==this.__state.space&&_.recalculateRGB(this,t,n),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(_.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function mt(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"!==this.__state.space&&_.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(_.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}_.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=at.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");v.extend(e.__state,at.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},_.recalculateHSV=function(e){var t=at.rgb_to_hsv(e.r,e.g,e.b);v.extend(e.__state,{s:t.s,v:t.v}),v.isNaN(t.h)?v.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},_.COMPONENTS=["r","g","b","h","s","v","hex","a"],ft(_.prototype,"r",2),ft(_.prototype,"g",1),ft(_.prototype,"b",0),mt(_.prototype,"h"),mt(_.prototype,"s"),mt(_.prototype,"v"),Object.defineProperty(_.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(_.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=at.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});a(gt,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]);var ht=gt;function gt(e,t){b(this,gt),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}var yt={},vt=(v.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){v.each(e,function(e){yt[e]=t})}),/(\d+(\.\d+)?)px/);function s(e){return"0"===e||v.isUndefined(e)||(e=e.match(vt),v.isNull(e))?0:parseFloat(e[1])}var x={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){v.isUndefined(t)&&(t=!0),v.isUndefined(n)&&(n=!0),e.style.position="absolute",t&&(e.style.left=0,e.style.right=0),n&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,o){var i=n||{},n=yt[t];if(!n)throw new Error("Event type "+t+" not supported.");var r=document.createEvent(n);switch(n){case"MouseEvents":var a=i.x||i.clientX||0,s=i.y||i.clientY||0;r.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,a,s,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":a=r.initKeyboardEvent||r.initKeyEvent;v.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),a(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:r.initEvent(t,i.bubbles||!1,i.cancelable||!0)}v.defaults(r,o),e.dispatchEvent(r)},bind:function(e,t,n,o){return e.addEventListener?e.addEventListener(t,n,{passive:o||!1}):e.attachEvent&&e.attachEvent("on"+t,n),x},unbind:function(e,t,n,o){return e.removeEventListener?e.removeEventListener(t,n,o||!1):e.detachEvent&&e.detachEvent("on"+t,n),x},addClass:function(e,t){var n;return void 0===e.className?e.className=t:e.className!==t&&-1===(n=e.className.split(/ +/)).indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,"")),x},removeClass:function(e,t){var n;return t?e.className===t?e.removeAttribute("class"):-1!==(t=(n=e.className.split(/ +/)).indexOf(t))&&(n.splice(t,1),e.className=n.join(" ")):e.className=void 0,x},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){e=getComputedStyle(e);return s(e["border-left-width"])+s(e["border-right-width"])+s(e["padding-left"])+s(e["padding-right"])+s(e.width)},getHeight:function(e){e=getComputedStyle(e);return s(e["border-top-width"])+s(e["border-bottom-width"])+s(e["padding-top"])+s(e["padding-bottom"])+s(e.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)for(;n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent;);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},bt=(ut(l,ht),a(l,[{key:"setValue",value:function(e){e=ct(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),e}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),ct(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"updateDisplay",this).call(this)}}]),l);function l(e,t){b(this,l);var e=dt(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,e,t)),n=e;return e.__prev=e.getValue(),e.__checkbox=document.createElement("input"),e.__checkbox.setAttribute("type","checkbox"),x.bind(e.__checkbox,"change",function(){n.setValue(!n.__prev)},!1),e.domElement.appendChild(e.__checkbox),e.updateDisplay(),e}ut(c,ht),a(c,[{key:"setValue",value:function(e){e=ct(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),e}},{key:"updateDisplay",value:function(){return x.isActive(this.__select)?this:(this.__select.value=this.getValue(),ct(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"updateDisplay",this).call(this))}}]);var _t=c;function c(e,t,n){b(this,c);var o,e=dt(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,e,t)),t=n,i=e;return e.__select=document.createElement("select"),v.isArray(t)&&(o={},v.each(t,function(e){o[e]=e}),t=o),v.each(t,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),i.__select.appendChild(n)}),e.updateDisplay(),x.bind(e.__select,"change",function(){var e=this.options[this.selectedIndex].value;i.setValue(e)}),e.domElement.appendChild(e.__select),e}ut(wt,ht),a(wt,[{key:"updateDisplay",value:function(){return x.isActive(this.__input)||(this.__input.value=this.getValue()),ct(wt.prototype.__proto__||Object.getPrototypeOf(wt.prototype),"updateDisplay",this).call(this)}}]);var xt=wt;function wt(e,t){b(this,wt);var e=dt(this,(wt.__proto__||Object.getPrototypeOf(wt)).call(this,e,t)),n=e;function o(){n.setValue(n.__input.value)}return e.__input=document.createElement("input"),e.__input.setAttribute("type","text"),x.bind(e.__input,"keyup",o),x.bind(e.__input,"change",o),x.bind(e.__input,"blur",function(){n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())}),x.bind(e.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),e.updateDisplay(),e.domElement.appendChild(e.__input),e}function St(e){e=e.toString();return-1<e.indexOf(".")?e.length-e.indexOf(".")-1:0}ut(Tt,ht),a(Tt,[{key:"setValue",value:function(e){return void 0!==this.__min&&e<this.__min?e=this.__min:void 0!==this.__max&&e>this.__max&&(e=this.__max),void 0!==this.__step&&e%this.__step!=0&&(e=Math.round(e/this.__step)*this.__step),ct(Tt.prototype.__proto__||Object.getPrototypeOf(Tt.prototype),"setValue",this).call(this,e)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=St(e),this}}]);e=Tt;function Tt(e,t,n){b(this,Tt);e=dt(this,(Tt.__proto__||Object.getPrototypeOf(Tt)).call(this,e,t)),t=n||{};return e.__min=t.min,e.__max=t.max,e.__step=t.step,v.isUndefined(e.__step)?0===e.initialValue?e.__impliedStep=1:e.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(e.initialValue))/Math.LN10))/10:e.__impliedStep=e.__step,e.__precision=St(e.__impliedStep),e}ut(Ct,e),a(Ct,[{key:"updateDisplay",value:function(){var e,t;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),t=this.__precision,t=Math.pow(10,t),Math.round(e*t)/t),ct(Ct.prototype.__proto__||Object.getPrototypeOf(Ct.prototype),"updateDisplay",this).call(this)}}]);var Et=Ct;function Ct(e,t,n){b(this,Ct);var e=dt(this,(Ct.__proto__||Object.getPrototypeOf(Ct)).call(this,e,t,n)),o=(e.__truncationSuspended=!1,e),i=void 0;function r(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function a(e){var t=i-e.clientY;o.setValue(o.getValue()+t*o.__impliedStep),i=e.clientY}function s(){x.unbind(window,"mousemove",a),x.unbind(window,"mouseup",s),r()}return e.__input=document.createElement("input"),e.__input.setAttribute("type","text"),x.bind(e.__input,"change",function(){var e=parseFloat(o.__input.value);v.isNaN(e)||o.setValue(e)}),x.bind(e.__input,"blur",function(){r()}),x.bind(e.__input,"mousedown",function(e){x.bind(window,"mousemove",a),x.bind(window,"mouseup",s),i=e.clientY}),x.bind(e.__input,"keydown",function(e){13===e.keyCode&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,r())}),e.updateDisplay(),e.domElement.appendChild(e.__input),e}function At(e,t,n,o,i){return o+(e-t)/(n-t)*(i-o)}ut(Ot,e),a(Ot,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",ct(Ot.prototype.__proto__||Object.getPrototypeOf(Ot.prototype),"updateDisplay",this).call(this)}}]);var Pt=Ot;function Ot(e,t,n,o,i,r){b(this,Ot);var e=dt(this,(Ot.__proto__||Object.getPrototypeOf(Ot)).call(this,e,t,{min:n,max:o,step:i})),a=e;function s(e){a.newBool||e.preventDefault();var t=a.__background.getBoundingClientRect();return a.setValue(At(e.clientX,t.left,t.right,a.__min,a.__max)),!1}function l(){x.unbind(window,"mousemove",s),x.unbind(window,"mouseup",l),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function c(e){var e=e.touches[0].clientX,t=a.__background.getBoundingClientRect();a.setValue(At(e,t.left,t.right,a.__min,a.__max))}function u(){x.unbind(window,"touchmove",c),x.unbind(window,"touchend",u),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}return e.__background=document.createElement("div"),e.__foreground=document.createElement("div"),e.newBool=r,x.bind(e.__background,"mousedown",function(e){document.activeElement.blur(),x.bind(window,"mousemove",s),x.bind(window,"mouseup",l),s(e)},r),x.bind(e.__background,"touchstart",function(e){1===e.touches.length&&(x.bind(window,"touchmove",c),x.bind(window,"touchend",u),c(e))}),x.addClass(e.__background,"slider"),x.addClass(e.__foreground,"slider-fg"),e.updateDisplay(),e.__background.appendChild(e.__foreground),e.domElement.appendChild(e.__background),e}ut(zt,ht),a(zt,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]);var kt=zt;function zt(e,t,n){b(this,zt);var e=dt(this,(zt.__proto__||Object.getPrototypeOf(zt)).call(this,e,t)),o=e;return e.__button=document.createElement("div"),e.__button.innerHTML=void 0===n?"Fire":n,x.bind(e.__button,"click",function(e){return e.preventDefault(),o.fire(),!1}),x.addClass(e.__button,"button"),e.domElement.appendChild(e.__button),e}ut(Nt,ht),a(Nt,[{key:"updateDisplay",value:function(){var t,n=tt(this.getValue()),e=(!1!==n&&(t=!1,v.each(_.COMPONENTS,function(e){if(!v.isUndefined(n[e])&&!v.isUndefined(this.__color.__state[e])&&n[e]!==this.__color.__state[e])return t=!0,{}},this),t)&&v.extend(this.__color.__state,n),v.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1,this.__color.v<.5||.5<this.__color.s?255:0),o=255-e;v.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+e+","+e+","+e+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,Ft(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),v.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+e+","+e+","+e+")",textShadow:this.__input_textShadow+"rgba("+o+","+o+","+o+",.7)"})}}]);var Lt=Nt;function Nt(e,t){b(this,Nt);var n,e=dt(this,(Nt.__proto__||Object.getPrototypeOf(Nt)).call(this,e,t)),o=(e.__color=new _(e.getValue()),e.__temp=new _(0),e),t=(e.domElement=document.createElement("div"),x.makeSelectable(e.domElement,!1),e.__selector=document.createElement("div"),e.__selector.className="selector",e.__saturation_field=document.createElement("div"),e.__saturation_field.className="saturation-field",e.__field_knob=document.createElement("div"),e.__field_knob.className="field-knob",e.__field_knob_border="2px solid ",e.__hue_knob=document.createElement("div"),e.__hue_knob.className="hue-knob",e.__hue_field=document.createElement("div"),e.__hue_field.className="hue-field",e.__input=document.createElement("input"),e.__input.type="text",e.__input_textShadow="0 1px 1px ",x.bind(e.__input,"keydown",function(e){13===e.keyCode&&l.call(this)}),x.bind(e.__input,"blur",l),x.bind(e.__selector,"mousedown",function(){x.addClass(this,"drag").bind(window,"mouseup",function(){x.removeClass(o.__selector,"drag")})}),x.bind(e.__selector,"touchstart",function(){x.addClass(this,"drag").bind(window,"touchend",function(){x.removeClass(o.__selector,"drag")})}),document.createElement("div"));function i(e){u(e),x.bind(window,"mousemove",u),x.bind(window,"touchmove",u),x.bind(window,"mouseup",a),x.bind(window,"touchend",a)}function r(e){d(e),x.bind(window,"mousemove",d),x.bind(window,"touchmove",d),x.bind(window,"mouseup",s),x.bind(window,"touchend",s)}function a(){x.unbind(window,"mousemove",u),x.unbind(window,"touchmove",u),x.unbind(window,"mouseup",a),x.unbind(window,"touchend",a),c()}function s(){x.unbind(window,"mousemove",d),x.unbind(window,"touchmove",d),x.unbind(window,"mouseup",s),x.unbind(window,"touchend",s),c()}function l(){var e=tt(this.value);!1!==e?(o.__color.__state=e,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function c(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}function u(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__saturation_field.getBoundingClientRect(),e=e.touches&&e.touches[0]||e,n=e.clientX,e=e.clientY,n=(n-t.left)/(t.right-t.left),e=1-(e-t.top)/(t.bottom-t.top);return 1<e?e=1:e<0&&(e=0),1<n?n=1:n<0&&(n=0),o.__color.v=e,o.__color.s=n,o.setValue(o.__color.toOriginal()),!1}function d(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__hue_field.getBoundingClientRect(),e=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return 1<e?e=1:e<0&&(e=0),o.__color.h=360*e,o.setValue(o.__color.toOriginal()),!1}return v.extend(e.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),v.extend(e.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:e.__field_knob_border+(e.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),v.extend(e.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),v.extend(e.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),v.extend(t.style,{width:"100%",height:"100%",background:"none"}),Ft(t,"top","rgba(0,0,0,0)","#000"),v.extend(e.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(n=e.__hue_field).style.background="",n.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",n.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",v.extend(e.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:e.__input_textShadow+"rgba(0,0,0,0.7)"}),x.bind(e.__saturation_field,"mousedown",i),x.bind(e.__saturation_field,"touchstart",i),x.bind(e.__field_knob,"mousedown",i),x.bind(e.__field_knob,"touchstart",i),x.bind(e.__hue_field,"mousedown",r),x.bind(e.__hue_field,"touchstart",r),e.__saturation_field.appendChild(t),e.__selector.appendChild(e.__field_knob),e.__selector.appendChild(e.__saturation_field),e.__selector.appendChild(e.__hue_field),e.__hue_field.appendChild(e.__hue_knob),e.domElement.appendChild(e.__input),e.domElement.appendChild(e.__selector),e.updateDisplay(),e}var Mt=["-moz-","-o-","-webkit-","-ms-",""];function Ft(t,n,o,i){t.style.background="",v.each(Mt,function(e){t.style.cssText+="background: "+e+"linear-gradient("+n+", "+o+" 0%, "+i+" 100%); "})}function Dt(e,t){var n=e[t];return v.isArray(arguments[2])||v.isObject(arguments[2])?new _t(e,t,arguments[2]):v.isNumber(n)?v.isNumber(arguments[2])&&v.isNumber(arguments[3])?v.isNumber(arguments[4])?new Pt(e,t,arguments[2],arguments[3],arguments[4],arguments[5]):new Pt(e,t,arguments[2],arguments[3]):v.isNumber(arguments[4])?new Et(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new Et(e,t,{min:arguments[2],max:arguments[3]}):v.isString(n)?new xt(e,t):v.isFunction(n)?new kt(e,t,""):v.isBoolean(n)?new bt(e,t):null}ut(Vt,ht),a(Vt,[{key:"controller",set:function(e){this._controller=e},get:function(){return this._controller}}]);e=Vt;function Vt(e,t){b(this,Vt);var n=dt(this,(Vt.__proto__||Object.getPrototypeOf(Vt)).call(this,e,t));return n.arguments={object:e,property:t,opts:Array.prototype.slice.call(arguments,2)},e.property&&(n.property=e.property(n)),n}var u=function(e,t){var t=t||document,n=document.createElement("style"),e=(n.type="text/css",n.innerHTML=e,t.getElementsByTagName("head")[0]);try{e.appendChild(n)}catch(e){}};var It=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},Rt=(a(jt,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),v.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var e,t=this;x.bind(this.domElement,"webkitTransitionEnd",e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",x.unbind(t.domElement,"webkitTransitionEnd",e),x.unbind(t.domElement,"transitionend",e),x.unbind(t.domElement,"oTransitionEnd",e)}),x.bind(this.domElement,"transitionend",e),x.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-x.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-x.getHeight(this.domElement)/2+"px"}}]),jt);function jt(){b(this,jt),this.backgroundElement=document.createElement("div"),v.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),x.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),v.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;x.bind(this.backgroundElement,"click",function(){e.hide()})}u(function(e){var t;if(e&&"undefined"!=typeof window)return(t=document.createElement("style")).setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var Bt="Default",Ht=function(){try{return!!window.localStorage}catch(e){return!1}}(),Gt=void 0,Ut=!0,Xt=void 0,qt=!1,Wt=[],w=function t(e){var n,o,i,r=this,a=e||{},s=(this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),x.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],a=v.defaults(a,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),a=v.defaults(a,{resizable:a.autoPlace,hideable:a.autoPlace}),v.isUndefined(a.load)?a.load={preset:Bt}:a.preset&&(a.load.preset=a.preset),v.isUndefined(a.parent)&&a.hideable&&Wt.push(this),a.resizable=v.isUndefined(a.parent)&&a.resizable,a.autoPlace&&v.isUndefined(a.scrollable)&&(a.scrollable=!0),Ht&&"true"===localStorage.getItem($t(0,"isLocal"))),l=void 0,c=void 0;function u(e){return e.preventDefault(),n.width+=o-e.clientX,n.onResize(),o=e.clientX,!1}function d(){x.removeClass(n.__closeButton,w.CLASS_DRAG),x.unbind(window,"mousemove",u),x.unbind(window,"mouseup",d)}function p(e){return e.preventDefault(),o=e.clientX,x.addClass(n.__closeButton,w.CLASS_DRAG),x.bind(window,"mousemove",u),x.bind(window,"mouseup",d),!1}Object.defineProperties(this,{parent:{get:function(){return a.parent}},scrollable:{get:function(){return a.scrollable}},autoPlace:{get:function(){return a.autoPlace}},closeOnTop:{get:function(){return a.closeOnTop}},preset:{get:function(){return(r.parent?r.getRoot():a.load).preset},set:function(e){r.parent?r.getRoot().preset=e:a.load.preset=e;for(var t=this,n=0;n<t.__preset_select.length;n++)t.__preset_select[n].value===t.preset&&(t.__preset_select.selectedIndex=n);r.revert()}},width:{get:function(){return a.width},set:function(e){a.width=e,nn(r,e)}},name:{get:function(){return a.name},set:function(e){a.name=e,c&&(c.innerHTML=a.name)}},closed:{get:function(){return a.closed},set:function(e){a.closed=e,a.closed?x.addClass(r.__ul,t.CLASS_CLOSED):x.removeClass(r.__ul,t.CLASS_CLOSED),this.onResize(),r.__closeButton&&(r.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return a.load}},useLocalStorage:{get:function(){return s},set:function(e){Ht&&((s=e)?x.bind(window,"unload",l):x.unbind(window,"unload",l),localStorage.setItem($t(0,"isLocal"),e))}}}),v.isUndefined(a.parent)?(this.closed=a.closed||!1,x.addClass(this.domElement,t.CLASS_MAIN),x.makeSelectable(this.domElement,!1),Ht&&s&&(r.useLocalStorage=!0,e=localStorage.getItem($t(0,"gui")))&&(a.load=JSON.parse(e)),this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,x.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),a.closeOnTop?(x.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(x.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),x.bind(this.__closeButton,"click",function(){r.closed=!r.closed})):(void 0===a.closed&&(a.closed=!0),e=document.createTextNode(a.name),x.addClass(e,"controller-name"),c=Yt(r,e),x.addClass(this.__ul,t.CLASS_CLOSED),x.addClass(c,"title"),x.bind(c,"click",function(e){return e.preventDefault(),r.closed=!r.closed,!1}),a.closed||(this.closed=!1)),a.autoPlace&&(v.isUndefined(a.parent)&&(Ut&&(Xt=document.createElement("div"),x.addClass(Xt,"dg"),x.addClass(Xt,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Xt),Ut=!1),Xt.appendChild(this.domElement),x.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||nn(r,a.width)),this.__resizeHandler=function(){r.onResizeDebounced()},x.bind(window,"resize",this.__resizeHandler),x.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),x.bind(this.__ul,"transitionend",this.__resizeHandler),x.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),a.resizable&&(o=void 0,(n=this).__resize_handle=document.createElement("div"),v.extend(n.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),x.bind(n.__resize_handle,"mousedown",p),x.bind(n.__closeButton,"mousedown",p),n.domElement.insertBefore(n.__resize_handle,n.domElement.firstElementChild)),l=function(){Ht&&"true"===localStorage.getItem($t(0,"isLocal"))&&localStorage.setItem($t(0,"gui"),JSON.stringify(r.getSaveObject()))},this.saveToLocalStorageIfPossible=l,a.parent||((i=r.getRoot()).width+=1,v.defer(function(){--i.width}))};function Yt(e,t,n){var o=document.createElement("li");return t&&o.appendChild(t),n?e.__ul.insertBefore(o,n):e.__ul.appendChild(o),e.onResize(),o}function Zt(e){x.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&x.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function Jt(e,t){e=e.__preset_select[e.__preset_select.selectedIndex];e.innerHTML=t?e.value+"*":e.value}function Kt(e,t){var n=e.getRoot(),o=n.__rememberedObjects.indexOf(t.object);if(-1!==o){var i=n.__rememberedObjectIndecesToControllers[o];if(void 0===i&&(n.__rememberedObjectIndecesToControllers[o]=i={}),i[t.property]=t,n.load&&n.load.remembered){i=n.load.remembered,n=void 0;if(i[e.preset])n=i[e.preset];else{if(!i[Bt])return;n=i[Bt]}n[o]&&void 0!==n[o][t.property]&&(e=n[o][t.property],t.initialValue=e,t.setValue(e))}}}function Qt(e,t,n,o){var i;if(t.arguments&&(t=(i=t).arguments.object,n=i.arguments.property,o={factoryArgs:i.arguments.opts}),void 0===i&&void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var r=void 0,a=(null===(r=o.color?new Lt(t,n):void 0!==i&&"string"==typeof i.property?i:(t=[t,n].concat(o.factoryArgs),Dt.apply(e,t)))?r=i:void 0!==i&&(i.controller=r),o.before instanceof ht&&(o.before=o.before.__li),Kt(e,r),x.addClass(r.domElement,"c"),document.createElement("span"));if(x.addClass(a,"property-name"),void 0!==i&&"object"===st(i.property))for(var s in i.property)a.appendChild(i.property[s]);else a.innerHTML=r.property;var l,c,u,d,n=document.createElement("div"),t=(n.appendChild(a),n.appendChild(r.domElement),Yt(e,n,o.before));return x.addClass(t,w.CLASS_CONTROLLER_ROW),r instanceof Lt?x.addClass(t,"color"):x.addClass(t,st(r.getValue())),l=e,c=t,(u=r).__li=c,u.__gui=l,v.extend(u,{options:function(e){var t;return 1<arguments.length?(t=u.__li.nextElementSibling,u.remove(),Qt(l,u.object,u.property,{before:t,factoryArgs:[v.toArray(arguments)]})):v.isArray(e)||v.isObject(e)?(t=u.__li.nextElementSibling,u.remove(),Qt(l,u.object,u.property,{before:t,factoryArgs:[e]})):void 0},name:function(e){return u.__li.firstElementChild.firstElementChild.innerHTML=e,u},listen:function(){return u.__gui.listen(u),u},remove:function(){return u.__gui.remove(u),u}}),u instanceof Pt?(d=new Et(u.object,u.property,{min:u.__min,max:u.__max,step:u.__step}),v.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(e){var t=u[e],n=d[e];u[e]=d[e]=function(){var e=Array.prototype.slice.call(arguments);return n.apply(d,e),t.apply(u,e)}}),x.addClass(c,"has-slider"),u.domElement.insertBefore(d.domElement,u.domElement.firstElementChild)):u instanceof Et?(u.min=v.compose(n=function(e){var t,n,o;return v.isNumber(u.__min)&&v.isNumber(u.__max)?(t=u.__li.firstElementChild.firstElementChild.innerHTML,n=-1<u.__gui.__listening.indexOf(u),u.remove(),(o=Qt(l,u.object,u.property,{before:u.__li.nextElementSibling,factoryArgs:[u.__min,u.__max,u.__step]})).name(t),n&&o.listen(),o):e},u.min),u.max=v.compose(n,u.max)):u instanceof bt?(x.bind(c,"click",function(){x.fakeEvent(u.__checkbox,"click")}),x.bind(u.__checkbox,"click",function(e){e.stopPropagation()})):u instanceof kt?(x.bind(c,"click",function(){x.fakeEvent(u.__button,"click")}),x.bind(c,"mouseover",function(){x.addClass(u.__button,"hover")}),x.bind(c,"mouseout",function(){x.removeClass(u.__button,"hover")})):u instanceof Lt&&(x.addClass(c,"color"),u.updateDisplay=v.compose(function(e){return c.style.borderLeftColor=u.__color.toString(),e},u.updateDisplay),u.updateDisplay()),u.setValue=v.compose(function(e){return l.getRoot().__preset_select&&u.isModified()&&Jt(l.getRoot(),!0),e},u.setValue),e.__controllers.push(r),r}function $t(e,t){return document.location.href+"."+t}function en(e,t,n){var o=document.createElement("option");o.innerHTML=t,o.value=t,e.__preset_select.appendChild(o),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function tn(e,t){t.style.display=e.useLocalStorage?"block":"none"}function nn(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function on(i,r){var a={};return v.each(i.__rememberedObjects,function(e,t){var n={},o=i.__rememberedObjectIndecesToControllers[t];v.each(o,function(e,t){n[t]=r?e.initialValue:e.getValue()}),a[t]=n}),a}w.toggleHide=function(){qt=!qt,v.each(Wt,function(e){e.domElement.style.display=qt?"none":""})},w.CLASS_AUTO_PLACE="a",w.CLASS_AUTO_PLACE_CONTAINER="ac",w.CLASS_MAIN="main",w.CLASS_CONTROLLER_ROW="cr",w.CLASS_TOO_TALL="taller-than-window",w.CLASS_CLOSED="closed",w.CLASS_CLOSE_BUTTON="close-button",w.CLASS_CLOSE_TOP="close-top",w.CLASS_CLOSE_BOTTOM="close-bottom",w.CLASS_DRAG="drag",w.DEFAULT_WIDTH=245,w.TEXT_CLOSED="Close Controls",w.TEXT_OPEN="Open Controls",w._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||w.toggleHide()},x.bind(window,"keydown",w._keydownHandler,!1),v.extend(w.prototype,{add:function(e,t){return Qt(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return Qt(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;v.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Xt.removeChild(this.domElement);var t=this;v.each(this.__folders,function(e){t.removeFolder(e)}),x.unbind(window,"keydown",w._keydownHandler,!1),Zt(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this},t=(t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]),new w(t)),e=(this.__folders[e]=t,Yt(this,t.domElement));return x.addClass(e,"folder"),t},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],Zt(t);var e=this;v.each(t.__folders,function(e){t.removeFolder(e)}),v.defer(function(){e.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e,t,n=this.getRoot();n.scrollable&&(e=x.getOffset(n.__ul).top,t=0,v.each(n.__ul.childNodes,function(e){n.autoPlace&&e===n.__save_row||(t+=x.getHeight(e))}),window.innerHeight-e-20<t?(x.addClass(n.domElement,w.CLASS_TOO_TALL),n.__ul.style.height=window.innerHeight-e-20+"px"):(x.removeClass(n.domElement,w.CLASS_TOO_TALL),n.__ul.style.height="auto")),n.__resize_handle&&v.defer(function(){n.__resize_handle.style.height=n.__ul.offsetHeight+"px"}),n.__closeButton&&(n.__closeButton.style.width=n.width+"px")},onResizeDebounced:v.debounce(function(){this.onResize()},50),remember:function(){if(v.isUndefined(Gt)&&((Gt=new Rt).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var u=this;v.each(Array.prototype.slice.call(arguments),function(e){var n,t,o,i,r,a,s,l,c;0===u.__rememberedObjects.length&&(t=(n=u).__save_row=document.createElement("li"),x.addClass(n.domElement,"has-save"),n.__ul.insertBefore(t,n.__ul.firstChild),x.addClass(t,"save-row"),(o=document.createElement("span")).innerHTML="&nbsp;",x.addClass(o,"button gears"),(i=document.createElement("span")).innerHTML="Save",x.addClass(i,"button"),x.addClass(i,"save"),(r=document.createElement("span")).innerHTML="New",x.addClass(r,"button"),x.addClass(r,"save-as"),(a=document.createElement("span")).innerHTML="Revert",x.addClass(a,"button"),x.addClass(a,"revert"),s=n.__preset_select=document.createElement("select"),n.load&&n.load.remembered?v.each(n.load.remembered,function(e,t){en(n,t,t===n.preset)}):en(n,Bt,!1),x.bind(s,"change",function(){for(var e=0;e<n.__preset_select.length;e++)n.__preset_select[e].innerHTML=n.__preset_select[e].value;n.preset=this.value}),t.appendChild(s),t.appendChild(o),t.appendChild(i),t.appendChild(r),t.appendChild(a),Ht&&(l=document.getElementById("dg-local-explain"),s=document.getElementById("dg-local-storage"),document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem($t(0,"isLocal"))&&s.setAttribute("checked","checked"),tn(n,l),x.bind(s,"change",function(){n.useLocalStorage=!n.useLocalStorage,tn(n,l)})),c=document.getElementById("dg-new-constructor"),x.bind(c,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||Gt.hide()}),x.bind(o,"click",function(){c.innerHTML=JSON.stringify(n.getSaveObject(),void 0,2),Gt.show(),c.focus(),c.select()}),x.bind(i,"click",function(){n.save()}),x.bind(r,"click",function(){var e=prompt("Enter a new preset name.");e&&n.saveAs(e)}),x.bind(a,"click",function(){n.revert()})),-1===u.__rememberedObjects.indexOf(e)&&u.__rememberedObjects.push(e)}),this.autoPlace&&nn(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var n=this.load;return n.closed=this.closed,0<this.__rememberedObjects.length&&(n.preset=this.preset,n.remembered||(n.remembered={}),n.remembered[this.preset]=on(this)),n.folders={},v.each(this.__folders,function(e,t){n.folders[t]=e.getSaveObject()}),n},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=on(this),Jt(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[Bt]=on(this,!0)),this.load.remembered[e]=on(this),this.preset=e,en(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(t){v.each(this.__controllers,function(e){this.getRoot().load.remembered?Kt(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())},this),v.each(this.__folders,function(e){e.revert(e)}),t||Jt(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&function e(t){0!==t.length&&It.call(window,function(){e(t)});v.each(t,function(e){e.updateDisplay()})}(this.__listening)},updateDisplay:function(){v.each(this.__controllers,function(e){e.updateDisplay()}),v.each(this.__folders,function(e){e.updateDisplay()})}});var rn=e;
/**
 * get position functions library
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function an(e,t){var n=me.THREE,e=e.geometry.attributes.position,n=4<=e.itemSize?new n.Vector4(0,0,0,0):new n.Vector3;return n.fromArray(e.array,t*e.itemSize),n}function sn(e,t){const n=me.THREE;var o,i,r,a,s=t.clone();for(;o=e,i=s,a=r=void 0,r=new n.Vector3,a=new n.Vector3,(r=i.clone()).multiply(o.scale),a.copy(r),a.applyEuler(o.rotation),r.x=a.x,r.y=a.y,r.z=a.z,r.add(o.position),s=r,(e=e.parent)&&e.parent;);return s}function ln(e,t){if(-1!==t)return void 0===t?e.position:sn(e,an(e,t))}
/**
 * node.js version of the synchronous download of the file.
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function cn(t){if(this.loadXMLDoc=function(){var e;if(window.XMLHttpRequest){if(!(e=new XMLHttpRequest))throw"new XMLHttpRequest() failed!"}else{if(!window.ActiveXObject)throw"myRequest.loadXMLDoc(...) failed!";if(!(e=this.NewActiveXObject()))throw"NewActiveXObject() failed!"}return e},this.NewActiveXObject=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}return a('This browser does not support XMLHttpRequest. Probably, your security settings do not allow Web sites to use ActiveX controls installed on your computer. Refresh your Web page to find out the current status of your Web page or enable the "Initialize and script ActiveX controls not marked as safe" and "Run Active X controls and plug-ins" of the Security settings of the Internet zone of your browser.'),null},this.XMLHttpRequestStart=function(e,t){this.XMLHttpRequestStop(),this.req.onreadystatechange=e,"onerror"in this.req&&(this.req.onerror=function(e){a("XMLHttpRequest error. url: "+this.url)}),this.XMLHttpRequestReStart(t)},this.getUrl=function(){return void 0!==this.url&&null!=this.url||a("XMLHttpRequest: Invalid url: "+this.url),this.url+(this.params||"")},this.XMLHttpRequestReStart=function(e){try{void 0===e&&(e=!0),this.req.open("GET",this.getUrl(),e),e&&("timeout"in this.req&&(this.req.timeout=9e4),"ontimeout"in this.req?this.req.ontimeout=function(){a("XMLHttpRequest timeout")}:(clearTimeout(this.timeout_id_SendReq),this.timeout_id_SendReq=setTimeout(function(){a("XMLHttpRequest timeout 2")},9e4))),this.req.send(null)}catch(e){a(e.message+" url: "+this.url)}},this.XMLHttpRequestStop=function(){null!=this.req&&this.req.abort()},this.ProcessReqChange=function(e){var t=this.req;switch(t.readyState){case 4:if("unknown"==typeof t.status)return consoleError('typeof XMLHttpRequest status == "unknown"'),!0;if(200==t.status)return clearTimeout(this.timeout_id_SendReq),e(this);a("Invalid XMLHttpRequest status : "+t.status+" url: "+this.url);break;case 1:case 2:case 3:break;default:throw"processReqChange(); req.readyState = "+t.readyState}return!0},this.processStatus200Error=function(){var e=this.GetElementText("error",!0);return!!e&&(a(e),!0)},this.GetElementText=function(e,t){var n=this.req;if(!n.responseXML)return 1!=t&&a("GetXMLElementText(xmlhttp, "+e+"); xmlhttp.responseXML is null.\nxmlhttp.responseText:\n"+n.responseText),null;var o=n.responseXML.getElementsByTagName(e);if(0==o.length)return 1!=t&&a('GetXMLElementText(xmlhttp, "'+e+'"); element.length == '+o.length),"";for(var i="",r=0;r<o.length;r++)if(void 0===o[r].textContent){if(void 0===o[r].text)return a("GetXMLElementText(xmlhttp, "+e+"); element["+r+"].text) == undefined"),"";""!=i&&(i+=" "),i+=o[r].text}else i+=o[r].textContent;return i},t.data)this.req=t.data.req,this.url=t.data.url,this.params=t.data.params;else try{this.req=this.loadXMLDoc()}catch(e){var n=void 0===e.message?e:e.message;return void a("Your browser is too old and is not compatible with our site.\n\n"+window.navigator.appName+" "+window.navigator.appVersion+"\n\n"+n)}function a(e){console.error(e),t.onerror(e)}this.req||consoleError("Invalid myRequest.req: "+this.req)}function un(t,n){!0===(n=n||{}).async&&console.warn("Load file asynchronously is deprecated. Please use fetch."),n.onload=n.onload||function(){},n.onerror=n.onerror||function(){};var o,e=new cn(n);return e.url=t,e.XMLHttpRequestStart(function(){e.ProcessReqChange(function(e){e.processStatus200Error()||(o=e.req.responseText,n.onload(o,t))})},void 0!==n.async),o}
/**
 * node.js version of the load JavaScript file
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * Thanks to:
 *http://javascript.ru/forum/events/21439-dinamicheskaya-zagruzka-skriptov.html
 *https://learn.javascript.ru/onload-onerror
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function dn(e,t){if(t.tag=t.tag||{},"string"==typeof t.tag){if("style"!==t.tag)return void console.error("Invalid options.tag: "+t.tag);t.tag={name:"style",attribute:{name:"rel",value:"stylesheet"}}}t.tag.name=t.tag.name||"script";var n=document.createElement(t.tag.name);t.tag.attribute=t.tag.attribute||{},t.tag.attribute.name=t.tag.attribute.name||"type",t.tag.attribute.value=t.tag.attribute.value||"text/javascript",n.setAttribute(t.tag.attribute.name,t.tag.attribute.value),e(n),t.appendTo.appendChild(n)}function pn(e,t){for(var n=e.querySelectorAll("script"),o=0;o<n.length;o++)if(n[o].id===t)return 1}a={sync:function(t,n){if((n=n||{}).onload=n.onload||function(){},n.onerror=n.onerror||function(){},n.appendTo=n.appendTo||document.getElementsByTagName("head")[0],pn(n.appendTo,t))n.onload();else if(t instanceof Array){for(var o,i={appendTo:n.appendTo,tag:n.tag,onload:function(e,t){console.log("loadScript.sync.onload: "+t)},onerror:function(e){n.onerror(e),o=e}},e=0;e<t.length;e++){var r=t[e];if(dn(function(e){e.setAttribute("id",r),e.innerHTML=un(r,i)},i),void 0!==o)break}void 0===o&&n.onload()}else dn(function(e){e.setAttribute("id",t),e.innerHTML=un(t,n)},n)},async:function(e,o){var i;function r(t){function n(){e instanceof Array&&i<e.length-1?r(e[++i]):o.onload()}pn(o.appendTo,t,o.onload)?n():dn(function(e){e.setAttribute("id",t),e.readyState&&!e.onload?e.onreadystatechange=function(){"complete"==e.readyState&&void 0!==o.onload&&o.onload(),"loaded"==e.readyState&&(setTimeout(o.onload,0),this.onreadystatechange=null)}:(e.onload=function(){console.log("loadScript.async.onload() "+t),void 0!==o.onload&&n()},e.onerror=function(e){var t='loadScript: "'+this.src+'" failed';void 0!==o.onerror&&o.onerror(t,e),console.error(t)}),e.src=t},o)}(o=o||{}).appendTo=o.appendTo||document.getElementsByTagName("head")[0],o.onload=o.onload||function(){},e instanceof Array?r(e[i=0]):r(e)}};
/**
 * @module ColorPicker
 * @description Pure JavaScript color picker.
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * Thanks to https://github.com/DavidDurman/FlexiColorPicker
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 */var fn,u=(fn=document.currentScript&&""!==document.currentScript.src?document.currentScript.src:""!==(fn=document.getElementsByTagName("script"))[fn.length-1].src?src:(new Error).stack.match(/(https?:[^:]*)/)[0]).substring(0,fn.lastIndexOf("/"));a.sync(u+"/colorpicker.css",{tag:"style"});const mn=window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML",hn="http://www.w3.org/2000/svg";var gn=0;class yn{constructor(){const n=this;function g(e,t,n){for(var o in e=document.createElementNS(hn,e),t)e.setAttribute(o,t[o]);for(var i=0,r=(n="[object Array]"!=Object.prototype.toString.call(n)?[n]:n)[0]&&n.length||0;i<r;i++)e.appendChild(n[i]);return e}this.paletteIndexes={BGYW:0,monochrome:1,bidirectional:2,rainbow:3},this.create=function(e,i){function r(){return"horizontal"===i.orientation}if((i=i||{}).orientation=i.orientation||"horizontal",void 0===i.direction&&(i.direction=!0),i.style=i.style||{},i.style.width=i.style.width||(r()?200:30),i.style.height=i.style.height||(r()?30:200),i.onError=i.onError||function(){},e instanceof HTMLElement!=!0){if("string"!=typeof e)return void console.error("ColorPicker.create: invalid elSliderWrapper = "+e);if(null===(e=document.getElementById(e)))return void console.error("ColorPicker.create: invalid elSliderWrapper = "+e)}for(var t in e.classList.add("slider-wrapper"),i.style)e.style[t]=i.style[t];const o=i.palette instanceof this.palette?i.palette:new this.palette(i);var a,n,s,l;function c(){return"string"==typeof i.style.height?parseInt(i.style.height):i.style.height}function u(){return p.clientWidth}function d(e,t){var n;void 0===a?console.error("Set value of this instance of the ColorPicker is impossible because options.sliderIndicator is not defined."):void 0===(n=o.hsv2rgb(e))?console.error("ColorPicker.setValue: invalud c = "+n):(e=n.percent,void 0===t&&(t=r()?u()*e/100:c()-c()*(i.direction?e:100-e)/100),e=t,void 0!==a&&(r()?e<0||e>u()?console.error("ColorPicker.positionIndicators: Invalid position = "+e):(a.style.top="0px",a.style.left=(i.direction?e:u()-e)-a.offsetWidth/2+"px"):e<0||e>c()?console.error("ColorPicker.positionIndicators: Invalid position = "+e):(a.style.left="0px",a.style.top=e-a.offsetHeight/2+"px")),void 0!==i.sliderIndicator.callback&&i.sliderIndicator.callback(n))}if(void 0!==i.sliderIndicator&&((a=document.createElement("div")).className="slider-indicator",r()?a.style.width="10px":a.style.height="10px",e.appendChild(a),a.style.pointerEvents="none"),"SVG"==mn){try{var p=g("svg",{xmlns:hn,version:"1.1",width:r()?"100%":i.style.width,height:i.style.height},[g("defs",{},g("linearGradient",{id:"gradient-hsv-"+gn,x1:r()&&i.direction?"100%":"0%",y1:r()||i.direction?"0%":"100%",x2:r()&&!i.direction?"100%":"0%",y2:!r()&&i.direction?"100%":"0%"},o.getPalette())),g("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-hsv-"+gn+")"})]);void 0!==a&&(p.style.cursor=r()?"e-resize":"s-resize",a.style.cursor=p.style.cursor)}catch(e){console.error("Create SVG element failed! "+e.message)}e.appendChild(p),e.style.height=c()+"px",void 0!==a&&(r()?a.style.height=parseInt(i.style.height)-2+"px":a.style.width=parseInt(i.style.width)-2+"px",i.sliderIndicator.value=i.sliderIndicator.value||0,d(i.sliderIndicator.value)),gn++}else console.error("Under constraction");function f(e){var t,n,o;e.x=parseInt(e.x),e.y=parseInt(e.y),r()?(t=e.x,n=u()-1,o=100*(t=t>=u()?n:t)/n,i.direction||(o=100-o,t=n-t)):(t=e.y,n=c()-1,o=100*(1-(t=t>=c()?n:t)/n),i.direction||(o=100-o)),d(o,t)}function m(){return function(e){var t;n||(e=e||window.event,f((e=e,window.event&&void 0!==window.event.contentOverflow?{x:window.event.offsetX,y:window.event.offsetY}:void 0!==e.offsetX&&void 0!==e.offsetY?{x:e.offsetX,y:e.offsetY}:(t=e.target.parentNode.parentNode,{x:e.layerX-t.offsetLeft,y:e.layerY-t.offsetTop}))))}}function h(e,t,n){null!==e&&(e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,!1))}return void 0!==a&&(n=!1,h(p,"click",m()),s=m(),h(l=p,"touchstart",function(e){}),h(l,"touchmove",function(e){e.preventDefault();var t=e.srcElement.getBoundingClientRect(),n=e.touches[0].clientX-t.left,e=e.touches[0].clientY-t.top;f({x:n=n<0?0:n,y:e=e<0?0:e})}),h(l,"touchend",function(e){}),h(l,"mousedown",function(e){const n="mouseup",o="mousemove";h(window,n,function e(){function t(e,t,n){null!==e&&(e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener&&e.removeEventListener(t,n,!1))}t(window,n,e),t(window,o,s)}),h(window,o,s)}),h(l,"mouseout",function(e){n=!0}),h(l,"mouseover",function(e){n=!1})),{setValue:d}},this.palette=function(f){function e(e,t,n,o){return{percent:e,r:t,g:n,b:o}}void 0===(f=f||{}).palette&&(f.palette=n.paletteIndexes.BGYW),this.getPaletteIndex=function(){return f.palette};var m=[new e(0,0,0,255),new e(33,0,255,0),new e(66,255,255,0),new e(100,255,255,255)];switch(typeof f.palette){case"number":switch(f.palette){case n.paletteIndexes.BGYW:break;case n.paletteIndexes.monochrome:m=[new e(0,0,0,0),new e(100,255,255,255)];break;case n.paletteIndexes.bidirectional:m=[new e(0,255,48,48),new e(50,48,48,48),new e(100,48,255,48)];break;case n.paletteIndexes.rainbow:m=[new e(0,255,50,50),new e(16,252,245,40),new e(32,40,252,40),new e(50,40,252,248),new e(66,39,46,249),new e(82,255,40,251),new e(100,255,50,50)];break;default:console.error("ColorPicker.create.Palette: invalid options.palette = "+f.palette)}break;case"object":if(Array.isArray(f.palette)){m=f.palette;break}default:var t="invalid options.palette = "+f.palette;console.error("ColorPicker.create.Palette: "+t),f.onError(t)}this.isPalette=function(){return!0},this.getPalette=function(){const t=[];return m.forEach(function(e){t.unshift(g("stop",{offset:100-e.percent+"%","stop-color":"#"+("0"+Number(e.r).toString(16)).slice(-2).toUpperCase()+("0"+Number(e.g).toString(16)).slice(-2).toUpperCase()+("0"+Number(e.b).toString(16)).slice(-2).toUpperCase(),"stop-opacity":"1"}))}),t},this.hsv2rgb=function(e,t,n){var o,i=parseFloat(e),r=(isNaN(i)&&(i=n),void 0!==t&&void 0!==n&&(i=100/(n-t)*(i-t)),m[m.length-1]);if(100!==r.percent){const p={};Object.keys(r).forEach(function(e){p[e]=r[e]}),p.percent=100,m.push(p)}for(var a=0;a<m.length;a++){var s,l,c,u=m[a];function d(e,t,n,o){n-=e;return 0==n?t:Math.round(t+(o-t)/n*(i-e))}if(i>=(o=void 0===o?u:o).percent&&i<=u.percent)return{r:s=d(o.percent,o.r,u.percent,u.r),g:l=d(o.percent,o.g,u.percent,u.g),b:c=d(o.percent,o.b,u.percent,u.b),hex:"#"+(16777216|c|l<<8|s<<16).toString(16).slice(1),percent:i};o=u}void 0!==f.onError&&f.onError("Invalid color value of the ColorPicker: "+e)},this.toColor=function(e,t,n){var o=me.THREE;return e instanceof o.Color?e:(e=this.hsv2rgb(e,t,n),new o.Color("rgb("+(e=void 0===e?{r:255,g:255,b:255}:e).r+", "+e.g+", "+e.b+")"))}}}}var vn=yn=new yn;
/**
 * @module cookie
 * @description node.js version of the cookie.
 * Cookies let you store user information in web pages.
 * @see {@link https://www.w3schools.com/js/js_cookies.asp}
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function bn(){return navigator.cookieEnabled}function _n(e,t,n){bn()?(t=t.toString(),void 0===n&&(n=new Date).setTime(n.getTime()+31536e6),document.cookie=e+"="+t+("undefined"==typeof settings?"":settings)+"; expires="+n.toGMTString(),""===document.cookie&&console.error("document.cookie is empty")):Sn()}function xn(e,t){var n;if(bn())return(e=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)"))?(e=e[2],"number"==(n=typeof t)?(e%1==0?parseInt:parseFloat)(e):"boolean"==n?"true"===e:unescape(e)):void 0===t?"":t;Sn()}function wn(e,t){return JSON.parse(xn(e,JSON.stringify(t)))}function Sn(){console.error("navigator.cookieEnabled = "+navigator.cookieEnabled)}class Tn{constructor(e){this.get=function(e){return e},this.set=function(){},this.getObject=function(e,n,o){o&&Object.keys(o).forEach(function(e){var t=o[e];void 0!==t&&"function"!=typeof t&&(n[e]=JSON.parse(JSON.stringify(t)))})},this.copyObject=function(e,t){return JSON.parse(JSON.stringify(t))},this.setObject=function(){},this.isTrue=function(e){return e}}}var En,S,Cn=Object.freeze({isEnabled:bn,set:_n,setObject:function(e,t){_n(e,JSON.stringify(t))},get:xn,getObject:function(e,t,n){void 0===n&&(n=t),(new Tn).getObject(e,t,wn(e,n))},copyObject:wn,remove:function(e){var t;bn()?((t=new Date).setTime(t.getTime()-1),document.cookie=e+="=; expires="+t.toGMTString()):Sn()},defaultCookie:Tn});
/**
 * node.js version of the cookie.
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
/**
 * @module Localization.
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function An(){return function(){if(navigator){if(void 0!==navigator.languages&&"unknown"!=typeof navigator.languages&&0<navigator.languages.length)return navigator.languages[0];if(navigator.language)return navigator.language;if(navigator.browserLanguage)return navigator.browserLanguage;if(navigator.systemLanguage)return navigator.systemLanguage;if(navigator.userLanguage)return navigator.userLanguage;console.error("getLocale() failed!")}else console.error("getLocale() failed! !navigator");return""}().toLowerCase().match(/([a-z]+)(?:-([a-z]+))?/)[1]}
/**
 * @module CreateFullScreenSettings
 * @description creates functions for resize of the canvas to fullscreen and restore to default size.
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function Pn(o,i,r,a){var s,t,l,c=!1;a.fullScreen=a.fullScreen||{},a.canvasMenu&&(s=a.canvasMenu),a.stereoEffect&&(t=a.stereoEffect),i.setSize(i.domElement.width,i.domElement.height),this.isFullScreen=function(){return c},this.setStereoEffect=function(e){t=e},this.setFullScreen=function(t=!1,n=!1){setTimeout(function(){n&&a.fullScreen.arrayContainersLength&&1<a.fullScreen.arrayContainersLength()&&(t=!0);var e=new o.Vector2;i.getSize(e),(c=t)?void 0!==l&&(i.setSize(l.sizeOriginal.x,l.sizeOriginal.y),i.domElement.style.position=l.position,i.domElement.style.left=l.left,i.domElement.style.top=l.top,i.domElement.style.width=l.width,i.domElement.style.height=l.height):(void 0===l&&(l={sizeOriginal:new o.Vector2,position:i.domElement.style.position,left:i.domElement.style.left,top:i.domElement.style.top,width:i.domElement.style.width,height:i.domElement.style.height},i.getSize(l.sizeOriginal)),i.setSize(window.innerWidth,window.innerHeight),i.domElement.style.position="fixed",i.domElement.style.left=0,i.domElement.style.top=0,i.domElement.style.width="100%",i.domElement.style.height="100%"),void 0!==a.fullScreen.onFullScreenToggle&&a.fullScreen.onFullScreenToggle(c),r.aspect=e.x/e.y,r.updateProjectionMatrix(),c=!c,s&&s.setFullScreenButton&&s.setFullScreenButton(c),Pn.RendererSetSize(i,a.canvasMenu)},0)},this.onclick=function(){return void 0!==t&&parseInt(t.settings.spatialMultiplex)!==T.spatialMultiplexsIndexs.Mono&&(t.settings.spatialMultiplex=T.spatialMultiplexsIndexs.Mono),this.setFullScreen(c),c}}
/**
 * @module SpriteText
 * @description A sprite based text component. Text that always faces towards the camera.
 * @see {@link https://threejs.org/docs/index.html#api/en/objects/Sprite|THREE.Sprite}
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
*/
function he(y,v,b={}){var e=me.THREE;v=v||new e.Vector3(0,0,0);const _=new e.Sprite(new e.SpriteMaterial({map:new e.Texture,sizeAttenuation:void 0!==b.sizeAttenuation&&b.sizeAttenuation})),x=document.createElement("canvas"),w=(_.material.map.minFilter=e.LinearFilter,x.getContext("2d"));return b.name&&(_.name=b.name),_.userData.update=function(){var e,t={},n=(_.parent?On(_.parent,t):b.group&&On(b.group,t),b.textHeight||t.textHeight||.04),o=b.fov||t.fov,i=b.sizeAttenuation||t.sizeAttenuation||!1,r=b.rotation||t.rotation||0,a=b.fontFace||t.fontFace||"Arial",s=b.bold||t.bold||!1,l=b.italic||t.italic||!1,c=b.fontProperties||t.fontProperties||"",u=b.rect||t.rect||{},d=b.fontColor||t.fontColor||"rgba(255, 255, 255, 1)",t=he.getCenter(b.center||t.center,v),p=(void 0!==o&&(n=o*n/50),u.displayRect=u.displayRect||!1,u.borderThickness||5),o=c+(s?"bold ":"")+(l?"italic ":"")+"90px "+a,f=(w.font=o,0),m=1,c=("string"==typeof y?(m=0,(e=y.split(/\r\n|\r|\n/)).forEach(function(e){e=w.measureText(e).width;f<e&&(f=e),m+=1})):f=w.measureText(y).width,f+=2*p);if(x.width=c,x.height=90*m+2*p,w.font=o,u.displayRect&&(w.fillStyle=u.backgroundColor||"rgba(0, 0, 0, 1)",w.strokeStyle=u.borderColor||d,w.lineWidth=p,s=w,a=l=p/2,c=x.width-p,o=x.height-p,u=void 0===u.borderRadius?0:u.borderRadius,s.beginPath(),s.moveTo(l+u,a),s.lineTo(l+c-u,a),s.quadraticCurveTo(l+c,a,l+c,a+u),s.lineTo(l+c,a+o-u),s.quadraticCurveTo(l+c,a+o,l+c-u,a+o),s.lineTo(l+u,a+o),s.quadraticCurveTo(l,a+o,l,a+o-u),s.lineTo(l,a+u),s.quadraticCurveTo(l,a,l+u,a),s.closePath(),s.fill(),s.stroke()),w.fillStyle=d,w.textBaseline="bottom",1<m)for(var h=0;h<e.length;h++){var g=e[h];w.fillText(g,p,x.height-90*(e.length-h-1)-p)}else w.fillText(y,p,x.height-p);_.material.map.image=x,_.material.map.needsUpdate=!0;c=n*m;_.scale.set(c*x.width/x.height,c),_.position.copy(v),_.center=t,_.material.sizeAttenuation=i,_.material.rotation=r,_.material.needsUpdate=!0},_.userData.update(),_.userData.updateText=function(e){y=e;e={};On(_.parent,e),_.userData.update(e)},b.group?b.group.add(_):me.group?me.group.add(_):me.scene&&me.scene.add(_),_.userData.optionsSpriteText=b,_}function On(t,n){for(t.userData.optionsSpriteText&&Object.keys(t.userData.optionsSpriteText).forEach(function(e){void 0===n[e]&&(n[e]=t.userData.optionsSpriteText[e])});t.parent;)On(t=t.parent,n)}Pn.RendererSetSize=function(r,a){r.setSizeOld||(r.setSizeOld=r.setSize,r.setSize=function(e,t,n){r.setSizeOld(e,t,n);const o=r.domElement,i=o.parentElement;setTimeout(function(){i.style.height=o.style.height,i.style.width=o.style.width,i.style.left=o.style.left,i.style.top=o.style.top,i.style.position=o.style.position,a&&a.setSize(e,t)},0)})},he.getCenter=function(e={},t){const n=me.THREE,o=e.canvas||void 0;var i,r=e.canvas?(r=o.width/2,i=o.height/2,(t=(new n.Vector3).copy(t)).project(e.camera),t.x=t.x*r+r,t.y=-t.y*i+i,t):void 0;return e instanceof n.Vector2||"object"==typeof e&&void 0!==e.x&&void 0!==e.y?e:r?new n.Vector2(r.x<o.width/2?0:1,r.y<o.height/2?1:0):new n.Vector2(0,1)},he.updateSpriteTextGroup=function(e){const t=me.THREE;e.children.forEach(function(e){e instanceof t.Sprite&&void 0!==e.userData.update&&e.userData.update(),he.updateSpriteTextGroup(e)})};
/**
 * @module StereoEffect
 * @description Uses dual PerspectiveCameras for Parallax Barrier effects.
 * @see About {@link https://en.wikipedia.org/wiki/Parallax_barrier|Parallax barrier}.
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 * @author {@link http://alteredqualia.com/|alteredq}
 * @author {@link http://mrdoob.com/|mrdoob}
 * @author {@link http://aleksandarrodic.com/|arodic}
 * @author {@link http://fonserbc.github.io/|fonserbc}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
*/
class T{constructor(g,y=new A){if(g){if(!1!==(y=y.boOptions?y:new A(y)).stereoEffect){y.dat.gui&&(y.dat.mouseenter=!1);const S=me.THREE,T=(kn(),y.stereoEffect||(y.stereoEffect={}),y.stereoEffect);var v,b,_,x;function w(t){t=t||{};const n={stereoEffects:"Stereo effects",spatialMultiplexName:"Spatial  multiplex",spatialMultiplexTitle:"Choose a way to do spatial multiplex.",spatialMultiplexs:{Mono:C.Mono,"Side by side":C.SbS,"Top and bottom":C.TaB},eyeSeparationName:"Eye separation",eyeSeparationTitle:"The distance between left and right cameras.",focus:"Focus",focusTitle:"Object distance.",zeroParallaxName:"Zero parallax",zeroParallaxTitle:"Distance to objects with zero parallax.",defaultButton:"Default",defaultTitle:"Restore default stereo effects settings."};var e=void 0===t.getLanguageCode?"en":t.getLanguageCode();return"ru"===e?(n.stereoEffects="Стерео эффекты",n.spatialMultiplexName="Мультиплекс",n.spatialMultiplexTitle="Выберите способ создания пространственного мультиплексирования.",n.spatialMultiplexs={"Моно":C.Mono,"Слева направо":C.SbS,"Сверху вниз":C.TaB},n.eyeSeparationName="Развод камер",n.eyeSeparationTitle="Расстояние между левой и правой камерами.",n.focus="Фокус",n.focusTitle="Расстояние до объекта.",n.zeroParallaxName="Параллакс 0",n.zeroParallaxTitle="Расстояние до объектов с нулевым параллаксом.",n.defaultButton="Восстановить",n.defaultTitle="Восстановить настройки стерео эффектов по умолчанию."):void 0!==t.lang&&t.lang._languageCode==e&&Object.keys(t.lang).forEach(function(e){void 0!==n[e]&&(n[e]=t.lang[e])}),n}this.settings=T,(this.options=y).stereoEffect=this,void 0===T.spatialMultiplex&&(T.spatialMultiplex=C.Mono),T.stereo=new S.StereoCamera,T.stereo.aspect=T.stereoAspect||1,void 0===T.far&&(T.far=(new S.PerspectiveCamera).focus),T.focus=void 0===T.camera?(new S.PerspectiveCamera).focus:(new S.Vector3).distanceTo(T.camera.position),T.zeroParallax=0,T.eyeSep=T.eyeSep||(new S.StereoCamera).eyeSep/10*T.far,void 0!==T.camera&&(T.camera.focus=T.focus),this.setEyeSeparation=function(e){T.stereo.eyeSep=e},this.setEyeSeparation(T.eyeSep),this.getRendererSize=function(){return A.raycaster.EventListeners.getRendererSize(g,T.elParent)},this.render=function(e,t){const n=parseInt(T.spatialMultiplex);T.rememberSize&&!v&&(v=_&&_.getFullScreenSettings?_.getFullScreenSettings(this):new Pn(S,g,t,{canvasMenu:_,stereoEffect:this})),e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld();var o=new S.Vector2,i=(g.getSize(o),g.autoClear&&g.clear(),g.setScissorTest(!0),T.zeroParallax);function r(e){return v&&b!==n&&(b=n,e.setControllerSpatialMultiplex?e.setControllerSpatialMultiplex(n):e.setSpatialMultiplex&&e.setSpatialMultiplex(n),1)}function a(e,t){r(t)&&v.setFullScreen(e)}switch(n){case C.Mono:return g.setScissor(0,0,o.width,o.height),g.setViewport(0,0,o.width,o.height),g.render(e,t),g.setScissorTest(!1),void(y.canvasMenu?r(this):a(!0,this));case C.SbS:var s=o.width/2,l=0+i,c=0,u=s,d=o.height,p=s-i,f=0,m=s,h=o.height;a(!1,this);break;case C.TaB:l=0+i,u=o.width,d=o.height/2,p=(c=0)-i,f=o.height/2,m=o.width,h=o.height/2,a(!1,this);break;default:console.error('THREE.StereoEffect.render: Invalid "Spatial  multiplex" parameter: '+n)}T.stereo.update(t),g.setScissor(l,c,u,d),g.setViewport(l,c,u,d),g.render(e,T.stereo.cameraL),g.setScissor(p,f,m,h),g.setViewport(p,f,m,h),g.render(e,T.stereo.cameraR),g.setScissorTest(!1)},this.gui=function(t={}){var e=t.folder||y.dat.gui;if(!e||!1===y.dat.stereoEffectsGui)return;var n=t.dat||me.dat;(t=void 0===t?{}:t).scale=t.scale||1;const o=y.dat.getCookieName("StereoEffect"),i=w({getLanguageCode:y.getLanguageCode,lang:y.lang}),r={spatialMultiplex:T.spatialMultiplex,eyeSep:(new S.StereoCamera).eyeSep/10*T.far,focus:T.focus,zeroParallax:0};function a(e){e=e==C.Mono?"none":"block";c.domElement.style.display=e,void 0!==s&&(s.__li.style.display=e),f.__li.style.display=e,p.__li.style.display=e}Object.freeze(r),y.dat.cookie.getObject(o,T,r),T.spatialMultiplex=parseInt(T.spatialMultiplex),this.setSpatialMultiplex&&this.setSpatialMultiplex(T.spatialMultiplex);var s,e=e.addFolder(i.stereoEffects);const l=e.add(T,"spatialMultiplex",i.spatialMultiplexs).onChange(function(e){a(e=parseInt(e)),h(o),t.onChangeMode&&t.onChangeMode(e),x&&x.select(e)}),c=(n.controllerNameAndTitle(l,i.spatialMultiplexName,i.spatialMultiplexTitle),this.setControllerSpatialMultiplex=function(e){m=!1,l.setValue(e),m=!0},e.addFolder(i.eyeSeparationName)),u=(n.folderNameAndTitle(c,i.eyeSeparationName,i.eyeSeparationTitle),c.add(new Ze(function(e){T.eyeSep+=e,u.setValue(T.eyeSep)},{settings:{offset:.01},min:1e-4,max:.01,step:1e-4})),n.controllerZeroStep(c,T.stereo,"eyeSep",function(e){T.eyeSep=e,h(o)}));n.controllerNameAndTitle(u,i.eyeSeparationName,i.eyeSeparationTitle),void 0!==T.camera&&(T.camera.focus=T.focus),T.camera&&(s=e.add(T.camera,"focus",r.focus/10,2*r.focus,r.focus/1e3).onChange(function(e){T.focus=e,h(o)}),n.controllerNameAndTitle(s,i.focus,i.focusTitle));var d=(60-400/9)*t.scale+400/9;const p=e.add(T,"zeroParallax",-d,d).onChange(function(e){T.zeroParallax=e,h(o)}),f=(n.controllerNameAndTitle(p,i.zeroParallaxName,i.zeroParallaxTitle),e.add({defaultF:function(e){T.stereo.eyeSep=r.eyeSep,u.setValue(T.stereo.eyeSep),T.camera&&(T.camera.focus=r.focus,s.setValue(T.camera.focus)),T.zeroParallax=r.zeroParallax,p.setValue(T.zeroParallax)}},"defaultF"));n.controllerNameAndTitle(f,i.defaultButton,i.defaultTitle),a(T.spatialMultiplex);var m=!0;function h(e){if(m){const t={};Object.keys(r).forEach(function(e){t[e]=T[e]}),y.dat.cookie.setObject(e,t)}}},this.createCanvasMenuItem=function(e,t){_=e;var t=w({getLanguageCode:(t=t||{}).getLanguageCode,lang:t.lang}),n=Object.keys(t.spatialMultiplexs);x={name:"⚭",title:t.stereoEffects,id:"menuButtonStereoEffects",drop:"up",items:[{name:n[C.Mono],id:"menuButtonStereoEffectsMono",radio:!0,checked:T.spatialMultiplex===C.Mono,spatialMultiplex:C.Mono,onclick:function(e){T.spatialMultiplex=C.Mono}},{name:n[C.SbS],id:"menuButtonStereoEffectsSbS",radio:!0,checked:T.spatialMultiplex===C.SbS,spatialMultiplex:C.SbS,onclick:function(e){T.spatialMultiplex=C.SbS}},{name:n[C.TaB],id:"menuButtonStereoEffectsTaB",radio:!0,checked:T.spatialMultiplex===C.TaB,spatialMultiplex:C.TaB,onclick:function(e){T.spatialMultiplex=C.TaB}}],select:function(t){x.items.forEach(function(e){e.spatialMultiplex!==t||e.checked||e.elName.onclick({target:e.elName})})}},this.setSpatialMultiplex=function(e){x.select(e)},e.menu.push(x)}}}else console.error("StereoEffect: renderer = "+g)}}T.spatialMultiplexsIndexs={Mono:0,SbS:1,TaB:2},Object.freeze(T.spatialMultiplexsIndexs);const C=T.spatialMultiplexsIndexs;function kn(){const d=me.THREE;(new d.Raycaster).setStereoEffect||Object.assign(d.Raycaster.prototype,{setStereoEffect:function(n={}){if(!1===n.stereoEffect)return;n.raycasterEvents=void 0===n.raycasterEvents||n.raycasterEvents;const o=n.camera,i=n.renderer;if(n.raycasterEvents){const u=new d.Vector2;window.addEventListener("mousemove",function(e){u.x=e.clientX/window.innerWidth*2-1,u.y=2*-(e.clientY/window.innerHeight)+1,a.setFromCamera(u,o),a.stereo.onDocumentMouseMove(e)},!1),window.addEventListener("pointerdown",function(e){a.stereo.onDocumentMouseDown(e)},!1)}const r=void 0!==n.stereoEffect?n.stereoEffect:"undefined"!=typeof effect?effect:new T(i,n.options),a=this,s=new d.Vector2,l=new d.Vector2;var c,u;this.stereo={onDocumentMouseMove:function(e){function t(){A.raycaster.intersectionsInOut(c,a,i,u,n)}void 0!==c&&(e.preventDefault(),void 0===u&&(u=new d.Vector2),function(){function e(e,t){s.copy(u),l.copy(u);s[e]+=.5,s[e]*=2,l[e]-=.5,l[e]*=2;e=new d.Vector2,i.getSize(e),e=r.settings.zeroParallax/e.x*t;s.x-=e,l.x+=e}switch(r.getRendererSize().getMousePosition(u,event),parseInt(r.settings.spatialMultiplex)){case C.Mono:return;case C.SbS:e("x",4);break;case C.TaB:e("y",2);break;default:console.error("THREE.Raycaster.setStereoEffect.getMousePosition: Invalid effect.settings.spatialMultiplex = "+effect.settings.spatialMultiplex)}}(),void 0!==u)&&(parseInt(r.settings.spatialMultiplex)!==C.Mono?(e=u,u=s,a.setFromCamera(s,o),t(),u=l,a.setFromCamera(l,o),t(),u=e):(a.setFromCamera(u,o),t()))},isAddedToParticles:function(e){return!!c&&c.includes(e)},addParticle:function(e){void 0===c&&(c=[]),this.isAddedToParticles(e)?console.error('Duplicate particle "'+e.name+'"'):c.push(e)},addParticles:function(e){var t;void 0!==c?(Array.isArray(c)||(t=c,(c=[]).push(t)),c.push(e)):c=e},removeParticle:function(e){for(var t=0;t<c.length;t++)if(Object.is(e,c[t])){c.splice(t,1);break}},removeParticles:function(){c=void 0},getPosition:function(e){var t=e.object.geometry.attributes.position,n=4<=t.itemSize?new d.Vector4(0,0,0,0):new d.Vector3;return void 0!==e.index?(n.fromArray(t.array,e.index*t.itemSize),n.multiply(e.object.scale),n.add(e.object.position)):n=e.object.position,n}}}})}T.assign=kn;const zn={mesh:"Mesh",pointName:"Point Name",color:"Сolor",opacity:"Opacity"};
/**
 * View and edit some parameters on the web page.
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 * Thanks to https://stackoverflow.com/a/11900218/5175935
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
function Ln(t,e,n,o){var i;t&&("string"==typeof t.controller&&(i=t.controller,t.controller=document.getElementById(t.controller),t.controller||console.warn('createController: invalid settings.controller = "'+i+'"')),t.controller||(null===t.controller&&console.warn("createController: invalid settings.controller = "+t.controller),(i=document.getElementById(e))||(i=document.createElement(o.elementName||"input"),document.querySelector("body").appendChild(i)),t.controller=i),void 0!==o.value&&(e=o.value,void 0!==t.controller.value?t.controller.value=e:t.controller.innerHTML=e),void 0!==o.onchange&&null===t.controller.onchange&&(t.controller.onchange=o.onchange),void 0!==o.title&&""===t.controller.title&&(t.controller.title=o.title),t.elSlider&&("string"==typeof t.elSlider&&(i=t.elSlider,t.elSlider=document.getElementById(t.elSlider),t.elSlider||console.warn('createController: invalid settings.elSlider = "'+i+'"')),t.elSlider&&!0!==t.elSlider||(o.axisName&&(t.elSlider=document.getElementById(o.axisName+"Slider")),t.elSlider)||(t.elSlider=document.createElement("div"),(t.controller?t.controller.parentElement:document.querySelector("body")).appendChild(t.elSlider)),t.boSetValue=!0,t.colorpicker||(t.colorpicker=vn.create(t.elSlider,{duplicate:!0,sliderIndicator:{callback:function(e){!t.boSetValue&&t.controller&&(e=e.percent/100,t.controller.onchange({currentTarget:{value:e}}),t.controller.value=e)},value:100*o.value},style:{border:"1px solid black",width:t.controller.clientWidth+"px",height:t.controller.clientHeight+"px"},onError:function(e){alert("Horizontal Colorpicker with slider indicator error: "+e)}})),void 0!==o.value)&&(100<(e=(e=100*o.value)<0?0:e)&&(e=100),t.boSetValue=!0,t.colorpicker.setValue(e),t.boSetValue=!1),!1!==t.elName)&&(null===t.elName&&console.warn("createController: invalid settings.elName = "+t.elName),"string"==typeof t.elName&&(i=t.elName,t.elName=document.getElementById(t.elName),t.elName||console.warn('createController: invalid settings.elName = "'+i+'"')),e="",t.elName||(o.axisName&&(t.elName=document.getElementById(o.axisName+"Name")),t.elName)||(t.elName=document.createElement("span"),t.controller.parentElement.insertBefore(t.elName,t.controller),e=" = "),""===t.elName.innerHTML)&&(t.elName.innerHTML=n()+e)}
/**
 * options of the canvas
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */"ru"===An()&&(zn.mesh="3D объект",zn.pointName="Имя точки",zn.color="Цвет",zn.opacity="Непрозрачность"),T.getTextIntersection=function(e,t){var n,o,i,r,a,s,l,c=A.findSpriteTextIntersection(t.spriteOptions.group);return c||(c=me.THREE,n=ln(e.object,e.index),o=t.scales||{},s=void 0===(r=(i=void 0!==e.index&&void 0!==e.object.userData.player&&void 0!==e.object.userData.player.arrayFuncs)?e.object.userData.player.arrayFuncs:void 0)||"function"==typeof r?void 0:r[e.index],a=i&&s?s.name:void 0,s=i&&void 0!==s?Array.isArray(s.w)?Player.execFunc(s,"w",group.userData.t,t):s.w:void 0,e.object.userData.onIntersection&&e.object.userData.onIntersection(),l=!o.x&&!o.y&&!o.z,t.spriteOptions.name=A.findSpriteTextIntersection.spriteTextIntersectionName,t.spriteOptions.name=A.findSpriteTextIntersection.spriteTextIntersectionName,new he(zn.mesh+": "+(""===e.object.name?e.object.type:e.object.name)+(void 0===a?"":"\n"+zn.pointName+": "+a)+(!l&&!o.x||o.x&&!o.x.isAxis()?"":"\n"+(o.x&&o.x.name||0===o.x.name?o.x.name:"X")+": "+n.x)+(!l&&!o.y||o.y&&!o.y.isAxis()?"":"\n"+(o.y&&o.y.name||0===o.y.name?o.y.name:"Y")+": "+n.y)+(!l&&!o.z||o.z&&!o.z.isAxis()?"":"\n"+(o.z&&o.z.name||0===o.z.name?o.z.name:"Z")+": "+n.z)+(i&&(r[e.index]instanceof c.Vector4||r[e.index]instanceof c.Vector3||"function"==typeof r)?s instanceof c.Color?"\n"+zn.color+": "+new c.Color(s.r,s.g,s.b).getHexString():void 0!==n.w?"\n"+(o.w&&o.w.name?o.w.name:"W")+": "+n.w:"":"")+(void 0===e.object.geometry.attributes.ca||e.object.geometry.attributes.ca.itemSize<4?"":"\n"+zn.opacity+": "+(new c.Vector4).fromArray(e.object.geometry.attributes.ca.array,e.index*e.object.geometry.attributes.ca.itemSize).w)+(e.object.userData.raycaster&&e.object.userData.raycaster.text?e.object.userData.raycaster.text(e):""),e.pointSpriteText||e.point,t.spriteOptions))};class A{constructor(r){const i=this;if((r=r||{}).boOptions)return r;var a,e;void 0===r.a&&(r.a=1),void 0===r.b&&(r.b=0),this.setW=function(e){(e=e||r).scales=e.scales||{};e.scales.w;e.palette||i.setPalette()},r.scales=r.scales||{};const t=!r.scales.x&&!r.scales.y&&!r.scales.z;function n(e){t&&(r.scales[e]=r.scales[e]||{}),r.scales[e]}for(e in n("x"),n("y"),n("z"),r.point=r.point||{},void 0===r.point.size&&(r.point.size=5),r.point.sizePointsMaterial=r.point.sizePointsMaterial||100,this.setPalette=function(e){e?r.palette=e:r.palette||(r.palette=new vn.palette)},this.createOrbitControls=function(e,t,n){var o;!1!==r.orbitControls&&(o=r.orbitControls||{},i.orbitControls=new me.OrbitControls(e,t.domElement),void 0!==o.enableRotate&&(i.orbitControls.enableRotate=o.enableRotate),i.orbitControls.target.set(2*n.position.x,2*n.position.y,2*n.position.z),i.orbitControls.saveState(),i.orbitControls.update(),i.frustumPoints)&&i.orbitControls.addEventListener("change",function(){i.frustumPoints.onChangeControls()})},this.restoreSceneController=function(t,n){if(me.dat&&!1!==r.dat){var e={defaultButton:"Default",defaultTitle:"Reset player and restore camera position."};"ru"===this.getLanguageCode()&&(e.defaultButton="Восстановить",e.defaultTitle="Восстановить положение камеры и проигрывателя.");const o=(new me.THREE.Vector3).copy(n.position),i=(new me.THREE.Vector3).copy(t.position);me.dat.controllerNameAndTitle(r.dat.gui.add({defaultF:function(e){r.player&&r.player.selectScene(r.playerOptions.selectSceneIndex),t.position.copy(i),n.position.copy(o),!1!==r.orbitControls&&(r.orbitControls.target=new me.THREE.Vector3,r.orbitControls.object.position.copy(t.position),r.orbitControls.update())}},"defaultF"),e.defaultButton,e.defaultTitle)}},Object.defineProperties(this,{playerOptions:{get:function(){r.playerOptions=r.playerOptions||{};var e=r.playerOptions;if(e.min=e.min||0,e.max===1/0&&(e.max=null),null!==e.max?(void 0===e.max&&(e.max=1),e.marks=e.marks||10):e.marks=null,null===e.max?e.dt=e.dt||.1:e.dt=(e.max-e.min)/(e.marks-1),e.repeat=e.repeat||!1,e.interval=e.interval||1,e.zoomMultiplier=e.zoomMultiplier||1.1,e.offset=e.offset||.1,e.name=e.name||"",!e.cameraTarget){const t=new ge.cameraTarget;Object.defineProperties(e,{cameraTarget:{get:function(){return t}}})}return r.playerOptions},set:function(e){r.playerOptions=e}},a:{get:function(){return r.a}},b:{get:function(){return r.b}},dat:{get:function(){return!1!==r.dat&&(r.dat=new class{constructor(t){if((t=t||{}).boDat)return t;for(var e in Object.defineProperties(this,{boDat:{get:function(){return!0}},dat:{get:function(){return console.warn("get dat depreacated. Use three.dat = dat."),me.dat},set:function(e){console.warn("Set dat depreacated. Use three.dat = dat."),e.dat&&e.dat.constructor.name===e.constructor.name&&"Object"!==e.dat.constructor.name&&console.error("duplicate dat."),e.dat=e}},cookieName:{get:function(){return t.cookieName}},gui:{get:function(){var e;return!t.gui&&me.dat&&(t.gui=new me.dat.GUI,r.dat.parent)&&(e=document.createElement("div"),t.parent.appendChild(e),e.appendChild(t.gui.domElement),e.style.position="absolute",e.style.top="0px",e.style.right="0px"),t.gui}},cookie:{get:function(){return t.cookie},set:function(e){t.cookie=e}},guiSelectPoint:{get:function(){return t.guiSelectPoint},set:function(e){t.guiSelectPoint=e}},cameraGui:{get:function(){return t.cameraGui},set:function(e){t.cameraGui=e}},playerGui:{get:function(){return t.playerGui}},orbitControlsGui:{get:function(){return t.orbitControlsGui}},axesHelperGui:{get:function(){return t.axesHelperGui}},playController:{get:function(){return t.playController}},stereoEffectsGui:{get:function(){return t.playController}},moveScene:{get:function(){return t.moveScene}},spriteTextGui:{get:function(){return t.spriteTextGui}},folderPoint:{get:function(){return t.folderPoint},set:function(e){t.folderPoint=e}},pointLightGui:{get:function(){return t.pointLightGui}},parent:{get:function(){return t.parent}}}),t)void 0===this[e]&&console.error("Dat: dat."+e+" key is hidden")}}(r.dat),r.dat.gui&&(setTimeout(function(){const t=r.dat.gui.domElement.className;var n=0;r.dat.gui.domElement.parentElement.childNodes.forEach(function(e){e.className===t&&n++}),1<n&&console.error("Options: duplicate dat.GUI")},0),r.dat.gui.domElement.addEventListener("mouseenter",function(e){r.dat.mouseenter=!0}),r.dat.gui.domElement.addEventListener("mouseleave",function(e){r.dat.mouseenter=!1})),!1===r.dat.cookie?r.dat.cookie=new Cn.defaultCookie:void 0===r.dat.cookie&&(r.dat.cookie=Cn),r.dat.getCookieName=function(e=""){var t=r.dat.cookieName||(r.elContainer?"object"==typeof r.elContainer?r.elContainer.id:"string"==typeof r.elContainer?r.elContainer:"":"");return e+(""!==e&&""!==t?"_":"")+t}),r.dat},set:function(e){r.dat=e}},getLanguageCode:{get:function(){return"string"==typeof r.getLanguageCode?function(){return r.getLanguageCode}:r.getLanguageCode||An}},scales:{get:function(){return r.scales.boScales||(r.scales=new class{constructor(t){class n{constructor(t,n){let o=t[n];this.isAxis=function(){return!(t&&(t.x||t.y||t.z)&&!o)};const i=e=>{o||(t[n]={},o=t[n]),e(),o.step=Math.abs(r.scales.w.min-r.scales.w.max)/100,r.guiSelectPoint&&r.guiSelectPoint.setAxisControl("w",o)};for(var e in Object.defineProperties(this,{boScale:{get:function(){return!0}},min:{get:function(){return o&&o.min?o.min:"w"===n?0:-1},set:e=>{i(()=>{o.min=e})}},max:{get:function(){return o&&o.max?o.max:"w"===n?(new me.THREE.Vector4).w:1},set:e=>{i(()=>{o.max=e})}},name:{get:function(){return o&&void 0!==o.name?o.name:n},set:function(e){o&&(o.name=e,r.guiSelectPoint)&&r.guiSelectPoint.setAxisName(n,e)}},marks:{get:function(){if(o)return o.marks||(o.marks=3),o.marks}}}),o)void 0===this[e]&&console.error("Options.Scales: scale."+e+" key is hidden")}}const o={x:new n(r.scales,"x"),y:new n(r.scales,"y"),z:new n(r.scales,"z"),w:new n(r.scales,"w")};for(var e in Object.defineProperties(this,{boScales:{get:function(){return!0}},x:{get:function(){return o.x},set:function(e){void 0===e?(delete t.x,delete o.x,o.x=new n(t,"x")):t.x=e,r.guiSelectPoint&&r.guiSelectPoint.updateScale("x")}},y:{get:function(){return o.y},set:function(e){void 0===e?(delete t.y,delete o.y,o.y=new n(t,"y")):t.y=e,r.guiSelectPoint&&r.guiSelectPoint.updateScale("y")}},z:{get:function(){return o.z},set:function(e){void 0===e?(delete t.z,delete o.z,o.z=new n(t,"z")):t.z=e,r.guiSelectPoint&&r.guiSelectPoint.updateScale("z")}},w:{get:function(){return o.w},set:function(e){t.w=e}},setW:{get:function(){return i.setW}},display:{get:function(){return void 0===t.display&&(t.display=!0),t.display},set:function(e){t.display=e}},text:{get:function(){return void 0===t.text&&(t.text={}),t.text},set:function(e){t.text=e}},posAxesIntersection:{get:function(){return t.posAxesIntersection},set:function(e){t.posAxesIntersection=e}}}),t)void 0===this[e]&&console.error("Options: scales."+e+" key is hidden")}}(r.scales)),r.scales},set:function(e){r.scales=e}},palette:{get:function(){switch(void 0===r.palette&&(r.palette=!0),typeof r.palette){case"number":r.palette=new vn.palette({palette:r.palette});break;case"boolean":r.palette&&(r.palette=new vn.palette);break;case"string":var e=new me.THREE.Color(r.palette);r.palette=new vn.palette({palette:[{percent:0,r:255*e.r,g:255*e.g,b:255*e.b}]});break;default:Array.isArray(r.palette)?r.palette=new vn.palette({palette:r.palette}):r.palette.isPalette()||console.error("MyThree: invalid typeof options.palette: "+typeof r.palette)}return r.palette}},boOptions:{get:function(){return!0}},point:{get:function(){return{get size(){return r.point.size},set size(e){r.point.size!==e&&(r.point.size=e,r.dat)&&r.dat.folderPoint&&r.dat.folderPoint.size.setValue(e)},get sizePointsMaterial(){return r.point.sizePointsMaterial},set sizePointsMaterial(e){r.point.sizePointsMaterial=e}}}},spriteText:{get:function(){return r.spriteText||{}}},raycaster:{get:function(){if(r.raycaster)return r.raycaster},set:function(e){r.raycaster=e}},camera:{get:function(){return r.camera=r.camera||{},r.camera.position||(r.camera.position=new me.THREE.Vector3(.4,.4,2)),r.camera.scale||(r.camera.scale=new me.THREE.Vector3(1,1,1)),r.camera},set:function(e){r.camera=e}},cameraTarget:{get:function(){return r.cameraTarget}},cameraTarget:{get:function(){return r.cameraTarget}},elContainer:{get:function(){return r.elContainer}},canvasMenu:{get:function(){return r.canvasMenu},set:function(e){r.canvasMenu&&!0!==r.canvasMenu&&!1!==r.canvasMenu&&console.warn("Duplicate canvasMenu"),r.canvasMenu=e}},canvasMenu:{get:function(){return r.canvasMenu},set:function(e){r.canvasMenu&&console.error("duplicate canvasMenu."),r.canvasMenu=e}},canvas:{get:function(){return r.canvas||{fullScreen:!0}}},frustumPoints:{get:function(){return r.frustumPoints},set:function(e){r.frustumPoints&&r.frustumPoints.constructor.name===e.constructor.name&&"Object"!==r.frustumPoints.constructor.name&&console.error("duplicate frustumPoints."),r.frustumPoints=e}},stereoEffect:{get:function(){return r.stereoEffect},set:function(e){r.stereoEffect&&r.stereoEffect.constructor.name===e.constructor.name&&"Object"!==r.stereoEffect.constructor.name&&console.error("duplicate stereoEffect."),r.stereoEffect=e}},player:{get:function(){return r.player},set:function(e){r.player&&console.error("duplicate player."),r.player=e}},time:{get:function(){return r.player?r.player.getTime():0}},axesHelper:{get:function(){return r.axesHelper},set:function(e){r.axesHelper&&console.error("duplicate axesHelper."),r.axesHelper=e}},orbitControls:{get:function(){return r.orbitControls},set:function(e){r.orbitControls&&r.orbitControls.constructor.name===e.constructor.name&&"Object"!==r.orbitControls.constructor.name&&console.error("duplicate orbitControls."),r.orbitControls=e}},scale:{get:function(){return 1}},pointLight:{get:function(){return r.pointLight}},eventListeners:{get:function(){if(r.eventListeners)return r.eventListeners},set:function(e){r.eventListeners&&console.error("duplicate eventListeners."),r.eventListeners=e}},guiSelectPoint:{get:function(){return r.guiSelectPoint},set:function(e){r.guiSelectPoint&&null!=e&&console.error("duplicate guiSelectPoint."),r.guiSelectPoint=e}},controllers:{get:function(){var e,t,n,o,i;return void 0===En&&(En=!0,e=document.getElementById("time"),t=document.getElementById("prev"),n=document.getElementById("play"),o=document.getElementById("next"),i=!!(t||n||o),!r.controllers&&(e||i)&&(r.controllers={t:{}},e)&&(r.controllers.t.controller=e),r.controllers)&&(!r.controllers.player&&i&&(r.controllers.player={}),r.controllers.player)&&(!r.controllers.player.buttonPrev&&t&&(r.controllers.player.buttonPrev=t),!r.controllers.player.buttonPlay&&n&&(r.controllers.player.buttonPlay=n),!r.controllers.player.buttonNext)&&o&&(r.controllers.player.buttonNext=o),r.controllers&&!r.controllers.boControllers&&(r.controllers=new class{constructor(t){for(var e in t=t||{},Object.defineProperties(this,{boControllers:{get:function(){return!0}},t:{get:function(){null===t.t&&console.error("options.controllers.t = "+t.t);var e=document.getElementById("time");if(!t.t){if(!e)return;t.t={elName:document.getElementById("tName")}}return!t.t.controller&&e&&(t.t.controller=e),t.t&&(Ln(t.t,"t",function(){return r.playerOptions&&r.playerOptions.name?r.playerOptions.name:"t"},{onchange:function(e){r.player?!1===r.player.setTime(t.t.controller.value)&&(alert(a.timeAlert+t.t.controller.value),t.t.controller.focus()):console.error("options.controllers.t.onchange: create Player instance first. "+t.t.value)}}),void 0!==a)&&""===t.t.controller.title&&(t.t.controller.title=a.controllerTTitle),t.t}},player:{get:function(){return t.player}}}),t)void 0===this[e]&&console.error("Controllers: controllers."+e+" key is hidden")}}(r.controllers)),r.controllers}},title:{get:function(){return r.title}}}),r)void 0===this[e]&&console.error("Options: options."+e+" key is hidden");this.playerOptions.cameraTarget.init(this.cameraTarget,this,!1),a={timeAlert:"Invalid time fromat: ",controllerTTitle:"Current time."},"ru"===this.getLanguageCode()?(a.timeAlert="Неправильный формат времени: ",a.controllerTTitle="Текущее время."):void 0!==r.lang&&r.lang.languageCode==languageCode&&Object.keys(r.lang).forEach(function(e){void 0!==a[e]&&(a[e]=r.lang[e])}),me.options||(me.options=this)}}A.findSpriteTextIntersection=function(e){var t;return e.children.forEach(function(e){"Sprite"===e.type&&e.name===A.findSpriteTextIntersection.spriteTextIntersectionName&&(t=e)}),t},A.findSpriteTextIntersection.spriteTextIntersectionName="spriteTextIntersection";A.raycaster=new class{constructor(){var l,u;this.onIntersection=function(e,t,n,o,i){var r,a,s=i.domElement;void 0!==e.object.userData.isInfo&&!e.object.userData.isInfo()||((r=A.findSpriteTextIntersection(n))&&(!e.pointSpriteText||e.object.userData.raycaster&&e.object.userData.raycaster.text)&&(n.remove(r),r=void 0),void 0===r?((a=(t=new A(t)).spriteText.rect?JSON.parse(JSON.stringify(t.spriteText.rect)):{}).displayRect=!0,a.backgroundColor="rgba(0, 0, 0, 1)",(r=T.getTextIntersection(e,{scales:t.scales,spriteOptions:{textHeight:t.spriteText.textHeight,fontColor:t.spriteText.fontColor,rect:a,group:n,center:{camera:o,canvas:s}}})).scale.divide(n.scale),n.add(r),void 0===l&&(l=i.domElement.style.cursor),i.domElement.style.cursor="pointer"):e.pointSpriteText&&r.position.copy(e.pointSpriteText))},this.onIntersectionOut=function(e,t){var n=!1;do{var o=A.findSpriteTextIntersection(e)}while(void 0!==o&&(e.remove(o),n&&console.error("Duplicate spriteTextIntersection"),n=!0),void 0!==o);t.domElement.style.cursor=l},this.onMouseDown=function(e,t){void 0!==e.object.userData.isInfo&&!e.object.userData.isInfo()||(t.guiSelectPoint?t.guiSelectPoint.select(e):(e.object.userData.onMouseDown&&e.object.userData.onMouseDown(e),t.axesHelper&&t.axesHelper.exposePosition(e)))};const s=[];this.intersectionsInOut=function(e,o,i,r,a={}){return(u=void 0!==e?Array.isArray(e)?o.intersectObjects(e):o.intersectObject(e):u).forEach(function(t){var e=window.__myThree__.three,n=(t.pointSpriteText=new e.THREE.Vector3,a.options.stereoEffect&&a.options.stereoEffect.settings.spatialMultiplex===T.spatialMultiplexsIndexs.Mono?o.ray.at(e.options.camera.near+(e.options.camera.far-e.options.camera.near)/1e3,t.pointSpriteText):t.pointSpriteText=t.point,!1);s.forEach(function(e){e.object===t.object&&(n=!0)}),n||s.push(t),t&&t.object.userData.raycaster&&t.object.userData.raycaster.onIntersection?t.object.userData.raycaster.onIntersection(t,r):a.scene?A.raycaster.onIntersection(t,a.options,a.scene,a.camera,i):console.error("THREE.Raycaster.setStereoEffect(): settings.scene = "+a.scene)}),s.forEach(function(t){var n=!1;u.forEach(function(e){t.object===e.object&&(n=!0)}),n||(t.object.userData.raycaster&&t.object.userData.raycaster.onIntersectionOut?t.object.userData.raycaster.onIntersectionOut():a.scene&&A.raycaster.onIntersectionOut(a.scene,i),s.splice(s.findIndex(e=>e===t),1))}),u},this.EventListeners=class{constructor(n,o,i={}){var r;const e=me.THREE,a=new e.Vector2,s=[],l=new e.Raycaster,c=i.options||{};l.params.Points.threshold=void 0!==i.threshold?i.threshold:.03,l.params.Line.threshold=l.params.Points.threshold,l.setStereoEffect&&l.setStereoEffect({options:i.options,renderer:o,camera:n,scene:i.scene,stereoEffect:c.stereoEffect,raycasterEvents:!1});var t=c.renderer?c.renderer.domElement:window;t.addEventListener("mousemove",function(e){var t;void 0!==l.stereo?l.stereo.onDocumentMouseMove(e):(A.raycaster.EventListeners.getRendererSize(o).getMousePosition(a,e),l.setFromCamera(a,n),(u=l.intersectObjects(s))&&(0===u.length?r&&(r.userData.raycaster&&r.userData.raycaster.onIntersectionOut?r.userData.raycaster.onIntersectionOut():A.raycaster.onIntersectionOut(i.scene,o),r=void 0):((t=(e=u[0]).object).userData.raycaster&&t.userData.raycaster.onIntersection?t.userData.raycaster.onIntersection(e,a):A.raycaster.onIntersection(e,c,i.scene,n,o),r=t)))},!1),t.addEventListener("pointerdown",function(e){var t;void 0!==l&&u&&0<u.length&&((t=u[0]).object.userData.raycaster&&t.object.userData.raycaster.onMouseDown?t.object.userData.raycaster.onMouseDown(t,e):A.raycaster.onMouseDown(t,c))},!1),this.addParticle=function(e){var t;e.userData.boFrustumPoints||(l.stereo?l.stereo.addParticle(e):(t=e,s.includes(t)?console.error('Duplicate particle "'+e.name+'"'):s.push(e)))},this.removeParticle=function(e){e.userData.boFrustumPoints||(l.stereo?l.stereo.removeParticle(e):-1!==(e=s.indexOf(e))&&s.splice(e,1))}}static getRendererSize(e,t){(t=t||e.domElement).style.position,t.style.left,t.style.top,t.style.width,t.style.height;const n=t.getBoundingClientRect(),o=Math.round(n.left),i=Math.round(n.top),r=new me.THREE.Vector2;return e.getSize(r),{getMousePosition:function(e,t){e.x=t.clientX/r.x*2-1-o/r.x*2,e.y=2*-(t.clientY/r.y)+1+i/r.y*2}}}}}};
/**
 * @module Player
 * @description 3D objects animation.
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
class ge{constructor(n,v={}){k(),!v.options&&v.frustumPoints&&(v.options=v.frustumPoints.getOptions()),v.options=v.options||new A;const b=v.options;if(!b.boOptions)return void console.error("Player: call options = new Options( options ) first");if(!1===b.player)return;if(b.boPlayer=b.boPlayer||!1,b.player)return void console.error("Player: duplicate player.");function t(e){e=e||0;var t=i.getTime();ge.selectPlayScene(n,{t:t,index:e,options:v.options}),i.setIndex(e,(""===b.playerOptions.name?"":b.playerOptions.name+": ")+t),v.onSelectScene&&(i.selectScenePause=v.onSelectScene(e,t)),b.frustumPoints&&b.frustumPoints.updateCloudPoints()}b.player=this,v.cameraTarget=v.cameraTarget||{},setTimeout(function(){t()},0),b.playerOptions.selectSceneIndex=b.playerOptions.selectSceneIndex||0;var o=b.playerOptions.selectSceneIndex;const i=this;this.getTime=function(){var e=b.playerOptions,t=e.min+o*e.dt;return isNaN(t)&&console.error("Player.getTime(): t = "+t),null!==e.max&&t>e.max&&console.error("Player.getTime(): t = "+t+" playerOptions.max = "+e.max),t<e.min&&null!==e.max&&console.error("Player.getTime(): t = "+t+" playerOptions.min = "+e.min),t},this.setTime=function(e){return this.selectScene(parseInt((e-b.playerOptions.min)/b.playerOptions.dt))},this.selectScene=function(e){if(void 0===e)t(o);else{if(isNaN(e))return console.error("Player.selectScene: index = "+e),!1;for(e=parseInt(e),null!==b.playerOptions.max&&(e>=b.playerOptions.marks?e=0:e<0&&(e=b.playerOptions.marks-1),o>b.playerOptions.marks)&&(o=b.playerOptions.marks);o!==e;)o<e?o++:o--,t(o)}return!0},this.next=function(){i.selectScene(o+1)},this.prev=function(){i.selectScene(o-1)},this.pushController=function(e){void 0!==e.object&&void 0!==e.object.playRate&&(e.object.playRate=b.playerOptions.min),this.controllers.push(e)};var r,a,s,d=!(this.controllers=[]);function e(){b.player.controllers.forEach(function(e){e.onRenamePlayButtons&&e.onRenamePlayButtons(d)})}function l(){d=!1,e(),r=void 0}function c(){if(o++,null!==b.playerOptions.max&&o>=b.playerOptions.marks){if(!b.playerOptions.repeat)return o=b.playerOptions.marks-1,void l();o=0}t(o=-1===o||o===b.playerOptions.marks&&null!==b.playerOptions.max?0:o)}function u(e){if(!(i.selectScenePause||(d?window.requestAnimationFrame(u):r=void 0,void 0===r&&(a=(r=e)+1e3/b.playerOptions.interval),!isNaN(a)&&a!==1/0||(console.error("Player.animate: timeNext = "+a),d=!1),e<a))){for(;a<e;)a+=1e3/b.playerOptions.interval;c()}}this.play3DObject=function(){d?l():(d=!0,null!==b.playerOptions.max&&o>=b.playerOptions.marks-1&&(o=0),c(),e(),window.requestAnimationFrame(u))},this.continue=()=>{i.selectScenePause=!1,window.requestAnimationFrame(u)},this.repeat=function(){b.playerOptions.repeat=!b.playerOptions.repeat,this.onChangeRepeat(b.playerOptions.repeat)},this.getSettings=function(){return v},this.getSelectSceneIndex=function(){return o},this.onChangeRepeat=function(e){b.playerOptions.repeat=e,this.controllers.forEach(function(e){e.onChangeRepeat&&e.onChangeRepeat()})};const p={prevSymbol:"←",prevSymbolTitle:"Go to previous animation scene",nextSymbol:"→",nextSymbolTitle:"Go to next animation scene",playSymbol:"►",playTitle:"Play",pause:"❚❚",pauseTitle:"Pause",repeat:"⥀",repeatOn:"Turn repeat on",repeatOff:"Turn repeat off",controllerTitle:"Current time.",stereoEffects:"Stereo effects",mono:"Mono",sideBySide:"Side by side",topAndBottom:"Top and bottom"};function f(e){"ru"===e()&&(p.prevSymbolTitle="Кадр назад",p.playTitle="Проиграть",p.nextSymbolTitle="Кадр вперед",p.pauseTitle="Пауза",p.repeatOn="Повторять проигрывание",p.repeatOff="Остановить повтор проигрывания",p.controllerTitle="Текущее время.",p.stereoEffects="Стерео эффекты",p.mono="Моно",p.sideBySide="Слева направо",p.topAndBottom="Сверху вниз")}function _(){if(s)return s.querySelector("#sliderPosition")}this.localization=function(e=function(){return"en"}){return f(e),p},this.PlayController=class extends rn{constructor(e){const r=b.player,t=b.getLanguageCode;if(r.createControllersButtons(b),(e=e||b.dat.gui)&&!1!==b.dat.playController){var a,s;f(t);const c="rgb(255,255,255)",u="rgb(128,128,128)";function l(e,t,n){var o=document.createElement("span");return o.innerHTML=e,o.title=t,o.style.cursor="pointer",o.style.margin="0px 2px",o.onclick=n,o}super({playRate:1,property:function(e){var t,n,o={};function i(e){var t,n=e?(t=p.repeatOff,c):(t=p.repeatOn,u);o.buttonRepeat.title!==t&&(o.buttonRepeat.title=t,o.buttonRepeat.style.color=n,r.onChangeRepeat(e))}return a=function(e,t){o.buttonPlay.innerHTML=e,o.buttonPlay.title=t},o.buttonPrev=l(p.prevSymbol,p.prevSymbolTitle,r.prev),o.buttonPlay=l(d?p.pause:p.playSymbol,d?p.pauseTitle:p.playTitle,r.play3DObject),null!==r.getSettings().options.playerOptions.max&&(s=i,n=r.getSettings().repeat?(t=p.repeatOff,c):(t=p.repeatOn,u),o.buttonRepeat=l(p.repeat,t,function(e){i(o.buttonRepeat.title===p.repeatOn)}),o.buttonRepeat.style.color=n),o.buttonNext=l(p.nextSymbol,p.nextSymbolTitle,r.next),o}},"playRate"),(r.PlayController=this).lang=p,this.onRenamePlayButtons=function(e){var t,e=e?(t=p.pause,p.pauseTitle):(t=p.playSymbol,p.playTitle);a(t,e,!0)},this.onChangeRepeat=function(){s(r.getSettings().options.playerOptions.repeat)},r.pushController(this),this.setValue=function(e){this._controller.domElement.childNodes[0].value=e},e.add(this).__truncationSuspended=!0}else super({})}set controller(e){this._controller=e,this._controller.onChange(function(e){b.player.setTime(e)}),this._controller.domElement.title=this.lang.controllerTitle}get controller(){return this._controller}},this.gui=function(e){const t=b.dat.cookie,n=b.dat.getCookieName("Player"),o=b.getLanguageCode,i=me.dat;if((e=e||b.dat.gui)&&!1!==b.dat.playerGui){d();const p=JSON.parse(JSON.stringify(b.playerOptions)),f=(r={getLanguageCode:o},s={player:"Player",playerTitle:"3D objects animation.",min:"Min",max:"Max",dt:"Step",dtTitle:"Time between frames",marks:"Frames",marksTitle:"Player frames count",interval:"Rate",intervalTitle:"Rate of changing of animation scenes per second.",time:"Time",defaultButton:"Default",defaultTitle:"Restore default player settings."},"ru"===(a=void 0===(r=r||{}).getLanguageCode?"en":r.getLanguageCode())?(s.player="Проигрыватель",s.playerTitle="Анимация 3D объектов.",s.min="Минимум",s.max="Максимум",s.dt="Шаг",s.dtTitle="Веремя между кадрами",s.marks="Кадры",s.marksTitle="Количество кадров проигрывателя",s.interval="Темп",s.intervalTitle="Скорость смены кадров в секунду.",s.time="Время",s.defaultButton="Восстановить",s.defaultTitle="Восстановить настройки проигрывателя по умолчанию."):void 0!==r.lang&&r.lang._languageCode==a&&Object.keys(r.lang).forEach(function(e){void 0!==_lang[e]&&(_lang[e]=r.lang[e])}),s);Object.freeze(p);var r,a=b.playerOptions.max,s=b.playerOptions.marks;t.getObject(n,b.playerOptions,b.playerOptions),null!==a&&a!==1/0&&null!==b.playerOptions.max||(b.playerOptions.max=a,b.playerOptions.marks=s);const m=e.addFolder(f.player);i.folderNameAndTitle(m,f.player,f.playerTitle);{const h=b.playerOptions,g={};function l(e,t){e=e.controller.getValue();h.min=t(h.min,e),g.min.setValue(h.min),h.max&&(h.max=t(h.max,e),c(),g.max.setValue(h.max)),u()}g.folder=m.addFolder(""!==h.name?h.name:f.time),g.scaleController=g.folder.add(new Ye(l,{settings:v.options.playerOptions,getLanguageCode:o})).onChange(function(e){h.zoomMultiplier=e,u()});const y=new Ze(function(n){l(y,function(e,t){return e+=n})},{settings:v.options.playerOptions,getLanguageCode:o});g.positionController=g.folder.add(y).onChange(function(e){h.offset=e,u()}),g.min=i.controllerZeroStep(g.folder,h,"min",function(e){u()}),i.controllerNameAndTitle(g.min,f.min),d(),null!==h.max?(g.max=i.controllerZeroStep(g.folder,h,"max",function(e){u()}),i.controllerNameAndTitle(g.max,f.max)):(g.dt=i.controllerZeroStep(g.folder,h,"dt",function(e){u()}),i.controllerNameAndTitle(g.dt,f.dt,f.dtTitle)),h.marks&&(g.marks=g.folder.add(h,"marks").onChange(function(e){h.marks=parseInt(h.marks),u();var t=_();t&&(t.max=b.playerOptions.marks-1)}),i.controllerNameAndTitle(g.marks,void 0===h.marksName?f.marks:h.marksName,(void 0===h.marksTitle?f:h).marksTitle)),g.interval=g.folder.add(v.options.playerOptions,"interval",1,25,1).onChange(function(e){u()}),i.controllerNameAndTitle(g.interval,f.interval,f.intervalTitle),i.controllerNameAndTitle(g.folder.add({defaultF:function(e){h.zoomMultiplier=p.zoomMultiplier,g.scaleController.setValue(h.zoomMultiplier),h.offset=p.offset,g.positionController.setValue(h.offset),h.min=p.min,g.min.setValue(h.min),g.max&&(h.max=p.max,c(),g.max.setValue(h.max)),g.dt&&(h.dt=p.dt,g.dt.setValue(h.dt)),p.marks&&(h.marks=p.marks,g.marks)&&g.marks.setValue(h.marks),h.interval=p.interval,g.interval.setValue(h.interval),u()}},"defaultF"),f.defaultButton,f.defaultTitle)}function c(){null===b.playerOptions.max?b.playerOptions.dt=b.playerOptions.dt||.1:b.playerOptions.dt=(b.playerOptions.max-b.playerOptions.min)/(b.playerOptions.marks-1)}function u(){c(),t.setObject(n,b.playerOptions),v.onChangeScaleT&&v.onChangeScaleT(b.playerOptions)}function d(){null!==b.playerOptions.max&&(b.playerOptions.max=b.playerOptions.min+b.playerOptions.dt*(b.playerOptions.marks-1))}}},this.createControllersButtons=function(t){var e,n;t.controllers&&t.controllers.player&&(null===(e=t.controllers.player).buttonPrev&&console.warn("Player.createControllersButtons: invalid options.controllers.player.buttonPrev = "+e.buttonPrev),e.buttonPrev&&(null===(n="string"==typeof e.buttonPrev?document.getElementById(e.buttonPrev):e.buttonPrev)&&console.warn("Player.createControllersButtons: invalid options.controllers.player.buttonPrev = "+e.buttonPrev),n)&&(n.value=p.prevSymbol,n.title=p.prevSymbolTitle,n.onclick=function(e){t.player&&t.player.prev()},e.buttonPrev=n),null===e.buttonPlay&&console.warn("Player.createControllersButtons: invalid options.controllers.player.buttonPlay = "+e.buttonPlay),e.buttonPlay&&(null===(n="string"==typeof e.buttonPlay?document.getElementById(e.buttonPlay):e.buttonPlay)&&console.warn("Player.createControllersButtons: invalid options.controllers.player.buttonPlay = "+e.buttonPlay),n)&&(n.value=d?p.pause:p.playSymbol,n.title=d?p.pauseTitle:p.playTitle,n.onclick=function(e){t.player&&t.player.play3DObject()},e.buttonPlay=n),null===e.buttonNext&&console.warn("Player.createControllersButtons: invalid options.controllers.player.buttonNext = "+e.buttonNext),e.buttonNext)&&(null===(n="string"==typeof e.buttonNext?document.getElementById(e.buttonNext):e.buttonNext)&&console.warn("Player.createControllersButtons: invalid options.controllers.player.buttonNext = "+e.buttonNext),n)&&(n.value=p.nextSymbol,n.title=p.nextSymbolTitle,n.onclick=function(e){t.player&&t.player.next()},e.buttonNext=n)},this.createCanvasMenuItem=function(o,e=function(){return"en"}){const t=this,n=(s=o).menu,i=t.localization(e);n.push({name:i.prevSymbol,title:i.prevSymbolTitle,onclick:function(e){t.prev()}}),n.push({name:d?i.pause:i.playSymbol,title:d?i.pauseTitle:i.playTitle,id:"menuButtonPlay",onclick:function(e){t.play3DObject()}}),null!==b.playerOptions.max&&n.push({name:i.repeat,title:this.getSettings().repeat?i.repeatOff:i.repeatOn,id:"menuButtonRepeat",onclick:function(e){t.repeat()}}),n.push({name:i.nextSymbol,title:i.nextSymbolTitle,onclick:function(e){t.next()}}),this.controllers.push({onRenamePlayButtons:function(e){var t,e=e?(t=i.pause,i.pauseTitle):(t=i.playSymbol,i.playTitle),n=o.querySelector("#menuButtonPlay");n.innerHTML=t,n.title=e,b.controllers&&b.controllers.player&&b.controllers.player.buttonPlay&&(b.controllers.player.buttonPlay.value=t,b.controllers.player.buttonPlay.title=e)},onChangeRepeat:function(){o.querySelector("#menuButtonRepeat").title=b.playerOptions.repeat?i.repeatOff:i.repeatOn}})},this.addSlider=function(){null!==b.playerOptions.max&&s.menu.push({name:'<input type="range" min="0" max="'+(b.playerOptions.marks-1)+'" value="0" class="slider" id="sliderPosition">',style:"float: right;"})},this.addSliderEvents=function(){const t=_();if(t){var n;t.onchange=function(e){o.selectScene(parseInt(t.value))},t.oninput=function(e){o.selectScene(parseInt(t.value))};const o=this;t.addEventListener("pointerdown",e=>{n=!0}),t.addEventListener("pointerup",e=>{n=!1}),t.addEventListener("mousemove",e=>{n&&o.selectScene((b.playerOptions.marks-1)*e.offsetX/t.clientWidth)})}return t},this.setIndex=function(e,t){var n=this.getTime(),n=(b.controllers&&b.controllers.t&&(b.controllers.t.controller.value=n),"object"==typeof this.PlayController&&this.PlayController.setValue(n),_());n&&(n.value=e,n.title=t)},this.onChangeScale=function(e){_().max=e.marks-1,this.selectScene(0)}}}ge.cameraTarget=class{constructor(){const o={boLook:!1},t={boLook:o.boLook,getDistanceToCamera(){return void 0!==this.distanceToCameraCur?this.distanceToCameraCur:this.distanceToCamera}};o.rotation={};var i,r,a=!(t.rotation={}),n=!1;function s(e){k(),e=e||o,t.boMaual||(void 0!==e.boLook?t.boLook=e.boLook:t.boLook=o.boLook),o.camera=o.camera||e.camera,t.camera=e.camera||o.camera,t.distanceToCamera=e.distanceToCamera||o.distanceToCamera||t.distanceToCamera||(new P.Vector3).copy(o.camera.position),e.rotation||(e.rotation={}),void 0!==e.rotation.angle?t.rotation.angle=e.rotation.angle:t.rotation.angle=o.rotation.angle||0,t.rotation.axis=e.rotation.axis||o.rotation.axis||new P.Vector3(0,1,0)}this.get=function(e){if(e||i?i&&e&&!Object.is(i,e)&&console.error("Player.cameraTarget.get: options is ambiguous"):console.error("Player.cameraTarget.get: options = "+e),i=i||e,t.camera||n||!i.player||(o.camera=i.player.getSettings().cameraTarget.camera,o.camera&&s(),n=!0),t.camera)return t},this.init=function(e,t,n=!0){if(e){if(t||i?i&&t&&!Object.is(i,t)&&console.error("Player.cameraTarget.init: options is ambiguous"):console.error("Player.cameraTarget.init: options = "+t),i=i||t,!1!==e.bodefault){if(a)return;void 0!==e.boLook&&(o.boLook=e.boLook,r=e.boLook)}else{if(!0!==e.boLook)return;a&&console.warn("playerCameraTarget().init(...): duplicate target point"),a=!0,void 0===r&&(o.boLook=!0)}o.camera=o.camera||e.camera||(i.player?i.player.getSettings().cameraTarget.camera:void 0),!o.camera&&n?console.error("playerCameraTarget().init(...): cameraTargetDefault.camera = "+o.camera):(o.distanceToCamera=o.distanceToCamera||e.distanceToCamera,e.rotation=e.rotation||{},o.rotation.angle=o.rotation.angle||e.rotation.angle,o.rotation.axis=o.rotation.axis||e.rotation.axis,s(e))}},this.changeTarget=function(e,t,n){k();var o=e.userData.player&&"function"!=typeof e.userData.player.arrayFuncs?e.userData.player.arrayFuncs[t]:{},o=(o.cameraTarget||(o.cameraTarget={boLook:!1}),s(o.cameraTarget),(i=i||n).playerOptions.cameraTarget.get(i));o&&(o.boLook?(n=sn(e,(new P.Vector3).fromArray(e.geometry.attributes.position.array,t*e.geometry.attributes.position.itemSize)),o.target=n):delete o.target)},this.setCameraTarget=function(n){k();var o=n.playerOptions.cameraTarget.get(n);const i=(o=o||{}).camera;if(i){o.distanceToCamera||(o.distanceToCamera=(new P.Vector3).copy(i.position)),o.distanceToCameraCur||(o.distanceToCameraCur=new P.Vector3);const e=n.time,t=o.distanceToCamera,r=(new P.Vector3).copy(o.distanceToCameraCur);o.distanceToCameraCur.set(ge.execFunc(t,"x",e,n),ge.execFunc(t,"y",e,n),ge.execFunc(t,"z",e,n)),o.setCameraPosition||(o.setCameraPosition=function(){var e=o.target;if(o.boLook&&(e||!o.distanceToCameraCur.equals(r))){r.copy(o.distanceToCameraCur);var t=n.time;if(i.position.copy(o.distanceToCameraCur),i.position.applyAxisAngle(o.rotation.axis,ge.execFunc(o.rotation,"angle",t,n)),!e){if(!ge.orbitControls)return;e=ge.orbitControls.target}i.position.add(e),i.lookAt(e),n.orbitControls&&(n.orbitControls.target.equals(e)||(n.orbitControls.target.copy(e),n.orbitControlsGui&&n.orbitControlsGui.setTarget(e)),n.orbitControls._listeners)&&n.orbitControls._listeners.change[0]()}}),n.cameraGui&&n.cameraGui.update()}}}},ge.execFunc=function(e,t,n,o={}){var i=e[t];const r=o.a,a=o.b,s=typeof i;switch(void 0===n&&(n=o.playerOptions?o.playerOptions.min:0),s){case"undefined":return;case"number":return i;case"string":i=new Function("t","a","b","return "+i);case"function":try{var l=i(n,r,a);if(void 0===l)throw"function returns "+l;if(!Array.isArray(l))return l;i=l}catch(e){throw console.error(e),e}case"object":if(Array.isArray(i)){if(0===i.length)return void console.error('Player.execFunc: funcs["'+t+'"] array is empty');const r=i,y=i.length-1,v=null===o.playerOptions.max?1/0:o.playerOptions.max,b=o.playerOptions.min,_=(v-b)/y;for(var c=b,u=v,d=0,p=y,f=0;f<i.length;f++)_*f+b<n&&(c=_*(d=f)+b,u=_*(p=f+1)+b);function m(e){return"function"==typeof r[e]?r[e](n,r,a):r[e]instanceof P.Color?r[e]:void 0}if("number"!=typeof r[d]){if("w"===t)return m(d);if("object"!=typeof r[d])return void console.error('Player.execFunc: funcs["'+t+'"] array item '+d+" typeof = "+typeof r[d]+" is not number");for(f=0;f<i.length;f++){if(f===i.length-1)return r[f].v;d=f,p=f+1,c=r[d].t,u=r[p].t;if(c<=n&&n<u)return h=(r[p].v-r[d].v)/(u-c),g=r[d].v-h*c,h*n+g}return void console.error("Player.execFunc: value is not detected")}if(p>=i.length&&(p=d),"number"!=typeof r[p]){if("w"===t)return m(p);if("object"!=typeof r[p])return void console.error('Player.execFunc: funcs["'+t+'"] array item '+p+" typeof = "+typeof r[p]+" is not number")}var h=(r[p]-r[d])/(u-c),g=r[d]-h*c;return(isNaN(h)||isNaN(g))&&console.error("Player.execFunc: invalid x = "+h+" or y = "+g),h*n+g}return i.func?i.func instanceof Function?i.func(n,r,a):i.func:("w"!==t&&console.error('Player.execFunc: funcs["'+t+'"] object is not array'),i);default:console.error('Player.execFunc: Invalud typeof funcs["'+t+'"]: '+s)}};var P,O=new class{constructor(){function e(n){function e(e){const t=n+e;return{get controllerId(){return this.boUsed?void 0:t},get elController(){return document.getElementById(this.controllerId)},nameId:t+"Name",get elName(){return document.getElementById(this.nameId)}}}return{func:e("Func"),position:e("Position"),worldPosition:e("WorldPosition")}}this.x=e("x"),this.y=e("y"),this.z=e("z"),this.w=e("w")}};ge.selectMeshPlayScene=function(l,e={}){k();var n=e.t,c=e.options||{dat:!1},c=new A(c);if(void 0===n&&(n=c.playerOptions.min),c.scales.setW(),l.userData.player&&!(c&&c.boPlayer&&l.userData.boFrustumPoints)){l.geometry&&(delete l.geometry.boundingSphere,l.geometry.boundingSphere=null),l.userData.player.selectPlayScene&&(l.userData.player.selectPlayScene(n),t("x"),t("y"),t("z"));var o,i=c?c.a:1,r=c?c.b:0;if(l.geometry&&!l.userData.nd){const g=l.geometry.attributes,y=l.userData.player.arrayFuncs;if(void 0!==y){void 0===n&&console.error("setPosition: t = "+n),c&&void 0!==c.scales.w?(o=c.scales.w.min,s=c.scales.w.max):o=(s=u)-1;for(var a=0;a<y.length;a++){var s,u,d=y[a],p=!1;function f(e,t){e=ge.execFunc(d,e,n,c);void 0!==e&&(g.position[t](a,e),p=!0)}f("x","setX"),f("y","setY"),f("z","setZ"),f("w","setW");let t;function m(){var e;t=l.userData.player.palette?l.userData.player.palette.toColor(u,o,s):c.palette?c.palette.toColor(u,o,s):new P.Color("rgb("+(e={r:255,g:255,b:255}).r+", "+e.g+", "+e.b+")")}"function"==typeof d.w?(u=d.w(n,i,r),s=c.scales.w?(o=c.scales.w.min,c.scales.w.max):(console.warn("Player.selectMeshPlayScene: Кажется эти экстремумы заданы неверно"),o=0,100),4<=g.position.itemSize&&g.position.setW(a,u),p=!0,m()):"object"==typeof d.w&&(d.w instanceof P.Color?t=d.w:(u=ge.execFunc(d,"w",n,c),void 0!==d.w.min&&(o=d.w.min),void 0!==d.w.max&&(s=d.w.max),m())),t=h(void 0===d.w?(new P.Vector4).w:"number"==typeof d.w?d.w:ge.execFunc(d,"w",n,c),l,a,t),p&&(g.position.needsUpdate=!0),d.trace&&!d.line&&(d.line=new ge.traceLine(c),d.trace=!1),d.line&&d.line.addPoint&&d.line.addPoint(l,a,t),d.cameraTarget&&!0===d.cameraTarget.boLook&&c.playerOptions.cameraTarget.changeTarget(l,a,c)}}}var e="Player.selectMeshPlayScene: invalid mesh.scale.";l.scale.x<=0&&console.error(e+"x = "+l.scale.x),l.scale.y<=0&&console.error(e+"y = "+l.scale.y),l.scale.z<=0&&console.error(e+"z = "+l.scale.z),l.userData.player&&l.userData.player.arrayFuncs&&l.userData.player.arrayFuncs instanceof Array&&l.userData.player.arrayFuncs.forEach(function(r,a){if(r.controllers){S||(S={controllerXTitle:"X position",controllerYTitle:"Y position",controllerZTitle:"Z position",controllerWTitle:"color index",controllerWorld:"World",controllerXWorldTitle:"X world position",controllerYWorldTitle:"Y world position",controllerZWorldTitle:"Z world position",controllerWWorldTitle:"color index",controllerXFunctionTitle:"X = f(t)",controllerYFunctionTitle:"Y = f(t)",controllerZFunctionTitle:"Z = f(t)",controllerWFunctionTitle:"W = f(t)",positionAlert:"Invalid position fromat: "},"ru"===c.getLanguageCode()?(S.controllerXTitle="Позиция X",S.controllerYTitle="Позиция Y",S.controllerZTitle="Позиция Z",S.controllerWTitle="Индекс цвета",S.controllerWorld="Абсолютный",S.controllerXWorldTitle="Абсолютная позиция X",S.controllerYWorldTitle="Абсолютная позиция Y",S.controllerZWorldTitle="Абсолютная позиция Z",S.controllerWWorldTitle="Индекс цвета",S.positionAlert="Неправильный формат позиции точки: "):void 0!==c.lang&&c.lang.languageCode==languageCode&&Object.keys(c.lang).forEach(function(e){void 0!==S[e]&&(S[e]=c.lang[e])}));const n=an(l,a);function s(e,t){var n="x"===t?0:"y"===t?1:"z"===t?2:"w"===t?3:void 0,n=("w"===t&&(h(e,l,a),c.guiSelectPoint)&&c.guiSelectPoint.update(),n+l.geometry.attributes.position.itemSize*a),o=l.geometry.attributes.position.array[n],i=(l.geometry.attributes.position.array[n]=e,r.controllers[t]);isNaN(l.geometry.attributes.position.array[n])?(alert(S.positionAlert+e),(e=i.position.controller).focus(),e.value=o,l.geometry.attributes.position.array[n]=o):(l.geometry.attributes.position.needsUpdate=!0,c.axesHelper&&c.axesHelper.updateAxes(),c.guiSelectPoint&&c.guiSelectPoint.update(),i.worldPosition&&i.worldPosition.controller&&(i.worldPosition.controller.innerHTML=ln(l,a)[t]))}function e(o){var i=r.controllers[o];if(!1!==i){const t="position";function e(e){!O[o][e].elController||i[e]||(O[o][e].boUsed?console.warn('Player.selectMeshPlayScene createControllers: Same controller is using for different points. Controller ID is "'+O[o][e].controllerId+'""'):(i[e]={controller:O[o][e].elController,elName:O[o][e].elName||!1},O[o][e].boUsed=!0,e===t&&"w"===o&&(i[e].elSlider=!0)))}!i&&(O[o].func.elController||O[o].position.elController||O[o].worldPosition.elController)&&(i={},r.controllers[o]=i),i&&(e("func"),e(t),e("worldPosition"),Ln(i.func,O[o].func.controllerId,function(){return c.scales[o].name+" = f(t)"},{value:r[o],title:"x"===o?S.controllerXFunctionTitle:"y"===o?S.controllerYFunctionTitle:"z"===o?S.controllerZFunctionTitle:"w"===o?S.controllerWFunctionTitle:"",onchange:function(t){try{r[o]=t.currentTarget.value;var e,n=ge.execFunc(r,o,c.player.getTime(),c);i.position&&i.position.controller?((e=i.position.controller).onchange({currentTarget:{value:n}}),e.value=n):s(n,o),c.guiSelectPoint&&c.guiSelectPoint.update()}catch(e){alert("Axis: "+c.scales[o].name+'. Function: "'+r[o]+'". '+e),t.currentTarget.focus()}}}),Ln(i.position,o+"Position",function(){return c.scales[o].name},{value:n[o],title:"x"===o?S.controllerXTitle:"y"===o?S.controllerYTitle:"z"===o?S.controllerZTitle:"w"===o?S.controllerWTitle:"",onchange:function(e){s(e.currentTarget.value,o)},axisName:o}),Ln(i.worldPosition,o+"WorldPosition",function(){return S.controllerWorld+" "+c.scales[o].name},{value:sn(l,n)[o],title:"x"===o?S.controllerXWorldTitle:"y"===o?S.controllerYWorldTitle:"z"===o?S.controllerZWorldTitle:"w"===o?S.controllerWTitle:""}))}}var t;r.name&&(r.controllers.pointName||(r.controllers.pointName="pointName"),t="string"==typeof r.controllers.pointName?document.getElementById(r.controllers.pointName):r.controllers.pointName)&&(t.innerHTML=r.name),e("x"),e("y"),e("z"),e("w")}}),c&&c.guiSelectPoint?(c.guiSelectPoint.setMesh(),-1!==(e=c.guiSelectPoint.getSelectedPointIndex())&&c.guiSelectPoint.isSelectedMesh(l)&&c.guiSelectPoint.setPosition({object:l,index:e})):c.axesHelper&&c.axesHelper.movePosition()}function t(e){for(;l.rotation[e]<0;)l.rotation[e]+=2*Math.PI;for(;l.rotation[e]>2*Math.PI;)l.rotation[e]-=2*Math.PI}function h(e,t,n,o){var i;if(!(t.geometry.attributes.position.itemSize<4)&&(o=c.palette?c.palette.toColor(e,c.scales.w.min,c.scales.w.max):o))return e=t.geometry.attributes,i=t.userData.player.arrayFuncs,!ge.setColorAttribute(e,n,o)&&i[n]instanceof P.Vector4&&(t.userData.player&&i?(t.geometry.setAttribute("color",new P.Float32BufferAttribute(ge.getColors(i,{positions:e.position,options:c}),4)),ge.setColorAttribute(e,n,o)||console.error('Player.selectMeshPlayScene: the color attribute is not exists. Please use THREE.Vector3 instead THREE.Vector4 in the arrayFuncs or add "color" attribute')):console.error("Player.selectMeshPlayScene: set color attribute failed. Invalid mesh.userData.player.arrayFuncs")),o}},ge.setColorAttribute=function(e,t,n){"string"==typeof n&&(n=new P.Color(n));e=e.color||e.ca;return void 0!==e&&(e.setX(t,n.r),e.setY(t,n.g),e.setZ(t,n.b),e.needsUpdate=!0)},ge.getPoints=function(t,n){k(),Array.isArray(t)||(t=[t]),void 0===(n=n||{}).t&&(n.t=n.options&&n.options.player?n.options.player.getSettings().options.playerOptions.min:0);const o=n.options||new A,e=new A({palette:o.palette});o.setW(e);for(var i=e.scales.w.max,r=0;r<t.length;r++){var a=t[r];Array.isArray(a)?t[r]=new P.Vector4(void 0===a[0]?0:a[0],void 0===a[1]?0:a[1],void 0===a[2]?0:a[2],void 0===a[3]?i:a[3]):"object"==typeof a&&a instanceof P.Vector2==!1&&a instanceof P.Vector3==!1&&a instanceof P.Vector4==!1&&(void 0===a.vector?t[r]=new P.Vector4(void 0===a.x?0:a.x,void 0===a.y?0:a.y,void 0===a.z?0:a.z,void 0===a.w?0:a.w):a.vector instanceof P.Vector2==!0||a.vector instanceof P.Vector3==!0||a.vector instanceof P.Vector4==!0?a.vector instanceof P.Vector2==!0&&(t[r].vector=new P.Vector3(void 0===a.vector.x?0:a.vector.x,void 0===a.vector.y?0:a.vector.y,void 0===a.vector.z?0:a.vector.z)):4===a.vector.length?t[r].vector=new P.Vector4(void 0===a.vector[0]?0:a.vector[0],void 0===a.vector[1]?0:a.vector[1],void 0===a.vector[2]?0:a.vector[2],void 0===a.vector[3]?0:a.vector[3]):3===a.vector.length?t[r].vector=new P.Vector3(void 0===a.vector[0]?0:a.vector[0],void 0===a.vector[1]?0:a.vector[1],void 0===a.vector[2]?0:a.vector[2]):a.vector.length<3?t[r].vector=new P.Vector4(void 0===a.vector[0]?0:a.vector[0],void 0===a.vector[1]?0:a.vector[1]):console.error("Player.getPoints(...) falied! item.vector.length = "+a.vector.length))}for(var s=[],r=0;r<t.length;r++){var l=t[r];function c(e){return(l="number"==typeof l?new P.Vector4(l,0,0,0):l)instanceof P.Vector2||l instanceof P.Vector3||l instanceof P.Vector4?ge.execFunc(l,e,n.t,o):void 0!==l.vector?(void 0!==l.name&&(l.vector.name=l.name),l.trace&&(l.vector.trace=l.trace),l.controllers&&(l.vector.controllers=l.controllers),l.cameraTarget&&(l.vector.cameraTarget=l.cameraTarget,delete l.cameraTarget),t[r]=l.vector,l=l.vector,ge.execFunc(l,e,n.t,o)):void console.error("Player.getAxis().getPoints(): funcs.vector = "+l.vector)}var u=l.vector instanceof P.Vector3==!0?new P.Vector3(c("x"),c("y"),c("z")):new P.Vector4(c("x"),c("y"),c("z"),c("w"));l.cameraTarget&&(l.cameraTarget.bodefault=!1,void 0===l.cameraTarget.boLook&&(l.cameraTarget.boLook=!0),o.playerOptions.cameraTarget.init(l.cameraTarget,o)),s.push(u)}return s};function k(){me.isThree()?(P=me.THREE,Object.assign(P.BufferGeometry.prototype,{setFromPoints:function(e,t){t=t||3;for(var n=[],o=0,i=e.length;o<i;o++){var r=e[o];n.push(r.x,r.y,r.z||0),4<=t&&n.push(r.w||0)}return this.setAttribute("position",new P.Float32BufferAttribute(n,t)),this}}),Object.assign(P.Vector4.prototype,{multiply:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,void 0!==e.w&&(this.w*=e.w),this}}),Object.assign(P.Vector4.prototype,{add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,void 0!==e.w&&(this.w+=e.w),this)}}),Object.assign(P.Points.prototype,{raycast:function(n,o){var e=new P.Matrix4;const l=new P.Ray;var t=new P.Sphere,i=new P.Vector3;function r(e,t,n,o,i,r,a){var s=l.distanceSqToPoint(e);s<n&&(n=new P.Vector3,l.closestPointToPoint(e,n),n.applyMatrix4(o),(e=i.ray.origin.distanceTo(n))<i.near||e>i.far||r.push({distance:e,distanceToRay:Math.sqrt(s),point:n,index:t,face:null,object:a}))}var a=this.geometry,s=this.matrixWorld,c=n.params.Points.threshold;if(null===a.boundingSphere&&a.computeBoundingSphere(),t.copy(a.boundingSphere),t.applyMatrix4(s),t.radius+=c,!1!==n.ray.intersectsSphere(t)){e.copy(s).invert(),l.copy(n.ray).applyMatrix4(e);var t=c/((this.scale.x+this.scale.y+this.scale.z)/3),u=t*t;if(a.isBufferGeometry){var e=a.index,c=a.attributes,d=c.position.array,p=c.position.itemSize;if(null!==e){var f=e.array;for(let e=0,t=f.length;e<t;e++){var m=f[e];i.fromArray(d,m*p),r(i,m,u,s,n,o,this)}}else for(let e=0,t=d.length/p;e<t;e++)i.fromArray(d,e*p),r(i,e,u,s,n,o,this)}else{var h=a.vertices;for(let e=0,t=h.length;e<t;e++)r(h[e],e,u,s,n,o,this)}}}})):console.warn("Player: can not assign. Set THREE first.")}ge.getColors=function(e,n){if(k(),Array.isArray(e)||(e=[e]),(n=n||{}).options=n.options||{},void 0!==n.positions&&Array.isArray(e)&&e.length!==n.positions.count)console.error("getColors failed! arrayFuncs.length: "+e.length+" != positions.count: "+n.positions.count);else{var t=Array.isArray(e)?e.length:n.positions.count,o=(n.colors=n.colors||[],[]);n.options.palette||n.options.setPalette();for(var i=0;i<t;i++){var r=3*i;if(r>=n.colors.length){var a=Array.isArray(e)?e[i]:void 0;if(a instanceof P.Vector4||n.positions&&4===n.positions.itemSize){let e,t;var s=a.w,l=(a.w instanceof Object&&a.w.func?(a.w.max&&(t=a.w.max),a.w.min&&(e=a.w.min),s=a.w.func):(n.options.setW(),e=n.options.scales.w.min,t=n.options.scales.w.max),s instanceof Function&&!n.options.player&&0,n.options.playerOptions?n.options.playerOptions.min:0),c=n.options.palette.toColor(void 0===a?(new P.Vector4).fromBufferAttribute(n.positions,i).w:s instanceof Function?s(l):"string"==typeof s?ge.execFunc(a,"w",l,n.options):void 0===s?(new P.Vector4).w:s,e,t);o.push(c.r,c.g,c.b)}else if(n.colors instanceof P.Float32BufferAttribute)new P.Vector3(1,1,1);else if(null!=n.color){const c=new P.Color(n.color);o.push(c.r,c.g,c.b)}else o.push(1,1,1)}else o.push(n.colors[r],n.colors[1+r],n.colors[2+r]);n.opacity instanceof Array?o.push(i<n.opacity.length?n.opacity[i]:1):o.push(1)}n.colors=o}return n.colors},ge.traceLine=class{constructor(l){var c;const u=[];k(),l.player&&(this.isVisible=function(){return!!l.player&&(c?c.visible:0!==u.length&&u[0].visible)},this.visible=function(t){if(!l.player)return!1;c?c.visible=t:u.forEach(function(e){e.visible=t})},this.addPoint=function(e,t,n){var o=e.geometry.attributes.position,i=((r=4<=o.itemSize?new P.Vector4(0,0,0,0):new P.Vector3).fromArray(o.array,t*o.itemSize),l.player?l.player.getSelectSceneIndex():0);if(null===l.playerOptions.max){if((i=Math.abs(i))<u.length-1){for(;i<u.length-1;)e.remove(u[u.length-1]),u.pop();return}const s=new P.BufferGeometry,a=2;t=new Float32Array(6),o=(s.setAttribute("position",new P.BufferAttribute(t,3)),new Float32Array(6));s.setAttribute("color",new P.Float32BufferAttribute(o,3));const c=new P.Line(s,new P.LineBasicMaterial({vertexColors:!0}));e.add(c),u[0]&&(c.visible=u[0].visible);var r=(new P.Vector3).copy(r),t=c.geometry.attributes.position.itemSize;r.toArray(c.geometry.attributes.position.array,+t),(0===u.length?r:(new P.Vector3).fromArray(u[u.length-1].geometry.attributes.position.array,+t)).toArray(c.geometry.attributes.position.array,0*t),c.geometry.attributes.position.needsUpdate=!0,void 0===n&&(n=new P.Color(1,1,1)),ge.setColorAttribute(c.geometry.attributes,0,0===u.length?n:(new P.Color).fromArray(u[u.length-1].geometry.attributes.color.array,+t)),ge.setColorAttribute(c.geometry.attributes,1,n),void u.push(c)}else{if(void 0===c){o=new P.BufferGeometry;if(null!==l.playerOptions.max)if(l.playerOptions&&l.playerOptions.marks)a=l.playerOptions.marks;else{if(!l.player||!l.player.marks)return void console.error("Player.traceLine: MAX_POINTS = "+a+". Create Player first or remove all trace = true from all items of the arrayFuncs");a=l.player.marks}else a=i+1;t=new Float32Array(3*a),t=(o.setAttribute("position",new P.BufferAttribute(t,3)),new Float32Array(3*a));o.setAttribute("color",new P.Float32BufferAttribute(t,3)),o.setDrawRange(i,i),(c=new P.Line(o,new P.LineBasicMaterial({vertexColors:!0}))).visible=!0,e.add(c)}c.geometry&&(delete c.geometry.boundingSphere,c.geometry.boundingSphere=null),(r=(new P.Vector3).copy(r)).toArray(c.geometry.attributes.position.array,i*c.geometry.attributes.position.itemSize),c.geometry.attributes.position.needsUpdate=!0,void 0===n&&(n=new P.Color(1,1,1)),ge.setColorAttribute(c.geometry.attributes,i,n);var a=c.geometry.drawRange.start,t=i+1-a;i<a&&(t=a+c.geometry.drawRange.count-(a=i)),c.geometry.setDrawRange(a,t)}},this.remove=function(){void 0!==c&&(c.geometry.dispose(),c.material.dispose(),c.parent.remove(c))})}},ge.getItemSize=function(e){k();for(var t=0;t<e.length;t++)if(e[t]instanceof P.Vector4)return 4;return 3},ge.selectPlayScene=function(e,t={}){const n=void 0!==t.t?t.t:0,o=void 0!==t.index?t.index:void 0,i=t.options||new A;e.userData.t=n,ge.selectMeshPlayScene(e,{t:n,options:i}),function t(e){e.children.forEach(function(e){e instanceof P.Group?t(e):ge.selectMeshPlayScene(e,{t:n,options:i})})}(e),i.playerOptions.cameraTarget.setCameraTarget(i);t=i.playerOptions.cameraTarget.get();t&&t.setCameraPosition&&t.setCameraPosition(void 0===o)},ge.assign=function(){k()};
/**
 * @module myObject
 * @description base class for my threejs objects
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
*/
const Nn="MyObject";class Mn{constructor(l={},e){const c=this,u=(l.object=l.object||{},l.object.geometry=l.object.geometry||{},l.object.geometry.position&&l.object.geometry.position.isPositionProxy||(l.object.geometry.position=new Proxy(l.object.geometry.position||[],{get:(e,t)=>{const i=parseInt(t);return isNaN(i)?"isPositionProxy"===t||e[t]:new Proxy(e[i],{set:(e,t,n)=>{var o=parseInt(t);return isNaN(o)?e[t]=n:(e[o]=n,l.bufferGeometry.userData.position[i][o]=n),!0}})}})),me.THREE);l.bufferGeometry||(l.bufferGeometry=new u.BufferGeometry),this.bufferGeometry=l.bufferGeometry,e&&(l.object.geometry.position=l.object.geometry.position||e);this.setPositionAttributeFromPoints=(t,e)=>{if(e&&delete l.bufferGeometry.attributes.position,!l.bufferGeometry.attributes.position){e=this.pointLength?this.pointLength():void 0===t[0].w?3:4,n=t.length,null!=(o=l.object.geometry.MAX_POINTS)&&l.bufferGeometry.setDrawRange(0,2*n-1),i=new Float32Array((null!=o?o:n)*e),l.bufferGeometry.setAttribute("position",new u.Float32BufferAttribute(i,e)),l.bufferGeometry.userData.position=new Proxy(l.bufferGeometry.attributes.position,{get:(o,e)=>{var t=parseInt(e);if(isNaN(t))return"length"===e?o.count:(console.error(Nn+": get settings.bufferGeometry.userData.position. Invalid name: "+e),o[e]);{const i=t*o.itemSize,r=o.array,a=new Proxy([],{get:(e,t)=>{var n=parseInt(t);if(!isNaN(n))return n>=o.itemSize?void 0:r[i+n];switch(t){case"forEach":return t=>{for(let e=0;e<o.itemSize;e++)t(r[i+e],e)};case"length":return o.itemSize;case"toJSON":return e=>{let t="[";return a.forEach(e=>{t+=e+", "}),t.substring(0,t.length-2)+"]"};case"x":return r[0+i];case"y":return r[1+i];case"z":return r[2+i];case"w":return o.itemSize<4?void 0:r[3+i]}return e[t]},set:(e,t,n)=>{var o=parseInt(t);return isNaN(o)?e[t]=n:r[i+o]=n,!0}});return a}}}),c.setW&&c.setW(),i=l.object.geometry.opacity?4:3,e=new Float32Array((null!=o?o:n)*i),l.bufferGeometry.setAttribute("color",new u.Float32BufferAttribute(e,i));for(let e=0;e<t.length;e++)this.setPositionAttributeFromPoint(e)}var n,o,i;return l.bufferGeometry},this.verticeColor=(e,t)=>{var n=l.object.geometry.colors,o=3*e;if(n&&null!=n[o])return[n[o],n[1+o],n[2+o]];n=l.object.color;if(null!=n&&"object"!=typeof n)return new u.Color(c.color());o=()=>new u.Color(c.color());let i;if(t)i=t.w;else if(c.getPoint)i=c.getPoint(e).w;else{n=c.bufferGeometry.attributes.position;if(4!=n.itemSize)return o();i=(new u.Vector4).fromBufferAttribute(n,e).w}return void 0===i?o():i},this.setPositionAttributeFromPoint=(e,t)=>{var n=l.bufferGeometry.attributes,o=n.position,i=o.itemSize;t=t||c.getPoint(e);let r=e*i,a=o.array;a[r++]=null!=t.x?t.x:null!=t[0]?t[0]:0,1<i&&(a[r++]=null!=t.y?t.y:null!=t[1]?t[1]:0),2<i&&(a[r++]=null!=t.z?t.z:null!=t[2]?t[2]:0);o=t.w;3<i&&(a[r]=o);let s=e*n.color.itemSize;a=n.color.array;i=this.verticeColor(e,t);"number"==typeof i?(l.options&&(t=l.options.scales.w,ge.setColorAttribute(n,e,l.options.palette.toColor(o,t.min,t.max))),s+=n.color.itemSize-1):Array.isArray(i)?i.forEach(e=>a[s++]=e):i instanceof u.Color?(a[s++]=i.r,a[s++]=i.g,a[s++]=i.b):console.error(Nn+".setPositionAttributeFromPoint: Invalid verticeColor = "+i),3<n.color.itemSize&&this.verticeOpacity(e)},this.verticeOpacity=(e,t,n)=>{var o,i,r=l.bufferGeometry.attributes.color;4!=r.itemSize?console.error(Nn+".verticeOpacity: Invalid color.itemSize = "+r.itemSize):(o=r.array,i=l.object.geometry.opacity?l.object.geometry.opacity[e]:void 0,o[r.itemSize*e+3]=t?n:void 0===i?1:i,r.needsUpdate=!0)},this.verticesOpacity=(t,n)=>{var o=l.bufferGeometry.attributes.color;if(o&&3<o.itemSize)for(let e=0;e<o.count;e++)this.verticeOpacity(e,t,n);else{var e=c.object3D;e?(e.material.transparent=t,e.material.opacity=t?n:1,e.material.needsUpdate=!0):console.error(Nn+".verticesOpacity: Invalid object3D")}},this.color=()=>{var e=null!=l.object.color?l.object.color:null!=l.pointsOptions?l.pointsOptions.color:void 0;return null!=e?e:this.defaultColor}}get defaultColor(){return"white"}get isOpacity(){return 3<this.bufferGeometry.attributes.color.itemSize&&(this.object3D.material.transparent||console.error(Nn+".isOpacity: invalid this.object3D.material.transparent = "+this.object3D.material.transparent),!0)}}
/**
 * @module getShaderMaterialPoints
 * @description get THREE.Points with THREE.ShaderMaterial material
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */var Fn;const Dn=(Fn=document.currentScript&&""!==document.currentScript.src?document.currentScript.src:""!==(Fn=document.getElementsByTagName("script"))[Fn.length-1].src?src:(new Error).stack.match(/(https?:[^:]*)/)[0]).substring(0,Fn.lastIndexOf("/")),Vn={array:[],setItem:function(e,t){this.array.push({path:e,text:t})},getItem:function(e){for(var t=0;t<this.array.length;t++)if(this.array[t].path===e)return this.array[t].text}},In={array:[],setItem:function(e,t){this.array.push({path:e,text:t})},getItem:function(e){for(var t=0;t<this.array.length;t++)if(this.array[t].path===e)return this.array[t].text}};class Rn extends Mn{constructor(e,t,n,o={}){super(o,t);const i=me.THREE,r=void 0===o.pointsOptions?void 0===o.tMin?0:o.tMin:void 0===o.pointsOptions.tMin?0:o.pointsOptions.tMin;var a;if(o.options=o.options||new A,o.pointsOptions=o.pointsOptions||{},ge.assign(),t instanceof i.BufferGeometry){a=t,t=[];for(var s=0;s<a.attributes.position.count;s++)t.push((new i.Vector3).fromBufferAttribute(a.attributes.position,s))}else if("function"==typeof t)a=t();else if(o.pointsOptions.bufferGeometry)a=o.pointsOptions.bufferGeometry;else{const v=ge.getPoints(t,{options:o.options,group:e,t:r});this.getPoint=e=>v[e],a=this.setPositionAttributeFromPoints(v)}const l=o.pointsOptions.frustumPoints?o.pointsOptions.frustumPoints.pushArrayCloud(a):void 0;var c,u,d,p,f,m,e=(new i.TextureLoader).load(Dn+"/textures/point.png",function(e){},function(){},function(){console.error("THREE.TextureLoader: error")});e.wrapS=i.RepeatWrapping,e.wrapT=i.RepeatWrapping;const h={pointTexture:{value:e},pointSize:{value:(void 0!==o.pointsOptions&&void 0!==o.pointsOptions.shaderMaterial&&void 0!==o.pointsOptions.shaderMaterial.point?o.pointsOptions.shaderMaterial:o.options).point.size}};void 0!==o.pointsOptions&&void 0!==o.pointsOptions.uniforms&&(c=o.pointsOptions.uniforms(h));{var g=function(e){void 0!==c&&c.editShaderText(e);e=new i.Points(a,new i.ShaderMaterial({uniforms:h,vertexShader:e.vertex,fragmentShader:e.fragment,transparent:!0})),e.userData.shaderMaterial=(void 0===o.pointsOptions?o:o.pointsOptions).shaderMaterial,void 0!==o.options.saveMeshDefault&&o.options.saveMeshDefault(e),o.pointsOptions&&o.pointsOptions.frustumPoints&&(e.userData.cloud={indexArray:l}),e.userData.shaderMaterial=(void 0===o.pointsOptions?o:o.pointsOptions).shaderMaterial,n(e),e.userData.boFrustumPoints&&o.pointsOptions.group.children.forEach(function(e){o.options.frustumPoints.updateCloudPoint(e)}),void 0!==e.material.uniforms.palette&&(e.material.uniforms.palette.value.needsUpdate=!0),void 0!==e.material.uniforms.cloudPoints&&(e.material.uniforms.cloudPoints.value.needsUpdate=!0),e=o.options.playerOptions.cameraTarget.get(o.options);e&&e.setCameraPosition&&e.setCameraPosition()};e=void 0===o.pointsOptions?void 0:o.pointsOptions.path;const b={};function y(){var e=In.getItem(d);e?p(m,e):((e=new i.FileLoader(i.DefaultLoadingManager)).setResponseType("text"),e.load(d,function(e){In.setItem(d,e),p(m,e)},f.onProgress,f.onError))}(e=e||{}).vertex=e.vertex||Dn+"/getShaderMaterialPoints/vertex.c",e.fragment=e.fragment||Dn+"/getShaderMaterialPoints/fragment.c",u=e.vertex,d=e.fragment,p=function(e,t){b.vertex=e,b.fragment=t,g(b)},f=(f={onError:function(e){console.error(e.srcElement.responseURL+" status = "+e.srcElement.status+" "+e.srcElement.statusText)}})||{},(m=Vn.getItem(u))?y():((e=new i.FileLoader(i.DefaultLoadingManager)).setResponseType("text"),e.load(u,function(e){Vn.setItem(u,e),m=e,y()},f.onProgress,f.onError))}}}
/**
 * @module MyPoints
 * @description Array of my points.
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
*/class jn extends Mn{constructor(a,s,l){super(l,a);const c=this,u=me.THREE,d=(s=s||me.scene,"function"!=typeof a&&0===a.length&&a.push(new u.Vector3),l.pointsOptions=l.pointsOptions||{},l.pointsOptions);l.options=l.options||new A;var p=l.options;if(p.boOptions||(p=new A(p)),d.tMin=d.tMin||0,d.name=d.name||"",d.position=d.position||new u.Vector3(0,0,0),d.scale=d.scale||new u.Vector3(1,1,1),d.rotation=d.rotation||new u.Vector3,d.group=s,""!==d.name&&d.elements&&(null===d.elements.pointsName&&console.warn("MyPoints: Points name element is not exists"),d.elements.pointsName||(d.elements.pointsName="pointsName"),(t="string"==typeof d.elements.pointsName?document.getElementById(d.elements.pointsName):d.elements.pointsName)?t.innerHTML=d.name:console.warn('MyPoints: Element with id: "'+d.elements.pointsName+'" is not exists')),ge.assign(),!1!==d.shaderMaterial)new Rn(s,a,function(e){n(e)},{options:p,pointsOptions:d,object:{geometry:{position:l.object.geometry.position,opacity:l.object.geometry.opacity}},bufferGeometry:l.bufferGeometry});else{let e;if("function"==typeof a)e=a();else{const o=ge.getPoints(a,{options:p,group:s,t:d.tMin});this.getPoint=e=>o[e],e=this.setPositionAttributeFromPoints(o)}var t=new u.Points(e,new u.PointsMaterial({size:p.point.size/p.point.sizePointsMaterial,vertexColors:!0,transparent:!!l.pointsOptions.opacity||void 0}));d.frustumPoints&&(t.userData.cloud={indexArray:d.frustumPoints.pushArrayCloud(t.geometry)}),n(t)}function n(n){if((c.object3D=n).name=d.name,void 0!==d.pointIndexes&&(n.userData.pointIndexes=function(e){return d.pointIndexes(e)}),void 0!==d.pointName&&(n.userData.pointName=function(e){return d.pointName(e)}),void 0!==d.controllers&&(n.userData.addControllers=d.addControllers,n.userData.controllers=function(){return d.controllers()}),l.pointsOptions.raycaster&&(n.userData.raycaster=l.pointsOptions.raycaster),a instanceof u.BufferGeometry)for(var e=[],t=0;t<a.attributes.position.count;t++)e.push((new u.Vector3).fromBufferAttribute(a.attributes.position,t));else e=a;function o(t){function e(e){n.position[e]="function"==typeof d.position[e]?d.position[e](t,p.a,p.b):d.position[e]}t=t||d.tMin,e("x"),e("y"),e("z")}function i(t){function e(e){n.scale[e]="function"==typeof d.scale[e]?d.scale[e](t,p.a,p.b):d.scale[e]}t=t||d.tMin,e("x"),e("y"),e("z")}function r(t){function e(e){for(n.rotation[e]="function"==typeof d.rotation[e]?d.rotation[e](t,p.a,p.b):d.rotation[e];n.rotation[e]<0;)n.rotation[e]+=2*Math.PI;for(;n.rotation[e]>2*Math.PI;)n.rotation[e]-=2*Math.PI}t=t||d.tMin,e("x"),e("y"),e("z")}n.userData.player={arrayFuncs:e,selectPlayScene:function(e){o(e),i(e),r(e)}},o(),i(),r(),s.add(n),n.userData.myObject=c,n.userData.opacity=e=>{c.verticesOpacity(!1,e)},d.boFrustumPoints&&(n.userData.boFrustumPoints=d.boFrustumPoints),p.guiSelectPoint&&p.guiSelectPoint.addMesh(n),p.eventListeners&&p.eventListeners.addParticle(n),void 0!==d.onReady&&d.onReady(n),!n.userData.boFrustumPoints&&p.raycaster&&p.raycaster.addParticle&&p.raycaster.addParticle(n)}}}
/**
 * @module DropdownMenu
 * @description Creates a drop down menu in your javaScript code.
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */e={tag:"style"};var Bn,u=(Bn=document.currentScript&&""!==document.currentScript.src?document.currentScript.src:""!==(Bn=document.getElementsByTagName("script"))[Bn.length-1].src?src:(new Error).stack.match(/(https?:[^:]*)/)[0]).substring(0,Bn.lastIndexOf("/")),Hn=u.split(/(.*)(\/build)/);"/canvasMenu"===(Hn=(u="/build"===Hn[2]?Hn[1]:u).split(/(.*)(\/canvasMenu)/))[2]&&(u=Hn[1]+"/DropdownMenu"),a.sync(u+"/styles/menu.css",e),a.sync(u+"/styles/gui.css",e),a.sync(u+"/styles/Decorations/transparent.css",e),a.sync(u+"/styles/Decorations/gradient.css",e);
/**
 * @module DropdownMenu
 * @description Creates a drop down menu in your javaScript code.
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */
var Gn={create:function(e,i){switch((i=i||{}).elParent=i.elParent||document.querySelector("body"),i.decorations){case"Gradient":case"Transparent":case"Custom":case void 0:break;default:console.error("DropdownMenu.create: Invalid options.decorations: "+i.decorations)}var t,s=document.createElement("menu");function n(){s.style.opacity=1,clearTimeout(t),t=setTimeout(function(){s.style.opacity=0},5e3)}return i.elParent.classList.contains("container")&&(s.className="controls"),i.canvas&&(s.style.opacity=0,i.canvas.onmouseout=function(e){s.style.opacity=0},i.canvas.onmousemove=function(e){n()},s.onmousemove=function(e){n()}),i.elParent.appendChild(s),e.forEach(function(r){var e="dropdown-child";function t(t){setTimeout(function(){var e=a.style.display;a.style.display="block",t.up?a.style.top="-"+a.offsetHeight+"px":a.style.top=o.offsetHeight-1+"px",t.left&&(a.style.left=o.offsetWidth-a.offsetWidth+"px"),a.style.display=e},0)}var n,o=document.createElement("span");switch(o.className="menuButton"+(void 0===i.decorations?"":" menuButton"+i.decorations),void 0!==r.style&&(o.style.cssText=r.style),void 0!==r.radio&&(o.style.cssText=r.style),void 0!==r.onclick&&(o.onclick=r.onclick),void 0!==r.id&&(o.id=r.id),"string"==typeof r?n=r:(n=r.name,r.id&&(o.id=r.id),r.title&&(o.title=r.title)),typeof n){case"object":o.appendChild(n);break;case"string":case"undefined":o.innerHTML=n;break;default:console.error("Invalid typeof name: "+typeof n)}if(r.items){var a=document.createElement("span");if(a.className=e+" "+e+(void 0===i.decorations?"Default":i.decorations),a.title="",o.appendChild(a),r.items.forEach(function(e){var t=document.createElement("nobr"),o="checked";function i(e){return"string"==typeof e?e:!0===e.radio?(e.checked?"◉":"◎")+" "+e.name:!0===e.checkbox?(e.checked?"☑":"☐")+" "+e.name:e.name}"string"!=typeof e&&(e.name,t.onclick=function(n){!0===e.radio?r.items.forEach(function(e){var t;!0===e.radio&&(((t=(t=n)||window.event).target||t.srcElement)===e.elName?(e.checked=!0,e.elName.classList.add(o)):(e.checked=!1,e.elName.classList.remove(o)),e.elName.innerHTML=i(e))}):!0===e.checkbox&&(!0===e.checked?e.elName.classList.add(o):e.elName.classList.remove(o),e.checked=!e.checked,e.elName.innerHTML=i(e)),e.onclick&&e.onclick(n)}),!0===e.radio&&t.classList.add("radio"),!0===e.checkbox&&t.classList.add("checkbox"),e.id&&(t.id=e.id),e.title&&(t.title=e.title),t.innerHTML=i(e),!0===e.checked&&t.classList.add(o),a.appendChild(t),"string"!=typeof e&&(e.elName=t)}),"object"==typeof r.drop)t(r.drop);else switch(r.drop){case"up":t({up:!0});break;case"left":t({left:!0});break;case void 0:setTimeout(function(){a.style.left="-"+o.clientWidth+"px",a.style.top=o.offsetHeight-1+"px"},0);break;default:console.error("Invalid menuItem.drop: "+r.drop)}}s.appendChild(o)}),s}};
/**
 * @module CanvasMenu
 * @description My [dropdown menu]{@link https://github.com/anhr/commonNodeJS/tree/master/DropdownMenu} for canvas in my [three.js]{@link https://threejs.org/} projects.
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */class Un{constructor(e,t={}){if(me.isThree()){var n=me.THREE;t.options=t.options||new A;const a=t.options;if(a.boOptions){if(!1!==a.canvasMenu){a.canvasMenu=this;const s={fullScreen:"Full Screen",nonFullScreen:"Non Full Screen"};var o=a.getLanguageCode;if("ru"===o()&&(s.prevSymbolTitle="Кадр назад",s.playTitle="Проиграть",s.nextSymbolTitle="Кадр вперед",s.pauseTitle="Пауза",s.repeatOn="Повторять проигрывание",s.repeatOff="Остановить повтор проигрывания",s.controllerTitle="Текущее время.",s.stereoEffects="Стерео эффекты",s.mono="Моно",s.sideBySide="Слева направо",s.topAndBottom="Сверху вниз"),n&&e instanceof n.WebGLRenderer!=!0)console.error("CanvasMenu: renderer is not THREE.WebGLRenderer");else{const l=e.domElement,c=l.parentElement;if("DIV"!==c.tagName)console.error("CanvasMenu: elContainer.tagName = "+c.tagName);else{var i,r="container";if(c.classList.contains(r)||c.classList.add(r),t.menu=t.menu||[],this.menu=t.menu,t.options.stereoEffect&&t.options.stereoEffect.createCanvasMenuItem&&t.options.stereoEffect.createCanvasMenuItem(this,{getLanguageCode:a.getLanguageCode}),a.player&&a.player.createCanvasMenuItem(this,o),Pn.RendererSetSize(e,this),void 0!==t.fullScreen){if(!t.fullScreen.camera)return void console.error("CanvasMenu: settings.fullScreen.camera = "+t.fullScreen.camera);i=new Pn(n,e,t.fullScreen.camera,{canvasMenu:this,fullScreen:t.fullScreen}),!1!==a.canvas.fullScreen&&i.setFullScreen(!1,!0),this.getFullScreenSettings=function(e){return i.setStereoEffect(e),i},this.isFullScreen=function(){return i.isFullScreen()},this.setFullScreen=function(e){return i.setFullScreen(e)},a.canvas.noButtonFullScreen||t.menu.push({style:"float: right;",id:"menuButtonFullScreen",onclick:function(e){i.onclick()}})}a.player&&a.player.addSlider();const u=Gn.create(t.menu,{elParent:"string"==typeof c?document.getElementById(c):c,canvas:"string"==typeof l?document.getElementById(l):l,decorations:"Transparent"});this.querySelector=function(e){return u.querySelector(e)},u.addEventListener("mouseenter",function(e){t.options.dat&&(t.options.dat.mouseenter=!0),t.onOver&&t.onOver(!0)}),u.addEventListener("mouseleave",function(e){t.options.dat&&(t.options.dat.mouseenter=!1),t.onOver&&t.onOver(!1)}),a.player&&a.player.addSliderEvents(),t.fullScreen&&(this.setFullScreenButton=function(e){void 0===e&&(e=!1!==a.canvas.fullScreen);var t=c.querySelector("#menuButtonFullScreen");return null!==t&&(e?(t.innerHTML="⤦",t.title=s.nonFullScreen):(t.innerHTML="⤢",t.title=s.fullScreen)),!0},this.setFullScreenButton(),t.options.stereoEffect)&&t.options.stereoEffect.settings&&t.options.stereoEffect.settings.spatialMultiplex!==T.spatialMultiplexsIndexs.Mono&&this.setFullScreen(!1),this.setSize=function(e){if(void 0!==u){for(var t,n=0,o=0;o<u.childNodes.length;o++){var i=u.childNodes[o],r=window.getComputedStyle(i),r=parseInt(r["margin-left"])+parseInt(r["margin-right"])+parseInt(r["padding-left"])+parseInt(r["padding-right"]),a=i.querySelector(".slider");null===a?n+=i.offsetWidth+r:(t=a,n+=r)}t&&0<(e=e-n)&&(t.parentElement.style.width=e+"px")}};r={set:function(e,t){this.x=e,this.y=t}};e.getSize(r),this.setSize(r.x,r.y),0===this.menu.length&&console.warn("CanvasMenu: menu is empty.")}}}}else console.error("CanvasMenu: call options = new Options( options ) first")}else console.warn("CanvasMenu: Set THREE first.")}}
/**
 * Remove all child objects of the object and call dispose on their geometry, material and texture.
 *
 * Thanks to https://stackoverflow.com/a/48768960/5175935
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 * @author [欧阳维杰]{@link https://stackoverflow.com/users/6045817/%e6%ac%a7%e9%98%b3%e7%bb%b4%e6%9d%b0}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function Xn(t){for(;0<t.children.length;)Xn(t.children[0]),t.remove(t.children[0]);t.geometry&&(void 0!==t.geometry.attributes&&Object.keys(t.geometry.attributes).forEach(e=>{t.geometry.deleteAttribute(e)}),t.geometry.dispose()),t.material&&(Object.keys(t.material).forEach(e=>{t.material[e]&&"function"==typeof t.material[e].dispose&&t.material[e].dispose()}),void 0!==t.material.uniforms&&t.material.uniforms.pointTexture.value.dispose(),t.material.dispose())}
/**
 * @module AxesHelper
 * @description An axis object to visualize the 1, 2 or 3 axes.
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
*/class qn{constructor(t,d){const p=me.THREE,n=this;if((d=d||new A).boOptions){if(!1!==d.axesHelper){d.camera.fov=d.camera.fov||50,d.scales=d.scales||{},d.scales.color=d.scales.color||"rgba(255, 255, 255, 0.5)",d.scales.text.textHeight=d.scales.text.textHeight||.04,d.scales.text.precision=d.scales.text.precision||4,d.scales.text.rect=d.scales.text.rect||{},d.scales.text.rect.displayRect=void 0===d.scales.text.rect.displayRect||d.scales.text.rect.displayRect,d.scales.text.rect.borderRadius=void 0!==d.scales.text.rect.borderRadius?d.scales.text.rect.borderRadius:15,e("x"),e("y"),e("z"),this.options=d;const m=new p.Group;var o;function e(e){e=d.scales[e];e&&(void 0===e.offset&&(e.offset=.1),void 0===e.zoomMultiplier)&&(e.zoomMultiplier=1.1)}function f(e){var i,r,a,n,s,l=e;function c(e){return(d.scales.posAxesIntersection[e]-t.position[e])/t.scale[e]}function u(){return.05/Math.max(Math.max(t.scale.x,t.scale.y),t.scale.z)}this.remove=function(){void 0!==n&&(Xn(n),l.remove(n),a=r=i=n=void 0)},this.dottedLines=function(e){const o=(s=e)instanceof p.Vector4||s instanceof p.Vector3?s:ln(s.object,s.index);{function t(e){var t,n;switch(e){case"x":t=i;break;case"y":t=r;break;case"z":t=a;break;default:return void console.error("AxesHelper.dotLines.dottedLines.dottedLine: axesId = "+axesId)}t&&((n=t.geometry.attributes.position.array)[0]="x"===e?o.x:c("x"),n[1]="y"===e?o.y:c("y"),n[2]="z"===e?o.z:c("z"),n[3]=o.x,n[4]=o.y,n[5]=o.z,e=u(),t.material.dashSize=e,t.material.gapSize=e,t.geometry.attributes.position.needsUpdate=!0)}if(void 0!==n)return t("x"),t("y"),void t("z")}function t(e){var t;if(d.scales[e].isAxis())return(t=[(new p.Vector3).copy(d.scales.posAxesIntersection),o])[0].x="x"===e?t[1].x:c("x"),t[0].y="y"===e?t[1].y:c("y"),t[0].z="z"===e?t[1].z:c("z"),e=u(),void 0===d.colorsHelper&&(d.colorsHelper=128),(t=new p.LineSegments((new p.BufferGeometry).setFromPoints(t),new p.LineDashedMaterial({color:"rgb("+d.colorsHelper+", "+d.colorsHelper+", "+d.colorsHelper+")",dashSize:e,gapSize:e}))).computeLineDistances(),n.add(t),t}f.remove(),n=new p.Group,l.add(n),i=t("x"),r=t("y"),a=t("z")},this.update=function(){void 0!==n&&void 0!==s&&this.dottedLines(s)},this.movePointAxes=function(e,t){var n;switch(e){case mathBox.axesEnum.x:n=i;break;case mathBox.axesEnum.y:n=r;break;case mathBox.axesEnum.z:n=a;break;default:return void console.error("point.userData.movePointAxes: invalid axesId: "+e)}void 0!==n&&(n.geometry.attributes.position.array[e+3]=t,i.geometry.attributes.position.array[e]=t,r.geometry.attributes.position.array[e]=t,a.geometry.attributes.position.array[e]=t,i.geometry.attributes.position.needsUpdate=!0,r.geometry.attributes.position.needsUpdate=!0,a.geometry.attributes.position.needsUpdate=!0)}}m.userData.optionsSpriteText={fontColor:d.scales.color,textHeight:d.scales.text.textHeight,fov:d.camera.fov,rect:d.scales.text.rect},t.add(m),d.scales.posAxesIntersection=d.scales.posAxesIntersection||new p.Vector3,this.createAxis=function(c){const u=new p.Group;u.visible=d.scales.display;var e=d.scales[c];if(e.isAxis()){var t=d.scales.color,n=1;try{var o=d.scales.color.split(/rgba\(\.*/)[1].split(/\)/)[0].split(/, */),t="rgb("+o[0]+", "+o[1]+", "+o[2]+")";void 0!==o[3]&&(n=o[3])}catch(e){}o=new p.Line((new p.BufferGeometry).setFromPoints([new p.Vector3("x"===c&&d.scales.x?d.scales.x.min:0,"y"===c&&d.scales.y?d.scales.y.min:0,"z"===c&&d.scales.z?d.scales.z.min:0),new p.Vector3("x"===c&&d.scales.x?d.scales.x.max:0,"y"===c&&d.scales.y?d.scales.y.max:0,"z"===c&&d.scales.z?d.scales.z.max:0)]),new p.LineBasicMaterial({color:t,opacity:n,transparent:!0}));if("x"!==c&&(o.position.x=d.scales.posAxesIntersection.x),"y"!==c&&(o.position.y=d.scales.posAxesIntersection.y),"z"!==c&&(o.position.z=d.scales.posAxesIntersection.z),o.add(u),o.userData.axisName=c,m.add(o),void 0!==e.marks)for(var i=function(e){e=e||new p.Vector3(0,0,0);const t=new p.Sprite(new p.SpriteMaterial({map:new p.Texture,sizeAttenuation:!1})),n=document.createElement("canvas"),o=(t.material.map.minFilter=p.LinearFilter,n.getContext("2d"));{var i=new p.Vector2("y"!==c?.5:0,"y"===c?.5:1);function r(){return void 0!==d.scales.text.precision?a.toPrecision(d.scales.text.precision):a.toString()}o.fillStyle=d.scales.color,o.fillRect(0,0,n.width,n.height),t.material.map.image=n,t.material.map.needsUpdate=!0,"y"===c?(t.scale.x=n.width/n.height*3/n.width,t.scale.y=1/n.height):(t.scale.x=1/n.width,t.scale.y=3/n.height),t.scale.x*=d.camera.fov/100,t.scale.y*=d.camera.fov/100,t.position.copy(e),t.center=i,t.material.sizeAttenuation=!1,t.material.needsUpdate=!0;var a="x"===c?e.x:"y"===c?e.y:e.z;function s(){var e=(.013-.05)/15;return-3*(r().length*e+.054933333333333334)}const l=new he(r(),new p.Vector3(e.x,e.y,e.z),{group:u,rotation:"y"===c?0:-Math.PI/2,center:new p.Vector2(s(),"x"===c?1:0)});l.userData.updatePrecision=function(){l.userData.updateText(a.toPrecision(d.scales.text.precision)),l.center.x=s()},u.add(l)}return t},t=e.max,r=e.min,a=(t-r)/(e.marks-1),s=0;s<e.marks;s++){var l=s*a+r;u.add(new i(new p.Vector3("x"===c?l:0,"y"===c?l:0,"z"===c?l:0)))}n={center:new p.Vector2("y"===c?1.1:-.1,"y"===c?0:-.1),group:u};u.add(new he(e.name,new p.Vector3("x"===c?e.max:0,"y"===c?e.max:0,"z"===c?e.max:0),n)),u.add(new he(e.name,new p.Vector3("x"===c?e.min:0,"y"===c?e.min:0,"z"===c?e.min:0),n))}},this.createAxis("x"),this.createAxis("y"),this.createAxis("z"),0===m.children.length&&console.warn("AxesHelper: Define at least one axis."),f=new f(t),this.exposePosition=function(e){void 0===(o=e)?(o=void 0,f.remove()):f.dottedLines(e)},this.movePosition=function(){o&&this.exposePosition(o)},this.getGroup=function(){return m},this.updateAxes=function(){function e(t){m.children.forEach(function(e){e.userData.axisName===t&&(m.remove(e),n.createAxis(t))})}e("x"),e("y"),e("z"),f.update()},d.axesHelper=this}}else console.error("AxesHelper: call options = new Options( options ) first")}}
/**
 * @module SpriteTextGui
 * @description Adds SpriteText settings folder into {@link https://github.com/anhr/dat.gui|dat.gui}.
 * @see {@link https://github.com/anhr/SpriteText|SpriteText}
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
*/var Wn=0;function Yn(t,e,n={}){e=new A(e);var o=n.folder||e.dat.gui;if(o&&!1!==e.dat.spriteTextGui){const m=n.optionsSpriteText||t.userData.optionsSpriteText||{},h=me.THREE,g=me.dat;0===Object.keys(m).length&&console.warn("SpriteTextGui: optionsSpriteText is empty."),h.Color.NAMES[m.fontColor]&&(u=new h.Color(m.fontColor),m.fontColor="rgba("+255*u.r+","+255*u.g+","+255*u.b+",1)");const y=JSON.parse(JSON.stringify(m)),v=(Object.freeze(y),{spriteText:"Sprite Text",spriteTextTitle:"Settings for text that always faces towards the camera.",text:"Text",textTitle:"The text to be displayed on the sprite.",textHeight:"Height",textHeightTitle:"Text Height.",fontFace:"Font Face",fontFaces:"Font Faces",fontFaceTitle:"Choose text font.",bold:"Bold",italic:"Italic",rotation:"Rotation",rotationTitle:"Sprite rotation",fontProperties:"Font Properties",fontPropertiesTitle:"Other font properties. The font property uses the same syntax as the CSS font property.",fontStyle:"Font Style",fontStyleTitle:"Text style being used when drawing text. Read only.",displayRect:"Border",displayRectTitle:"Display a border around the text.",borderColor:"Border Color",backgroundColor:"Background Color",borderRadius:"Border Radius",borderThickness:"Border Thickness",fontColor:"Font Color",anchor:"Anchor",anchorTitle:"The text anchor point.",sizeAttenuation:"Size Attenuation",sizeAttenuationTitle:"Whether the size of the sprite is attenuated by the camera depth. (Perspective camera only.)",defaultButton:"Default",defaultTitle:"Restore default Sprite Text settings."}),b=("ru"===e.getLanguageCode()?(v.spriteText="Текстовый спрайт",v.spriteTextTitle="Настройки для текста, который всегда обращен к камере.",v.text="Текст",v.textTitle="Текст, который будет отображен в спрайте.",v.textHeight="Высота",v.textHeightTitle="Высота текста.",v.fontFace="Имя шрифта",v.fontFaces="Имена шрифтов",v.fontFaceTitle="Выберите шрифта текста.",v.bold="Жирный",v.italic="Наклонный",v.rotation="Вращение",v.rotationTitle="Вращение текстового спрайта",v.fontProperties="Дополнительно",v.fontPropertiesTitle="Дополнительные свойства шрифта. Свойство шрифта использует тот же синтаксис, что и свойство шрифта CSS.",v.fontStyle="Стиль шрифта",v.fontStyleTitle="Стиль шрифта, используемый при рисовании текста. Не редактируется.",v.displayRect="Рамка",v.displayRectTitle="Отобразить рамку вокруг текста.",v.borderColor="Цвет рамки",v.backgroundColor="Цвет фона",v.borderRadius="Зкругление углов",v.borderThickness="Толщина рамки",v.fontColor="Цвет шрифта",v.anchor="Якорь",v.anchorTitle="Точка привязки текста.",v.sizeAttenuation="Размер",v.sizeAttenuationTitle="Будет ли размер спрайта зависеть от расстояния до камеры. (Только перспективная камера.)",v.defaultButton="Восстановить",v.defaultTitle="Восстановить настройки текстового спрайта по умолчанию."):void 0!==n.lang&&n.lang.languageCode==_languageCode&&Object.keys(n.lang).forEach(function(e){void 0!==v[e]&&(v[e]=n.lang[e])}),n.spriteFolder=n.spriteFolder||v.spriteText,Wn++,e.dat.getCookieName("SpriteText"+Wn)),_=e.dat.cookie,x=m.group;_.getObject(b,m,m),m.group=x,t instanceof h.Sprite!=!0&&(void 0===t.userData.optionsSpriteText?t.userData.optionsSpriteText=m:void 0!==n.optionsSpriteText&&console.warn("SpriteTextGui: duplicate group.userData.optionsSpriteText"));var i=!0;n.hasOwnProperty("parentFolder")||(n.parentFolder=o);const w=n.parentFolder.addFolder(n.spriteFolder);g.folderNameAndTitle(w,n.spriteFolder,v.spriteTextTitle);var r,a,s,l,c,u="textHeight",o=(m.hasOwnProperty(u)&&void 0!==m[u]&&(o=w,l=m,u=u,r=function(){f()},p=(p={text:v.textHeight,textTitle:v.textHeightTitle,getLanguageCode:n.getLanguageCode,settings:n.settings})||{},d=me.dat,a=o.add(new Ye(function(e,t){t=t(s.getValue(),a.getValue());s.setValue(t),r(t)},{getLanguageCode:p.getLanguageCode,settings:p.settings})).onChange(function(e){a.zoomMultiplier=e}),s=d.controllerZeroStep(o,l,u,function(e){r(e)}),p.text)&&d.controllerNameAndTitle(s,p.text,p.textTitle),void 0!==m.fontFace&&g.controllerNameAndTitle(w.add(m,"fontFace").onChange(function(e){f()}),v.fontFace),void 0!==m.fontFaces&&g.controllerNameAndTitle(w.add(m,"fontFace",m.fontFaces).onChange(function(e){f()}),v.fontFaces,v.fontFaceTitle),m.hasOwnProperty("bold")&&g.controllerNameAndTitle(w.add(m,"bold").onChange(function(e){f()}),v.bold),m.hasOwnProperty("italic")&&g.controllerNameAndTitle(w.add(m,"italic").onChange(function(e){f()}),v.italic),"rotation");if(m.hasOwnProperty(o)&&(l=2*Math.PI,g.controllerNameAndTitle(w.add(m,o,0,l,l/360).onChange(function(e){f()}),v.rotation,v.rotationTitle)),m.hasOwnProperty("fontProperties")&&g.controllerNameAndTitle(w.add(m,"fontProperties").onChange(function(e){f()}),v.fontProperties,v.fontPropertiesTitle),m.hasOwnProperty("font")&&((c=w.add(m,"font")).__input.readOnly=!0,g.controllerNameAndTitle(c,v.fontStyle,v.fontStyleTitle)),m.hasOwnProperty("rect")){void 0===m.rect.displayRect&&(m.rect.displayRect=!1),g.controllerNameAndTitle(w.add(m.rect,"displayRect").onChange(function(e){f(),S.domElement.style.display=m.rect.displayRect?"block":"none"}),v.displayRect,v.displayRectTitle);const S=w.addFolder(v.displayRect);S.domElement.style.display=m.rect.displayRect?"block":"none";var d="borderThickness",p=(m.rect.hasOwnProperty(d)&&g.controllerNameAndTitle(S.add(m.rect,d,1,30*m.rect.borderThickness,1).onChange(function(e){f()}),v.borderThickness),"borderColor"),o=(m.rect.hasOwnProperty(p)&&g.controllerNameAndTitle(S.addColor(m.rect,p).onChange(function(e){f()}),v.borderColor),"backgroundColor"),o=(m.rect.hasOwnProperty(o)&&g.controllerNameAndTitle(S.addColor(m.rect,o).onChange(function(e){f()}),v.backgroundColor),"borderRadius");m.rect.hasOwnProperty(o)&&g.controllerNameAndTitle(S.add(m.rect,o,0,100,1).onChange(function(e){f()}),v.borderRadius)}m.hasOwnProperty("fontColor")&&g.controllerNameAndTitle(w.addColor(m,"fontColor").onChange(function(e){f()}),v.fontColor),m.hasOwnProperty("center")&&(m.center=he.getCenter(m.center),o=w.addFolder("center"),g.folderNameAndTitle(o,v.anchor,v.anchorTitle),o.add(m.center,"x",0,1,.1).onChange(function(e){f()}),o.add(m.center,"y",0,1,.1).onChange(function(e){f()}));o="sizeAttenuation",o=(m.hasOwnProperty(o)&&void 0!==m[o]&&g.controllerNameAndTitle(w.add(m,o).onChange(function(e){f()}),v.sizeAttenuation,v.sizeAttenuationTitle),w.userData={options:e,restore:function(e){function o(e,n,o){e.__controllers.forEach(function(t){if(t.property!==n)return"object"!=typeof o[n]?void 0:void Object.keys(o[n]).forEach(function(e){t.property===e&&t.setValue(o[n][e])});t.setValue(o[n])})}i=!1,Object.keys(y).forEach(function(n){o(w,n,y),"object"==typeof y[n]&&Object.keys(y[n]).forEach(function(t){Object.keys(w.__folders).forEach(function(e){o(w.__folders[e],t,y[n])})}),Object.keys(w.__folders).forEach(function(t){t===n&&Object.keys(y[t]).forEach(function(e){o(w.__folders[t],e,y[t])})})}),i=!0,f()}},{defaultF:w.userData.restore});return void 0===y&&console.error("SpriteTextGui: optionsDefault = "+y),g.controllerNameAndTitle(w.add(o,"defaultF"),v.defaultButton,v.defaultTitle),f(!0),w;function f(e){i&&(he.updateSpriteTextGroup(t),t.userData.update&&t.userData.update(),void 0!==c&&c.setValue(m.font),e||_.setObject(b,m))}}}
/**
 * @module AxesHelperGui
 * @description Adds <a href="../../AxesHelper/jsdoc/module-AxesHelper-AxesHelper.html" target="_blank">AxesHelper</a> settings folder into {@link https://github.com/anhr/dat.gui|dat.gui}.
 * @see {@link https://github.com/anhr/AxesHelper|AxesHelper}
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
*/function Zn(l,e){if(!l.boOptions)return void console.error("AxesHelperGui: call options = new Options( options ) first");if(!(e=e||l.dat.gui)||!1===l.dat||!1===l.dat.axesHelperGui)return;if(!1===l.axesHelper)return;if(!l.axesHelper)return void console.error("AxesHelperGui: create AxesHelper instance first");const n=me.THREE,c=me.dat,u=JSON.parse(JSON.stringify(l.scales)),d=l.axesHelper.getGroup(),p=(u.posAxesIntersection=(new n.Vector3).copy(l.scales.posAxesIntersection),Object.freeze(u),{axesHelper:"Axes Helper",scales:"Scales",displayScales:"Display",displayScalesTitle:"Display or hide axes scales.",precision:"Precision",precisionTitle:"Formats a number to a specified length.",min:"Min",max:"Max",marks:"Marks",marksTitle:"Number of scale marks",axesIntersection:"Axes Intersection",defaultButton:"Default",defaultTitle:"Restore default Axes Helper settings.",defaultAxesIntersectionTitle:"Restore default axes intersection."}),t=("ru"===(l=l||{}).getLanguageCode()?(p.axesHelper="Оси координат",p.scales="Шкалы",p.displayScales="Показать",p.displayScalesTitle="Показать или скрыть шкалы осей координат.",p.precision="Точность",p.precisionTitle="Ограничить количество цифр в числе.",p.min="Минимум",p.max="Максимум",p.marks="Риски",p.marksTitle="Количество отметок на шкале",p.axesIntersection="Начало координат",p.defaultButton="Восстановить",p.defaultTitle="Восстановить настройки осей координат по умолчанию.",p.defaultAxesIntersectionTitle="Восстановить начало координат по умолчанию."):void 0!==l.lang&&l.lang.languageCode==languageCode&&Object.keys(l.lang).forEach(function(e){void 0!==p[e]&&(p[e]=l.lang[e])}),l.dat.cookie),o=l.dat.getCookieName("AxesHelper");function f(){t.setObject(o,l.scales)}t.getObject(o,l.scales,l.scales);const m=e.addFolder(p.axesHelper);var i,e=m.addFolder(p.scales);const r=e.add(l.scales,"display").onChange(function(t){d.children.forEach(function(e){e.children.forEach(function(e){e.visible=t})}),b(),f()}),a=(c.controllerNameAndTitle(r,p.displayScales,p.displayScalesTitle),void 0!==l.scales.text.precision&&(i=e.add(l.scales.text,"precision",2,17,1).onChange(function(e){!function t(e){e.children.forEach(function(e){e instanceof n.Sprite?void 0!==e.userData.updatePrecision&&e.userData.updatePrecision():(e instanceof n.Group||e instanceof n.Line)&&t(e)})}(d),f()}),c.controllerNameAndTitle(i,p.precision,p.precisionTitle)),void 0===Yn?void 0:Yn(d,{dat:{gui:l.dat.gui,cookieName:"AxesHelper_"+l.dat.getCookieName()}},{parentFolder:e})),s=m.addFolder(p.axesIntersection),h={x:{},y:{},z:{}};function g(t){var e,n=l.scales[t];n.isAxis()&&((e=h[t]).controller=s.add({value:l.scales.posAxesIntersection[t]},"value",n.min,n.max,(n.max-n.min)/100).onChange(function(e){l.scales.posAxesIntersection[t]=e,l.axesHelper.updateAxes(),f()}),c.controllerNameAndTitle(e.controller,n.name))}g("x"),g("y"),g("z");e={defaultF:function(e){h.x.controller.setValue(u.posAxesIntersection.x),h.y.controller.setValue(u.posAxesIntersection.y),h.z.controller.setValue(u.posAxesIntersection.z)}};function y(t){const n=l.scales[t];if(void 0!==n){const a=v[t],s=u[t];Object.freeze(s),a.updateAxis=o,a.onchangeWindowRange=i,a.folder=m.addFolder(n.name),a.scaleController=a.folder.add(new Ye(r,{settings:n,getLanguageCode:l.getLanguageCode})).onChange(function(e){n.zoomMultiplier=e,f()});var e=new Ze(function(n){r(e,function(e,t){return e+=n})},{settings:n,getLanguageCode:l.getLanguageCode});function o(){d.children.forEach(function(e){e.userData.axisName===t&&(d.remove(e),l.axesHelper.createAxis(t))})}function i(){o(),f()}function r(e,t){e=e.controller.getValue();n.min=t(n.min,e),a.min.setValue(n.min),n.max=t(n.max,e),a.max.setValue(n.max),i(n)}a.positionController=a.folder.add(e).onChange(function(e){n.offset=e,f()}),a.min=c.controllerZeroStep(a.folder,n,"min",function(e){i()}),c.controllerNameAndTitle(a.min,p.min),a.max=c.controllerZeroStep(a.folder,n,"max",function(e){i()}),c.controllerNameAndTitle(a.max,p.max),void 0!==n.marks&&(a.marks=c.controllerZeroStep(a.folder,n,"marks",function(e){i()}),c.controllerNameAndTitle(a.marks,void 0===n.marksName?p.marks:n.marksName,(void 0===n.marksTitle?p:n).marksTitle)),a.defaultButton=a.folder.add({defaultF:function(e){n.min=s.min,a.min.setValue(n.min),n.max=s.max,a.max.setValue(n.max),n.zoomMultiplier=s.zoomMultiplier,a.scaleController.setValue(n.zoomMultiplier),n.offset=s.offset,a.positionController.setValue(n.offset),void 0!==s.marks&&(n.marks=s.marks,a.marks.setValue(n.marks)),i(n)}},"defaultF"),c.controllerNameAndTitle(a.defaultButton,p.defaultButton,p.defaultTitle)}}c.controllerNameAndTitle(s.add(e,"defaultF"),p.defaultButton,p.defaultAxesIntersectionTitle),m.add(new Ye(function(e,t){function n(e,t){void 0!==e&&(e.min=i(e.min,o),t.min.setValue(e.min),e.max=i(e.max,o),t.max.setValue(e.max),t.onchangeWindowRange())}var o,i;o=e.controller.getValue(),i=t,n(l.scales.x,v.x),n(l.scales.y,v.y),n(l.scales.z,v.z)},{settings:{zoomMultiplier:1.1},getLanguageCode:l.getLanguageCode})).onChange(function(e){console.warn("ScaleController.onChange")});const v={x:{},y:{},z:{}};y("x"),y("y"),y("z");e={defaultF:function(e){function t(e){v[e].defaultButton&&v[e].defaultButton.object.defaultF()}r.setValue(u.display),void 0!==i&&i.setValue(u.text.precision),a.userData.restore(),t("x"),t("y"),t("z")}};function b(){var e=l.scales.display?"block":"none";void 0!==a&&(a.domElement.style.display=e),void 0!==i&&(i.domElement.parentElement.parentElement.style.display=e)}c.controllerNameAndTitle(m.add(e,"defaultF"),p.defaultButton,p.defaultTitle),b(),v.x.updateAxis&&v.x.updateAxis(),v.y.updateAxis&&v.y.updateAxis(),v.z.updateAxis&&v.z.updateAxis()}
/**
 * @module OrbitControlsGui
 * @description [OrbitControls]{@link https://threejs.org/docs/index.html#examples/en/controls/OrbitControls} graphical user interface
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */class Jn{constructor(t,e){if(!t.boOptions)return void console.error("OrbitControlsGui: call options = new Options( options ) first");if(!(e=e||t.dat.gui)||!t.orbitControls||!1===t.dat.orbitControlsGui)return;const i=me.dat,r=t.orbitControls,a=(t.orbitControlsGui=this,r.addEventListener("change",function(){c&&c.setValue(r.target.x),u&&u.setValue(r.target.y),d&&d.setValue(r.target.z)}),{orbitControls:"Orbit Controls",defaultButton:"Default",defaultTitle:"Restore default Orbit controls settings.",target:"Target"});var n=void 0===t.getLanguageCode?"en":t.getLanguageCode(),n=("ru"===n?(a.defaultButton="Восстановить",a.defaultTitle="Восстановить настройки Orbit controls по умолчанию."):void 0!==t.lang&&t.lang.languageCode==n&&Object.keys(t.lang).forEach(function(e){void 0!==a[e]&&(a[e]=t.lang[e])}),e.addFolder(a.orbitControls)),e=t.scales.x?n.addFolder(t.scales.x.name):void 0,o=t.scales.y?n.addFolder(t.scales.y.name):void 0,s=t.scales.z?n.addFolder(t.scales.z.name):void 0;function l(e,t){if(!e)return;function n(e){void 0===e&&(e=0),r.target[t]=e,r.update(),o.setValue(e)}e.add(new Ze(function(e){n(r.target[t]+e)}));const o=i.controllerZeroStep(e,r.target,t,function(e){n(e)});return i.controllerNameAndTitle(o,a.target),i.controllerNameAndTitle(e.add({defaultF:function(e){n()}},"defaultF"),a.defaultButton,a.defaultTitle),o}const c=l(e,"x"),u=l(o,"y"),d=l(s,"z");i.controllerNameAndTitle(n.add({defaultF:function(e){r.reset(),c.setValue(r.target.x),u.setValue(r.target.y),d.setValue(r.target.z)}},"defaultF"),a.defaultButton,a.defaultTitle),this.setTarget=function(e){c&&c.setValue(e.x),u&&u.setValue(e.y),d&&d.setValue(e.z)}}}
/**
 * Modify of the dat object.
 * @see {@link https://github.com/dataarts/dat.gui} about dat.gui
 *
 * @author Andrej Hristoliubov https://anhr.github.io/AboutMe/
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */function d(){}function Kn(e,t,n){void 0===t&&console.warn("elNameAndTitle: name = "+t),e.innerHTML=t,void 0!==n&&(e.title=n)}void 0!==d&&(d.GUI=we,void 0===d.controllerNameAndTitle?d.controllerNameAndTitle=function(e,t,n){Kn(e.__li.querySelector(".property-name"),t,n)}:console.error("Duplicate dat.controllerNameAndTitle method."),void 0===d.folderNameAndTitle?d.folderNameAndTitle=function(e,t,n){Kn(e.__ul.querySelector("li.title"),t,n)}:console.error("Duplicate dat.folderNameAndTitle method."),void 0===d.controllerZeroStep?d.controllerZeroStep=function(e,n,o,i){"number"!=typeof n[o]&&console.warn("typeof object[property] = "+typeof n[o]);var e=e.add(n,o),r=e.__input;return e.__input=document.createElement("input"),r.value=n[o],r.onchange=function(e){n[o]=parseFloat(r.value),void 0!==i&&i(n[o])},e.setValue=function(e,t){r.value=n[o]=e,t&&i&&i(n[o])},e}:console.error("Duplicate dat.controllerZeroStep method."),void 0===d.controllerSetValue?d.controllerSetValue=function(e,t){e.setValue(t),e.__li.querySelector("select").selectedIndex=t}:console.error("Duplicate dat.controllerSetValue method."))
/**
 * @module functionsFolder
 * @description Adds the [Functions]{@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function} folder into [dat.gui]{@link https://github.com/anhr/dat.gui}.
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */;class Qn{constructor(e,s,l,n){if(l.boOptions){const i=me.dat,m=me.THREE,r=l.scales,h=this;var c=!1,u=!1;const a={functions:"Functions",defaultButton:"Default",defaultTitle:"Restore default functions."};var t=void 0===l.getLanguageCode?"en":l.getLanguageCode();"ru"===t?(a.functions="Функции",a.defaultButton="Восстановить",a.defaultTitle="Восстановить функции."):void 0!==l.lang&&l.lang.languageCode==t&&Object.keys(l.lang).forEach(function(e){void 0!==a[e]&&(a[e]=l.lang[e])}),n?(n.x=p(n.x),n.y=p(n.y),n.z=p(n.z)):n={x:"",y:"",z:""};const g=e.addFolder(a.functions),y={x:n.x,y:n.y,z:n.z,w:n.w},v={},b=(o("x"),o("y"),o("z"),o("w"),g.add({defaultF:function(e){}},"defaultF"));function o(t){void 0!==n[t]&&(v[t]=g.add(n,t).onFinishChange(function(e){f(e,t,y)}),i.controllerNameAndTitle(v[t],d(t)))}function d(e){return r[e]&&r[e].name?r[e].name:e}function p(e){if(void 0!==e){if("object"==typeof e){if(e instanceof m.Color)return e.getStyle();if(Array.isArray(e))return JSON.stringify(e);e=e.func||e}var t=typeof e;switch(t){case"number":e=e.toString();case"string":return e;case"function":return e.toString().split(/return (.*)/)[1];default:return void console.error("functionsFolder.getFuncText(...): typeof func = "+t)}}}function f(t,n,e){if(e[n]!==t||c)try{c=!1;var o,i=typeof(e[n]=t);switch(i){case"string":var r,a=parseFloat(t);if(a.toString()!==t)if(5===t.replace(/\s/g,"").split(/rgb\((\d+),(\d+),(\d+)\)/).length)o=new m.Color(t);else{try{r=JSON.parse(t)}catch(e){}o=Array.isArray(r)?r:new Function("t","a","b","return "+t)}else o=a;break;case"number":o=t;break;default:return void console.error("onFinishChange( "+t+" ): invalid type = "+i)}s(o,n,t),u=!1}catch(e){u||(alert("Axis: "+d(n)+'. Function: "'+t+'". '+e),u=!0),h.setFocus(n)}}i.controllerNameAndTitle(b,a.defaultButton,a.defaultTitle),this.setFunction=function(n){if(n=n||l.vector){const r={x:n?p(n.x):"",y:n?p(n.y):"",z:n?p(n.z):"",w:n?p(n.w):""},a={x:r.x,y:r.y,z:r.z,w:r.w};n.vectorDefault||(n.vectorDefault={x:r.x,y:r.y,z:r.z,w:r.w}),i("x"),i("y");var e=!1,t=(n.z&&(i("z"),e=!0),b.object.defaultF=function(e){function t(e){v[e]&&(v[e].setValue(n.vectorDefault[e]),v[e].__onFinishChange(n.vectorDefault[e]))}t("x"),t("y"),t("z"),t("w")},v.z);if(void 0!==t){"boolean"==typeof e&&(e=e?"block":"none");for(var o=t.domElement;"LI"!==o.tagName.toUpperCase();)o=o.parentElement;o.style.display=e}function i(t){void 0!==n[t]&&(v[t].__onFinishChange=function(e){f(e,t,a)},r[t]=p(n[t]),v[t].setValue(r[t]),a[t]=r[t])}i("w")}},this.setFunction(),this.displayFolder=function(e){g.domElement.style.display="boolean"==typeof e?e?"block":"none":e},this.setFocus=function(e){v[e].domElement.childNodes[0].focus(),c=!0},this.update=function(t){function e(e){v[e].getValue()!==t[e]&&v[e].setValue(t[e])}e("x"),e("y"),e("z"),e("w")}}else console.error("functionsFolder: call options = new Options( options ) first")}}
/**
 * @module GuiSelectPoint
 *
 * @description A dat.gui based graphical user interface for select a point from the mesh.
 *
 * @see {@link https://github.com/anhr/dat.gui|dat.gui}, {@link https://threejs.org/docs/index.html#api/en/objects/Mesh|three.js mesh}.
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
*/const $n="none",eo="block";class to{constructor(h,g={}){const r=this,y=me.THREE,v={};if(h.boOptions)if(!1!==h.dat.guiSelectPoint&&h.dat.gui){const U=me.dat;var b;h.guiSelectPoint=r;const de=h.getLanguageCode,X={meshs:"Meshes",notSelected:"Not selected",select:"Select",position:"Position",rotation:"Rotation",points:"Points",displayVerticeID:"Point ID",displayVerticeIDTitle:"Display on the scene the point ID near to the point",cameraTarget:"Look",cameraTargetTitle:"Choose this point the camera is looking at.",point:"Point Local Position",pointTitle:"The position attribute of the selected point",trace:"Trace",traceTitle:"Display the trace of the point movement.",traceAllTitle:"Display the trace of the movement of all points of the mesh.",pointWorld:"Point World Position",pointWorldTitle:"The position of the selected point after scaling, moving and rotation of the mesh",mesh:"Mesh",scale:"Scale",color:"Сolor",opacity:"Opacity",opacityTitle:"Float in the range of 0.0 - 1.0 indicating how transparent the material is. A value of 0.0 indicates fully transparent, 1.0 is fully opaque.",defaultButton:"Default",defaultScaleTitle:"Restore default 3d object scale.",defaultPositionTitle:"Restore default 3d object position.",default3DObjectTitle:"Restore default settings of all 3d objects.",defaultRotationTitle:"Restore default 3d object rotation.",defaultLocalPositionTitle:"Restore default local position.",moveGroup:"Move Scene"};"ru"===de()&&(X.meshs="3D объекты",X.notSelected="Не выбран",X.select="Выбрать",X.position="Позиция",X.rotation="Вращение",X.points="Точки",X.displayVerticeID="Номера точек",X.displayVerticeIDTitle="На сцене возле каждой точки показать ее идентификатор",X.cameraTarget="Следить",X.cameraTargetTitle="Выберите эту точку, за которой следит камера.",X.point="Локальная позиция точки",X.pointTitle="Position attribute выбранной точки",X.trace="Трек",X.traceTitle="Показать трек перемещения точки.",X.traceAllTitle="Показать трек перемещения всех точек выбранного 3D объекта.",X.pointWorld="Абсолютная позиция точки",X.pointWorldTitle="Позиция выбранной точки после масштабирования, перемещения и вращения 3D объекта",X.mesh="3D объект",X.scale="Масштаб",X.color="Цвет",X.opacity="Непрозрачность",X.opacityTitle="Число в диапазоне 0,0 - 1,0, указывающее, насколько прозрачен материал. Значение 0.0 означает полностью прозрачный, 1.0 - полностью непрозрачный.",X.defaultButton="Восстановить",X.defaultScaleTitle="Восстановить масштаб 3D объекта по умолчанию.",X.defaultPositionTitle="Восстановить позицию 3D объекта по умолчанию.",X.default3DObjectTitle="Восстановить настройки всех 3D объектов по умолчанию.",X.defaultRotationTitle="Восстановить поворот 3D объекта по умолчанию.",X.defaultLocalPositionTitle="Восстановить локальную позицию точки по умолчанию.");var _,x,K,Q,w,S,T,E,C,A,P,O,k,z,L,N,M,F,D,V,I,$,R,ee,f,te=!1;const pe=this,q=new y.Vector3,W=new y.Vector3,Y=new y.Vector3,a=(h.frustumPoints&&(b=new h.frustumPoints.guiSelectPoint),e=>e?e.domElement.querySelector("input"):void 0),Z=(e,t)=>{e=a(e);e&&(e.readOnly=t)},fe=e=>{e=a(e);if(e)return e.readOnly},J=(this.exposePosition=B,this.setReadOnlyPosition=function(e){Z(k,e),Z(z,e),Z(L,e),Z(N,e)},this.setAxisControl=function(e,t){"w"===e?(null!=t.min&&N.min(t.min),null!=t.max&&N.max(t.max),null!=t.step&&N.step(t.step)):console.error("GuiSelectPoint.setAxisControl. Invalid axis: "+e)},this.setAxisName=function(e,t){q[e].name(t),v.position[e].name=t;("x"===e?C:"y"===e?A:"z"===e?P:void 0).name(t);e=W[e];e.name&&e.name(t)},this.setMesh=function(){te=!0,ie(),re(),ae(),B(),te=!1},this.setPosition=function(e){for(var t=0;t<S.__select.length;t++){var n=S.__select[t];n.selected&&Object.is(n.mesh,e.object)&&o(e)}},this.update=function(e=!1){var t,n,o=S.__select.options[S.__select.options.selectedIndex];o&&(o=o.mesh)&&-1!==(t=this.getSelectedPointIndex())&&(n=ln(o,t),Y.x&&Y.x.setValue(n.x),Y.y&&Y.y.setValue(n.y),Y.z&&Y.z.setValue(n.z),N&&n instanceof y.Vector4&&N.setValue(n.w),n=an(o,t),e&&(k&&(k.initialValue=n.x),z&&(z.initialValue=n.y),L&&(L.initialValue=n.z),N)&&(N.initialValue=n.w),k&&k.setValue(n.x),z&&z.setValue(n.y),L&&L.setValue(n.z),$.update(o.userData.player.arrayFuncs[t]))},this.getMeshIndex=function(e){if(void 0===e)return e;for(var t=0;t<S.__select.options.length;t++){var n=S.__select.options[t];if(Object.is(n.mesh,e))return t}},this.setIndexMesh=function(e,t){void 0!==e&&(S.__select.options[e].mesh=t,this.selectPoint(-1))},this.selectPoint=function(e){O.__onChange(e),O.__select[e+1].selected=!0},this.removeMesh=function(e,t=!0){var e=this.getMeshIndex(e),n=S.__select.selectedIndex;void 0!==e&&(S.__select.remove(e),n===e&&(O.__onChange(-1),pe.removePoints(),S.__onChange(-1)),S.__select.options.length<2)&&t&&(_.domElement.style.display="none")},[]);return this.addMesh=function(e){if(e.parent)if(_||this.add(),_.domElement.style.display="block",S){for(o=0;o<S.__select.options.length;o++){var t=S.__select.options[o];if(e.userData.boFrustumPoints&&void 0!==t.mesh&&t.mesh.userData.boFrustumPoints)return;if(void 0!==t.mesh&&t.mesh.uuid===e.uuid)return void console.error("guiSelectPoint.addMesh(...): Duplicate mesh.")}var n=document.createElement("option");n.innerHTML=S.__select.length+" "+(""===e.name?e.constructor:e).name,(n.mesh=e).userData.default=e.userData.default||{scale:(new y.Vector3).copy(e.scale),position:e.position instanceof y.Vector3?(new y.Vector3).copy(e.position):e.position instanceof y.Vector4?(new y.Vector4).copy(e.position):void 0,rotation:(new y.Euler).copy(e.rotation)},S.__select.appendChild(n),le(e)}else{for(var o=0;o<J.length;o++)if(J[o].uuid===e.uuid)return void console.error("guiSelectPoint.addMesh: Duplicate mesh: "+e.name);J.push(e)}else console.error("GuiSelectPoint.addMesh: Add mesh into scene first.")},this.select=function(t){an(t.object,t.index);void 0===_&&console.error("Не знаю как сюда попасть");var e=this.getMeshIndex(t.object);e&&(!1===S.__select[e].selected?(S.__select[e].selected=!0,S.__onChange(e-1)):ee&&(e=G(),ee.object(t.event&&0===t.event.button?e:void 0,U,h)),this.selectPoint2=function(e){void 0===t.index||isNaN(t.index)||void 0!==e&&!Object.is(t.object,e)||(t.object.userData.boFrustumPoints?b.pointIndexes(t.object.userData.pointIndexes(t.index)):(e=O.__select[t.index+1])&&(e.selected=!0),ne("block"),E=t,g.setIntersection&&g.setIntersection(t),o(t),e=(e=G()).userData.player&&void 0!==e.userData.player.arrayFuncs&&"function"!=typeof E.object.userData.player.arrayFuncs?e.userData.player.arrayFuncs[t.index].line:void 0,M&&M.setValue(void 0!==e&&e.isVisible()),K.domElement.parentElement.parentElement.style.display=E.object.userData.player&&void 0!==E.object.userData.player.arrayFuncs?"block":"none")},this.selectPoint2(void 0))},this.isSelectedMesh=function(e){return G()===e},this.getSelectedPointIndex=function(){var e;return void 0!==b&&b.isDisplay()&&h.frustumPoints&&h.frustumPoints.isDisplay()?null===(e=b.getSelectedIndex())?-1:e:void 0!==O&&G()?O.__select.selectedOptions[0].index-1:-1},this.updateScale=function(e){var t,n,o="none",i=h.scales[e].isAxis()?"block":o,r=h.scales.x.isAxis(),a=h.scales.y.isAxis(),s=h.scales.z.isAxis(),l=0;switch(r&&l++,a&&l++,s&&l++,l){case 1:R&&(R.domElement.style.display=o);break;case 2:R.domElement.style.display="block",r&&W.x.domElement&&(W.x.domElement.parentElement.parentElement.style.display=o),a&&W.y.domElement&&(W.y.domElement.parentElement.parentElement.style.display=o),s&&W.z.domElement&&(W.z.domElement.parentElement.parentElement.style.display=o);break;default:return void console.error("GuiSelectPoint.updateScale: Invalid space dimension = "+l)}if(v.position[e]){switch(v.position[e].domElement.style.display=i,Y[e].domElement.parentElement.parentElement.style.display=i,e){case"x":t=k,n=C;break;case"y":t=z,n=A;break;case"z":t=L,n=P;break;default:return void console.error("GuiSelectPoint.updateScale: Invalid axis name: "+e)}t.domElement.parentElement.parentElement.style.display=i,n.domElement.parentElement.parentElement.style.display=i}else h.scales[e].isAxis()&&console.error("GuiSelectPoint.updateScale: Under constraction.")},this.add=function(e){if(e=e||h.dat.gui){(_=e.addFolder(X.meshs)).domElement.style.display="none",S=_.add({Meshs:X.notSelected},"Meshs",{[X.notSelected]:-1}).onChange(function(e){e=parseInt(e),O.__onChange(-1),r=G();var t,n,o="none",i="block";x.fCustomPoint&&(x.removeFolder(x.fCustomPoint),delete x.fCustomPoint),r&&r.userData.gui&&(x.fCustomPoint=r.userData.gui.addControllers(x)),ee&&ee.object(r,U,-1===e),ue(r),void 0===r?(t=o,(r=void 0)!==h.axesHelper&&h.axesHelper.exposePosition(ln(G(),e))):(e=void 0===r.userData.default?o:i,a.domElement.parentElement.parentElement.style.display=e,s.domElement.parentElement.parentElement.style.display=e,l&&(l.domElement.parentElement.parentElement.style.display=e),e=o,n=t=i,O.__onChange(-1),pe.removePoints(),void 0!==r.userData.controllers?r.userData.controllers():(e=i,n=o,r.geometry&&r.geometry.attributes&&ce(r)),j(O,e),F&&j(F,!!h.player&&e),void 0!==b&&b.display(n),ie(),re(),ae(),c=void 0),T.domElement.style.display=t,void 0!==r&&void 0!==r.userData.traceAll&&F.setValue(r.userData.traceAll)}),U.controllerNameAndTitle(S,X.select),(T=_.addFolder(X.mesh)).domElement.style.display="none",T.open();var r,a,s,l,e=T.addFolder(X.scale),t=(e.add(new Ye(function(e,t){e=e.controller.getValue();r.scale.x=t(r.scale.x,e),r.scale.y=t(r.scale.y,e),r.scale.z=t(r.scale.z,e),r.needsUpdate=!0,ie(),B(),h.frustumPoints&&h.frustumPoints.updateCloudPoint(r)},{settings:{zoomMultiplier:1.1},getLanguageCode:de,newBool:!0})),new y.Vector3);h.scales.x.isAxis()&&(C=U.controllerZeroStep(e,t,"x",function(e){d("x",e)}),U.controllerNameAndTitle(C,h.scales.x.name)),h.scales.y.isAxis()&&(A=U.controllerZeroStep(e,t,"y",function(e){d("y",e)}),U.controllerNameAndTitle(A,h.scales.y.name)),h.scales.z.isAxis()&&(P=U.controllerZeroStep(e,t,"z",function(e){d("z",e)}),U.controllerNameAndTitle(P,h.scales.z.name)),a=e.add({defaultF:function(e){r.scale.copy(r.userData.default.scale),r.needsUpdate=!0,ie(),B()}},"defaultF"),U.controllerNameAndTitle(a,X.defaultButton,X.defaultScaleTitle);const f=T.addFolder(X.position);p("x"),p("y"),p("z"),s=f.add({defaultF:function(e){r.position.copy(r.userData.default.position),r.needsUpdate=!0,re(),B()}},"defaultF"),U.controllerNameAndTitle(s,X.defaultButton,X.defaultPositionTitle),!function(){var e=h.scales.x.isAxis(),t=h.scales.y.isAxis(),n=h.scales.z.isAxis(),o=0;if(e&&o++,t&&o++,n&&o++,1!==o){switch(R=T.addFolder(X.rotation),o){case 2:i(e?t?"z":"y":"x");break;case 3:i("x"),i("y"),i("z");break;default:return console.error("GuiSelectPoint.updateScale: Invalid space dimension = "+o)}l=R.add({defaultF:function(e){r.rotation.copy(r.userData.default.rotation),r.needsUpdate=!0,ae(),B()}},"defaultF"),U.controllerNameAndTitle(l,X.defaultButton,X.defaultRotationTitle)}function i(n){var e=h.scales[n];W[n]=R.add(new y.Vector3,n,0,2*Math.PI,.01).onChange(function(e){var t=G();t.userData.boFrustumPoints||(t.rotation[n]=e,t.needsUpdate=!0),te||B(),void 0!==h.frustumPoints&&h.frustumPoints.updateCloudPoint(t)}),U.controllerNameAndTitle(W[n],e.name)}}(),w=T.addFolder(X.points);let o;(O=w.add({Points:X.notSelected},"Points",{[X.notSelected]:-1}).onChange(function(e){var t;e=parseInt(e);let n=G();n&&n.userData.gui&&n.userData.gui.reset&&(o=n),-1===e?t="none":(t="block",pe.select({object:n,index:e})),!1!==h.axesHelper&&void 0!==h.axesHelper&&h.axesHelper.exposePosition(ln(n,e)),ne(t),(n=n&&n.userData.gui&&n.userData.gui.reset?n:o)&&n.userData.gui&&n.userData.gui.reset&&n.userData.gui.reset(e)})).__select[0].selected=!0,U.controllerNameAndTitle(O,X.select),void 0!==b&&b.create(w,de()),g.myThreejs&&(g.myThreejs.cFrustumPoints=b),h.dat.guiSelectPoint=h.dat.guiSelectPoint||{},h.dat.guiSelectPoint.boDisplayVerticeID=h.dat.guiSelectPoint.boDisplayVerticeID||!1;var c,t=_.add(h.dat.guiSelectPoint,"boDisplayVerticeID").onChange(function(e){for(var t=1;t<S.__select.options.length;t++){var n=S.__select.options[t];void 0===n.mesh?console.error("guiSelectPoint: cDisplayVerticeID.onChange. Invalud option.mesh"):le(n.mesh)}});if(U.controllerNameAndTitle(t,X.displayVerticeID,X.displayVerticeIDTitle),h.dat&&h.dat.guiSelectPoint&&h.dat.guiSelectPoint.point&&(ee=h.dat.guiSelectPoint.point(h,U,T)),h.player){g.cameraTarget&&h.playerOptions.cameraTarget.init(g.cameraTarget,h);const m=h.playerOptions.cameraTarget.get(h);m&&(I=w.add(m,"boLook").onChange(function(e){const t=G();if(t.userData.boFrustumPoints)e&&(console.warn("guiSelectPoint.cCameraTarget.onChange(...). The camera can not look at the frustum point."),I.setValue(!1));else{if(!t.userData.player){t.userData.player={arrayFuncs:[]};for(var n=0;n<t.geometry.attributes.position.count;n++)t.userData.player.arrayFuncs.push((new y.Vector3).fromArray(t.geometry.attributes.position.array,n*t.geometry.attributes.position.itemSize))}for(var o=t.userData.boFrustumPoints?b.getSelectedIndex():O.__select.options.selectedIndex-1,i="function"==typeof t.userData.player.arrayFuncs?(new y.Vector3).fromArray(t.userData.player.arrayFuncs().attributes.position.array,3*o):void 0!==t.userData.player.arrayFuncs?t.userData.player.arrayFuncs[o]:(new y.Vector3).fromArray(t.geometry.attributes.position.array,3*o),n=0;n<S.__select.options.length;n++){const t=S.__select.options[n].mesh;if(t&&t.userData.player&&t.userData.player.arrayFuncs)for(var r=t.userData.player.arrayFuncs,a=0;a<r.length;a++)r[a].cameraTarget&&(r[a].cameraTarget.boLook=!1)}i.cameraTarget&&(i.cameraTarget.boLook=e),h.player&&h.player.selectScene(),h.cameraGui&&h.cameraGui.look(e),e?i.cameraTarget||(void 0===m.boLook&&(ge.cameraTarget2.boLook=!1),(c=c||{}).target||(c.target=new y.Vector3),h.orbitControls&&c.target.copy(h.orbitControls.target),h.playerOptions.cameraTarget.changeTarget(t,o)):(g.cameraTarget&&(g.cameraTarget.camera.userData.cameraTargetPoint=i.cameraTarget),h.orbitControls&&h.orbitControls.reset(),c&&!getCameraTarget()&&(ge.orbitControls&&ge.orbitControls.target.copy(c.target),g.cameraTarget.camera.lookAt(c.target),i.cameraTarget=void 0))}}),U.controllerNameAndTitle(I,X.cameraTarget,X.cameraTargetTitle))}function u(e){return e.boSetValue||fe(e)&&(e.getValue()!==e.initialValue&&void 0===e.boSetValue&&(e.boSetValue=!0,H(e,e.initialValue),e.boSetValue=void 0,e.initialValue=e.getValue()),1)}function n(o){var e,t,i;function n(e){var t=E.object.geometry.attributes,n=E.index;t.position.itemSize<4?console.error("guiSelectPoint.addPointControllers().axesGui().controller.onChange(): attributes.position.itemSize = "+t.position.itemSize):(h.palette&&ge.setColorAttribute(t,n,h.palette.toColor(e,i.__min,i.__max)),t.position.setW(n,e),h.frustumPoints&&h.frustumPoints.updateCloudPointItem(E.object,E.index))}return"w"===o?(h.scales.setW(),void 0!==(e=h.scales.w).min&&void 0!==e.max?(i=x.add({value:e.min},"value",e.min,e.max,(e.max-e.min)/100).onChange(function(e){u(i)||n(e)}),h.palette instanceof vn.palette&&(i.domElement.querySelector(".slider-fg").style.height="40%",t=i.domElement.querySelector(".slider"),vn.create(t,{palette:h.palette,style:{width:"65%"}}))):i=x.add({value:0},"value").onChange(function(e){n(e)})):(e=void 0===h.axesHelper||!1===h.axesHelper?h.scales[o]:h.axesHelper.options?h.axesHelper.options.scales[o]:void 0).isAxis()&&(i=x.add({value:e.min},"value",e.min,e.max,(e.max-e.min)/100).onChange(function(e){var t,n=E.object;u(i)||(t="x"===o?0:"y"===o?1:"z"===o?2:"w"===o?3:console.error("axisName:"+o),n.geometry.attributes.position.array[t+E.index*n.geometry.attributes.position.itemSize]=e,n.geometry.attributes.position.needsUpdate=!0,B(E.index),h.frustumPoints&&h.frustumPoints.updateCloudPointItem(n,E.index))})),i&&U.controllerNameAndTitle(i,e.name),i}function i(e){var t,e=void 0===h.axesHelper||!1===h.axesHelper?h.scales[e]:h.axesHelper.options?h.axesHelper.options.scales[e]:void 0;if(e.isAxis())return t=U.controllerZeroStep(Q,{value:e.min},"value"),Z(t,!0),U.controllerNameAndTitle(t,e.name),t}for(x=w.addFolder(X.point),U.folderNameAndTitle(x,X.point,X.pointTitle),Q=w.addFolder(X.pointWorld),U.folderNameAndTitle(Q,X.pointWorld,X.pointWorldTitle),Q.open(),ne("none"),g.pointsControls&&g.pointsControls(w,j,G),F=w.add({trace:!1},"trace").onChange(function(e){var t=G();t.userData.traceAll=e;for(var n=0;n<t.geometry.attributes.position.count;n++)se({object:t,index:n},e,G);M.setValue(e)}),U.controllerNameAndTitle(F,X.trace,X.traceAllTitle),j(F,h.player),U.controllerNameAndTitle(_.add({defaultF:function(e){for(var t=0;t<S.__select.options.length;t++){var n=S.__select.options[t].mesh;n&&(n.scale.copy(n.userData.default.scale),n.position.copy(n.userData.default.position),n.rotation.copy(n.userData.default.rotation),n.needsUpdate=!0)}ie(),re(),ae(),B(),h.frustumPoints&&h.frustumPoints.onChangeControls()}},"defaultF"),X.defaultButton,X.default3DObjectTitle),k=n("x"),z=n("y"),L=n("z"),N=n("w"),D=x.addColor({color:"#FFFFFF"},"color").onChange(function(e){var t;u(D)||void 0!==D.userData&&(t=D.userData.intersection,ge.setColorAttribute(t.object.geometry.attributes,t.index,e))}),U.controllerNameAndTitle(D,h.scales.w?h.scales.w.name:X.color),V=x.add({opasity:1},"opasity",0,1,.01).onChange(function(e){var t,n;u(V)||((t=G()).userData.myObject?t.userData.myObject.verticeOpacity(E.index,!0,e):t.material.transparent?t.material.vertexColors?(n=t.geometry.attributes.color).itemSize<4||(n.array[3+E.index*n.itemSize]=e,n.needsUpdate=!0):console.error("GuiSelectPoint: cOpacity.onChange. Invalid mesh.material.vertexColors = "+t.material.vertexColors):console.error("GuiSelectPoint: cOpacity.onChange. Invalid mesh.material.transparent = "+t.material.transparent))}),U.controllerNameAndTitle(V,X.opacity,X.opacityTitle),M=x.add({trace:!1},"trace").onChange(function(e){se(E,e,G)}),U.controllerNameAndTitle(M,X.trace,X.traceTitle),j(M,h.player),g.pointControls&&g.pointControls(x,j,G,E),Y.x=i("x"),Y.y=i("y"),Y.z=i("z"),K=x.add({defaultF:function(){const e=E.object.userData.player.arrayFuncs[E.index],n=h.time,t=(e,t)=>{e&&e.setValue("function"==typeof t?t(n,h.a,h.b):"string"==typeof t?ge.execFunc({w:t},"w",h.time,h):t)};if(t(k,e.x),t(z,e.y),t(L,void 0===e.z?0:e.z),oe(V)&&V.setValue(V.initialValue),oe(D)&&!fe(D)&&D.setValue(D.initialValue),void 0!==e.w){if(void 0!==e.w.r)D.setValue("#"+new y.Color(e.w.r,e.w.g,e.w.b).getHexString());else{if("function"==typeof e.w)return void H(N,e.w(n));if(e.w.func)return void H(N,e.w.func(n))}parseFloat(e.w)===e.w?oe(N)&&H(N,e.w):"string"==typeof e.w?H(N,ge.execFunc(e,"w",h.time,h)):console.error("Restore default local position: Invalid W axis.")}else D.setValue(D.initialValue)}},"defaultF"),U.controllerNameAndTitle(K,X.defaultButton,X.defaultLocalPositionTitle),$=new Qn(x,function(e,t,n){for(var o,i=G(),r=O.__select.options.selectedIndex-1,r=i.userData.player.arrayFuncs[r],a=(r[t]=e,i.parent),s=0;a;){if(a.userData.t){s=a.userData.t;break}a=a.parent}switch(t){case"x":o=k;break;case"y":o=z;break;case"z":o=L;break;case"w":if(e instanceof y.Color)return void D.setValue("#"+e.getHexString());o=N;break;default:return void console.error("GuiSelectPoint new functionsFolder onFinishChange: axisName = "+t)}H(o,ge.execFunc(r,t,s,h)),r.controllers&&(i=r.controllers[t])&&i.func&&i.func.controller&&(i.func.controller.value=n)},h,{x:"",y:"",z:"",w:""});0<J.length;)this.addMesh(J[J.length-1]),J.pop();function d(e,t){r.scale[e]=t,r.needsUpdate=!0,B(),h.frustumPoints&&h.frustumPoints.updateCloudPoint(r)}function p(t){var e,n,o=h.scales[t];o.isAxis()&&(o=o.name,e=f.addFolder(o),v.position=v.position||{},(v.position[o]=e).add(new Ze(function(e){r.position[t]+=e,r.needsUpdate=!0,re(),B(),h.frustumPoints&&h.frustumPoints.updateCloudPoint(r)},{getLanguageCode:de})),n=new y.Vector3,q[t]=U.controllerZeroStep(e,n,t,function(e){r.position[t]=e,r.needsUpdate=!0,B()}),U.controllerNameAndTitle(q[t],o))}}},this.removePoints=function(){O.domElement.querySelectorAll("select option").forEach(e=>e.remove());var e=document.createElement("option");e.innerHTML=X.notSelected,e.setAttribute("value",-1),O.__select.appendChild(e)},this.updatePoints=function(){var e=h.dat.guiSelectPoint.boDisplayVerticeID,t=G();e&&(h.dat.guiSelectPoint.boDisplayVerticeID=!1,le(t)),O.__onChange(-1),this.removePoints(),t.userData.player.arrayFuncs.length=0,delete t.userData.player.arrayFuncs,ue(t),ce(t),e&&(h.dat.guiSelectPoint.boDisplayVerticeID=!0,le(t)),t.userData.nd&&t.userData.nd.update()},this.getFrustumPoints=function(){return b},this;function ne(e){var t;Q.domElement.style.display=e,x.domElement.style.display=e,I&&(t=G(),I.domElement.parentElement.parentElement.style.display=t&&t.userData.boFrustumPoints?"none":e)}function n(e){for(var t=e.domElement;"LI"!==t.tagName.toUpperCase();)t=t.parentElement;return t}function j(e,t){void 0!==e&&("boolean"==typeof t?t=t?"block":"none":void 0===t?t="none":"string"!=typeof t&&(t="block"),n(e).style.display=t)}function oe(e){return void 0!==e&&n(e).style.display!==$n}function B(e){var t,n,o,i;-1!==(e=void 0===e?r.getSelectedPointIndex():e)&&(n=ln(t=S.__select.options[S.__select.options.selectedIndex].mesh,e),void 0!==h.axesHelper&&!1!==h.axesHelper&&void 0!==h.axesHelper&&h.axesHelper.exposePosition({object:t,index:e}),Y.x&&Y.x.setValue(n.x),Y.y&&Y.y.setValue(n.y),Y.z&&Y.z.setValue(n.z),t.userData.player)&&t.userData.player.arrayFuncs&&(o=t.userData.player.arrayFuncs[e])&&o.controllers&&((i=t.userData.player.arrayFuncs[e].controllers).x&&i.x.controller&&(i.x.controller.value=n.x),i.y&&i.y.controller&&(i.y.controller.value=n.y),i.z)&&i.z.controller&&(i.z.controller.value=n.z)}function H(e,t){var n,o;e&&(o=(n=a(e)).readOnly,n.readOnly=!1,e.object[e.property]=t,e.__onChange&&e.__onChange.call(e,t),e.initialValue=t,e.updateDisplay(),n.readOnly=o)}function o(t){var e,n,o=t.object.userData.player,i="none",i=(o&&o.arrayFuncs&&($.setFunction(o.arrayFuncs[t.index]),i="block"),$.displayFolder(i),I&&(h.playerOptions.cameraTarget.changeTarget(t.object,t.index),I.updateDisplay()),an(t.object,t.index)),i=(H(k,i.x),H(z,i.y),H(L,i.z),t.object.userData.gui&&t.object.userData.gui.setValues(t.index),ln(t.object,t.index));H(Y.x,i.x),H(Y.y,i.y),H(Y.z,i.z),E.object.userData.player&&E.object.userData.player.arrayFuncs;const r=o&&o.arrayFuncs?o.arrayFuncs[t.index]:void 0,a=t.object.geometry.attributes;if(a.color){i=e=>{e="#"+e.getHexString();D.initialValue=e,D.userData={intersection:t},D.setValue(e)};if(a.position.itemSize<4)!0!==t.object.material.vertexColors&&t.object.material instanceof y.ShaderMaterial!=!0||(e=$n,n=eo,i((new y.Color).fromBufferAttribute(a.color,t.index)));else{function s(){return"object"==typeof r.w&&r.w instanceof y.Color==!1}const l=G(),p=l.userData.myObject?l.userData.myObject.verticeColor(t.index):void 0;o=void 0===r||!a.color&&!a.ca?void 0:Array.isArray(r.w)||"function"==typeof r.w?ge.execFunc(r,"w",h.time,h):s()?ge.execFunc(r.w,"func",h.time,h):"string"==typeof r.w?ge.execFunc(r,"w",h.time,h):null!=p?p:r.w;(o=Array.isArray(o)?new y.Color(o[0],o[1],o[2]):o)instanceof y.Color?(e=$n,n=eo,void 0===t.object.userData.player.arrayFuncs?n=$n:(i(o),V.userData={intersection:t})):(e=void 0===N||void 0===o?$n:(f=f||{min:N.__min,max:N.__max},s()?(N.min(("undefined"!==r.w.min?r.w:f).min),N.max(("undefined"!==r.w.max?r.w:f).max),"undefined"!==N.__min&&"undefined"!==N.__max&&N.step((N.__max-N.__min)/100)):(N.min(f.min),N.max(f.max)),H(N,o),eo),n=$n)}}else n=e=$n;j(N,e),j(D,n);const l=G(),c=!0===t.object.userData.boFrustumPoints||!(!l.userData.gui||!l.userData.gui.isLocalPositionReadOnly),u=l.userData.myObject&&l.userData.myObject.isOpacity||l.material.transparent&&l.material.vertexColors,d=l.geometry.attributes.color;j(V,u?eo:$n),u&&(4!=d.itemSize&&console.error("GuiSelectPoint.setPosition: Invalid mesh.geometry.attributes.color.itemSize = "+d.itemSize),V.initialValue=d.array[t.index*d.itemSize+3],V.setValue(V.initialValue)),pe.setReadOnlyPosition(c),Z(D,c),Z(V,c),$.displayFolder(!c)}function G(){if(S)return-1!==S.__select.options.selectedIndex?S.__select.options[S.__select.options.selectedIndex].mesh:void 0;console.error("GuiSelectPoint().getSelectedPointIndex().getMesh(): call GuiSelectPoint.add(); first.")}function i(){return void 0===G()}function ie(){var e;i()||(e=G(),C&&C.setValue(e.scale.x),A&&A.setValue(e.scale.y),P&&P.setValue(e.scale.z))}function re(){var e;i()||(e=G(),q.x&&q.x.setValue(e.position.x),q.y&&q.y.setValue(e.position.y),q.z&&q.z.setValue(e.position.z))}function ae(){var e,t;i()||(e=G(),t=(e,t)=>{(t<e.__min||t>e.__max)&&console.error("GuiSelectPoint.setRotationControllers(): Invalid angle = "+t+" range. Available range from "+e.__min+" to "+e.__max),e.setValue(t)},W.x&&t(W.x,e.rotation.x),W.y&&t(W.y,e.rotation.y),W.z&&t(W.z,e.rotation.z))}function se(e,t,n){var o,i,r;e&&e.object.userData.player&&void 0!==e.object.userData.player.arrayFuncs&&(o=e.index||0,void 0!==(r=void 0===(i=e.object.userData.player.arrayFuncs[o])?void 0:i.line)&&r.visible(t),t)&&void 0===i.line&&(i.line=new ge.traceLine(h),r=void 0===(r=e.object.geometry.attributes.color)?new y.Color(16777215):(t=(new y.Vector3).fromArray(r.array,o*r.itemSize),new y.Color(t.x,t.y,t.z)),i.line.addPoint(n(),o,r))}function le(t){if(!t.userData.boFrustumPoints)if(h.dat.guiSelectPoint.boDisplayVerticeID){if(t.geometry){var n=t.geometry.attributes.position;t.updateMatrixWorld();for(let e=0;e<n.count;e++){var o=(new y.Vector3).fromBufferAttribute(n,e);new he(e,o,{group:t}).userData.pointID=e}}}else for(var e=t.children.length-1;0<=e;e--){var i=t.children[e];"Sprite"===i.type&&t.remove(i)}}function ce(e){for(var t=0;t<e.geometry.attributes.position.count;t++){var n=document.createElement("option"),o=e.userData.player&&e.userData.player.arrayFuncs?e.userData.player.arrayFuncs[t].name:"";n.innerHTML=t+(void 0===o?"":" "+o),n.setAttribute("value",t),O.__select.appendChild(n)}}function ue(e){if(e&&!e.userData.boFrustumPoints&&(e.userData.player||(e.userData.player={}),!e.userData.player.arrayFuncs)&&e.geometry){var t=e.geometry.attributes.position;e.userData.player.arrayFuncs=[];for(var n=0;n<t.count;n++){var o=(new y.Vector4).fromArray(e.geometry.attributes.position.array,n*t.itemSize);e.userData.player.arrayFuncs.push(o)}}}}else this.add=function(e){},this.addMesh=function(e){},this.select=function(e){};else console.error("GuiSelectPoint: call options = new Options( options ) first")}}
/**
 * @module MoveGroupGui
 *
 * @description Add MoveGroup folder into {@link https://github.com/anhr/dat.gui|dat.gui} for changing group's position, scale and rotation.
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
*/class no{constructor(o,a,s={}){if(a.boOptions){var e=s.folder||a.dat.gui;if(e&&!1!==a.dat.moveScene){a.axesHelper&&a.axesHelper.options?a.scales=a.axesHelper.options.scales:a.scales=a.scales||{x:{},y:{},z:{}};const r=a.dat.cookie,d=me.dat,p="MoveGroup"+(a.cookieName?"_"+a.cookieName:""),f={scale:o.scale,position:o.position,rotation:o.rotation,x:{zoomMultiplier:1.2,offset:.1},y:{zoomMultiplier:1.2,offset:.1},z:{zoomMultiplier:1.2,offset:.1}},m=JSON.parse(JSON.stringify(f));Object.freeze(m),r.getObject(p,f,m),o.scale.copy(f.scale),o.position.copy(f.position),f.scale=o.scale,f.position=o.position,t("x"),t("y"),t("z");var l={moveGroup:"Move Group",scale:"Scale",position:"Position",rotation:"Rotation",defaultButton:"Default",defaultTitle:"Move group to default position."};"ru"===a.getLanguageCode()?(l.moveGroup="Переместить группу",l.scale="Масштаб",l.position="Позиция",l.rotation="Вращение",l.defaultButton="Восстановить",l.defaultTitle="Переместить группу в исходное состояние."):void 0!==a.lang&&a.lang.languageCode==languageCode&&Object.keys(a.lang).forEach(function(e){void 0!==l[e]&&(l[e]=a.lang[e])}),s.lang&&(l.moveGroup=s.lang.moveGroup||l.moveGroup);let n=e.addFolder(l.moveGroup);function t(t){a.scales[t]&&(a.moveGroupGui=a.moveGroupGui||{scales:{}},a.moveGroupGui.scales[t]=a.moveGroupGui.scales[t]||{},a.moveGroupGui.scales[t].default=function(){var e=a.scalesControllers[t];e.scale.setValue(m.scale[t]),e.scaleController.setValue(m[t].zoomMultiplier),e.position.setValue(m.position[t]),e.positionController.setValue(m[t].offset),e.rotation.setValue(m.rotation["_"+t])})}function c(e,t,n){e=a.scalesControllers[e].scale;e&&(e.setValue(t(e.getValue(),n)),u())}function u(){a.axesHelper&&a.axesHelper.updateAxes(),a.guiSelectPoint&&a.guiSelectPoint.update(),r.setObject(p,f)}function i(e,t,i){var r;e.isAxis()&&(t.folder=n.addFolder(e.name),t.scaleController=t.folder.add(new Ye(function(e,t){e=e.controller.getValue(),c(i,t,e)},{settings:f[i],getLanguageCode:s.getLanguageCode})).onChange(function(e){f[i].zoomMultiplier=e,u()}),t.scale=d.controllerZeroStep(t.folder,o.scale,i,function(e){u()}),d.controllerNameAndTitle(t.scale,l.scale),r=new Ze(function(n){var e,t,o;t=function(e,t){return e+=n},e=(e=r).controller.getValue(),o=i,t=t,e=e,(o=a.scalesControllers[o].position)&&(o.setValue(t(o.getValue(),e)),u())},{settings:{},getLanguageCode:s.getLanguageCode}),t.positionController=t.folder.add(r).onChange(function(e){f[i].offset=e,u()}),t.position=d.controllerZeroStep(t.folder,o.position,i,function(e){u()}),d.controllerNameAndTitle(t.position,l.position),t.rotation=t.folder.add(o.rotation,i,0,2*Math.PI,1/360).onChange(function(e){u()}),d.controllerNameAndTitle(t.rotation,l.rotation),d.controllerNameAndTitle(t.folder.add({defaultF:function(e){a.moveGroupGui.scales[i].default()}},"defaultF"),l.defaultButton,l.defaultTitle))}n.add(new Ye(function(e,t){e=e.controller.getValue();c("x",t,e),c("y",t,e),c("z",t,e)},{settings:{zoomMultiplier:1.1},getLanguageCode:s.getLanguageCode})),a.scalesControllers={x:{},y:{},z:{},w:{}},a.scales&&(i(a.scales.x,a.scalesControllers.x,"x"),i(a.scales.y,a.scalesControllers.y,"y"),i(a.scales.z,a.scalesControllers.z,"z")),d.controllerNameAndTitle(n.add({defaultF:function(e){a.moveGroupGui.scales.x&&a.moveGroupGui.scales.x.default(),a.moveGroupGui.scales.y&&a.moveGroupGui.scales.y.default(),a.moveGroupGui.scales.z&&a.moveGroupGui.scales.z.default()}},"defaultF"),l.defaultButton,l.defaultTitle)}}else console.error("MoveGroupGui: call options = new Options( options ) first")}}
/**
 * @module CameraGui
 * @description [Camera]{@link https://threejs.org/docs/index.html#api/en/cameras/PerspectiveCamera} graphical user interface.
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */class oo{constructor(o,i,e){if(i.boOptions){if((e=e||i.dat.gui)&&!1!==i.dat.cameraGui){var r,t,n,a,s=me.dat;me.THREE;i.cameraGui=this,i.orbitControls&&i.orbitControls.addEventListener("change",function(){u()});const d={camera:"Camera",position:"Position",positionTitle:"Camera position",distanceToCamera:"Distance",distanceToCameraTitle:"Distance from the camera to the point at which the camera is looking",look:"Look",lookTitle:"Camera is look at a selected point during playing.",defaultButton:"Default",defaultTitle:"Restore default camera settings."},p=("ru"===i.getLanguageCode()?(d.camera="Камера",d.position="Позиция",d.positionTitle="Позиция камеры",d.distanceToCamera="Расстояние",d.distanceToCameraTitle="Расстояние между камерой и точкой, на которую она смотрит.",d.look="Следить",d.lookTitle="Камера следит за выбранной точкой во время проигрывания.",d.defaultButton="Восстановить",d.defaultTitle="Восстановить настройки камеры по умолчанию."):void 0!==i.lang&&i.lang.languageCode==_languageCode&&Object.keys(i.lang).forEach(function(e){void 0!==d[e]&&(d[e]=i.lang[e])}),e.addFolder(d.camera)),f=p.addFolder(d.position),m={x:i.scales.x?s.controllerZeroStep(f,o.position,"x",function(e){o.position.x=e}):void 0,y:i.scales.y?s.controllerZeroStep(f,o.position,"y",function(e){o.position.y=e}):void 0,z:i.scales.z?s.controllerZeroStep(f,o.position,"z",function(e){o.position.z=e}):void 0};if(s.folderNameAndTitle(f,d.position,d.positionTitle),m.x&&s.controllerNameAndTitle(m.x,i.scales.x.name),m.y&&s.controllerNameAndTitle(m.y,i.scales.y.name),m.z&&s.controllerNameAndTitle(m.z,i.scales.z.name),i.player){i.playerOptions.cameraTarget.init({camera:o},i);const y=i.playerOptions.cameraTarget.get();a=p.add(y,"boLook").onChange(function(e){i.player&&(y.boMaual=!0,i.player.selectScene(),y.boMaual=!1),e||i.orbitControls&&i.orbitControls.reset()}),s.controllerNameAndTitle(a,d.look,d.lookTitle);var e=p.addFolder(d.distanceToCamera),l={x:ge.execFunc(y.distanceToCamera,"x",void 0,i),y:ge.execFunc(y.distanceToCamera,"y",void 0,i),z:ge.execFunc(y.distanceToCamera,"z",void 0,i)};function c(e,t){isNaN(t)||(o.userData.cameraTarget&&(o.userData.cameraTarget.distanceToCameraCur[e]=t),y.distanceToCameraCur[e]=t,y.setCameraPosition(),u())}r={x:s.controllerZeroStep(e,l,"x",function(e){c("x",e)}),y:s.controllerZeroStep(e,l,"y",function(e){c("y",e)}),z:s.controllerZeroStep(e,l,"z",function(e){c("z",e)})},t={x:l.x,y:l.y,z:l.z},s.folderNameAndTitle(e,d.distanceToCamera,d.distanceToCameraTitle),i.scales.x&&s.controllerNameAndTitle(r.x,i.scales.x.name),i.scales.y&&s.controllerNameAndTitle(r.y,i.scales.y.name),i.scales.z&&s.controllerNameAndTitle(r.z,i.scales.z.name),n=new Qn(e,function(e,t){var n=i.playerOptions.cameraTarget.get(),e=(n.distanceToCamera[t]=e,ge.execFunc(n.distanceToCamera,t,i.time));r[t].setValue(e,!0),i.playerOptions.cameraTarget.init({camera:o},i)},i,y.distanceToCamera)}const h={x:o.position.x,y:o.position.y,z:o.position.z},g=i.orbitControls?{x:i.orbitControls.target.x,y:i.orbitControls.target.y,z:i.orbitControls.target.z}:{x:0,y:0,z:0};function u(){var e,t=i.playerOptions.cameraTarget.get(i);m.x&&m.x.setValue(o.position.x),m.y&&m.y.setValue(o.position.y),m.z&&m.z.setValue(o.position.z),r&&(e=t.getDistanceToCamera(),r.x&&r.x.setValue(e.x),r.y&&r.y.setValue(e.y),r.z)&&r.z.setValue(e.z),n&&n.setFunction(t.distanceToCamera)}s.controllerNameAndTitle(p.add({defaultF:function(e){m.x.setValue(h.x),m.y.setValue(h.y),m.z.setValue(h.z),o.position.copy(h),o.lookAt(g),i.orbitControls&&(i.orbitControls.target.copy(g),i.orbitControls.update()),r&&(r.x.setValue(t.x),r.y.setValue(t.y),r.z.setValue(t.z))}},"defaultF"),d.defaultButton,d.defaultTitle),this.update=function(){u()},this.look=function(e=!0){a&&(a.object[a.property]=e,a.updateDisplay())}}}else console.error("CameraGui: call options = new Options( options ) first")}}
/**
 * FolderPoint
 *
 * GUI for changing point settings.
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
*/class io{constructor(t,n,e,o={}){var i=me.dat;if(e.boOptions){var r=o.folder||e.dat.gui;if(r&&!1!==e.dat.folderPoint){e.dat.folderPoint=this;var a={pointSettings:"Point",size:"Size",sizeTitle:'Size of the point with "ShaderMaterial" material',defaultButton:"Default",defaultPointTitle:"Restore point."};"ru"===e.getLanguageCode()&&(a.pointSettings="Точка",a.size="Размер",a.sizeTitle='Размер точки с материалом типа "ShaderMaterial"',a.defaultButton="Восстановить",a.defaultPointTitle="Восстановить точку");const c=o.defaultPoint||{};void 0===c.size&&(c.size=t.size);var s=o.PCOptions||{},l=(void 0===s.min&&(s.min=.01),void 0===s.max&&(s.max=1),s.settings=s.settings||{},void 0===s.settings.offset&&(s.settings.offset=1),void 0===s.step&&(s.step=.01),s.getLanguageCode=s.getLanguageCode||o.getLanguageCode||e.getLanguageCode,r.addFolder(a.pointSettings)),o=l.addFolder(a.size);i.folderNameAndTitle(o,a.size,a.sizeTitle),this.display=function(e){l.domElement.style.display=e},o.add(new Ze(function(e){n(t.size+e)},s)),this.size=i.controllerZeroStep(o,t,"size",function(e){n(e)}),i.controllerNameAndTitle(this.size,a.size,a.sizeTitle),i.controllerNameAndTitle(l.add({defaultF:function(e){n(c.size)}},"defaultF"),a.defaultButton,a.defaultPointTitle)}}else console.error("FolderPoint: call options = new Options( options ) first")}}
/**
 * frustumPoints
 *
 * Array of points, statically fixed in front of the camera.
 * I use frustumPoints for displaying of the clouds around points.
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
*/var ro={notHiddingFrustumPoints:!0};class ao{constructor(F,D,e,a={}){const V=me.THREE,I=(a.options=a.options||new A,a.options);if(I.boOptions){if(I.frustumPoints){this.gl=e.getContext("webgl"),this.getOptions=function(){return I};const H=I.frustumPoints,s=(I.frustumPoints=this,[]);var R,j,B;s.getCloudsCount=function(){for(var e=0,t=0;t<s.length;t++)e+=s[t].length;return e},this.pushArrayCloud=function(e){var t;if(4===(e=e.geometry?(t=e).geometry:e).attributes.position.itemSize){var n=s.getCloudsCount(),o=[];s.push(o);for(var i=0;i<e.attributes.position.count;i++){var r=(new V.Vector4).fromArray(e.attributes.position.array,i*e.attributes.position.itemSize);o.push(r)}return t&&(t.userData.cloud={indexArray:n}),n}console.error("FrustumPoints.pushArrayCloud: Invalid geometry.attributes.position.itemSize = "+e.attributes.position.itemSize)},this.create=function(t){if(0!==s.length){const N={},i=new V.Vector3,r=F.position.distanceTo(i),M=this,e=new V.Group,v=(a.optionsShaderMaterial=a.optionsShaderMaterial||{},H.point=H.point||{},H.point.size=H.point.size||.01,H.display=void 0===H.display||H.display,H.info=void 0!==H.info&&H.info,H.stereo=H.stereo||{},H.stereo.hide=H.stereo.hide||0,H.stereo.opacity=H.stereo.opacity||.3,H.zCount=H.zCount||50,H.yCount=H.yCount||30,H.near=H.near||0,H.far=H.far||0,H.base=H.base||100,H.square=void 0!==H.square&&H.square,I.dat.cookie),b=I.dat?I.dat.getCookieName("FrustumPoints"):"FrustumPoints";Object.freeze(H),v&&v.getObject(b,N,H),N.stereo&&(N.stereo.hide=H.stereo.hide,N.stereo.opacity=H.stereo.opacity);var k,z=new(z=function(){var c,l;this.create=function(e){c=e,I.scales.w||I.scales.setW();var e=I.scales.w.max,t=I.scales.w.min;c.paletteA={value:1/(e-t)},c.paletteB={value:-t/(e-t)},this.cloudPoints=new this.addUniforms(V.RGBAFormat,s.getCloudsCount(),"cloudPoints"),l=256;new this.addUniforms(V.LuminanceFormat,l,"distanceTable",{height:2,onReady:function(e,t,n){for(var o,i=0,r=.5/(l-1),a=0;a<l;a++){s=i;var s=Math.exp(-.5*s*s/(.1*.1));i+=r,void 0!==o&&(.035<Math.abs(o-s)?r/=1.001:r*=1.001),n(a,o=s),n(a+l,i)}}})},this.addUniforms=function(e,t,n,o){o=o||{};const a=e===V.RGBAFormat?4:e===V.RGBFormat?3:e===V.LuminanceFormat?1:NaN,i=o.height||1,r=t*i,s=V.FloatType,l=new(s===V.FloatType?Float32Array:Uint8Array)(a*r);return void 0!==this.addUniforms&&console.error('Please use "new this.addUniforms(...)"'),this.updateItem=function(e,t){"number"==typeof t?n=t:r=void 0===t.x?(n=t.r,o=t.g,i=t.b,1):(n=t.x,o=t.y,i=t.z,isNaN(t.w)&&console.error("frustumPoints.create.cloud.addUniforms.updateItem: vector.w = "+t.w+". Probably you use THREE.Color for w coordinate of the point with cloud."),t.w);var n,o,i,r,t=void 0===o?1:void 0===i?2:void 0===r?3:4,e=e*a;t!==a&&console.error("frustumPoints.create.cloud.addUniforms.updateItem: vectorSize = "+t+" !== itemSize = "+a),l[e]=n,1<a&&(l[1+e]=o,2<a)&&(l[2+e]=i,3<a)&&(l[3+e]=r)},void 0!==o.onReady&&o.onReady(l,a,this.updateItem),c[n]={value:new V.DataTexture(l,t,i,e,s)},c[n].value.needsUpdate=!0,a},this.editShaderText=function(e){for(var t=0,n=0;n<s.length;n++)t+=s[n].length;e.vertex=e.vertex.replace("%scloudPointsWidth",t+"."),e.vertex=e.vertex.replace("%distanceTableWidth",l+".")},this.updateMesh=function(e){if(void 0!==e.userData.cloud&&this.cloudPoints)for(var t=0;t<e.geometry.attributes.position.count;t++){var n=(new V.Vector4).fromArray(e.geometry.attributes.position.array,t*e.geometry.attributes.position.itemSize);this.cloudPoints.updateItem(e.userData.cloud.indexArray+t,sn(e,n))}}});return D.add(e),this.onChangeControls=function(){ro.notHiddingFrustumPoints?ro.notMoveFrustumPoints||M.update():(void 0===timeoutControls&&(D.remove(B),D.remove(e),I.raycaster.removeParticle(B)),clearTimeout(timeoutControls),timeoutControls=setTimeout(function(){D.add(e),N.info&&I.raycaster.addParticle(B),clearTimeout(timeoutControls),timeoutControls=void 0,ro.notMoveFrustumPoints||M.update()},500))},n(),this.update=function(e){n(e),B&&(B.position.copy(F.position),B.rotation.set(F.rotation.x,F.rotation.y,F.rotation.z),e=F.position.distanceTo(i)/r,B.scale.x=e,B.scale.y=e,B.scale.z=e),I.guiSelectPoint&&I.guiSelectPoint.setMesh();e=new V.Vector4(F.quaternion.x,F.quaternion.y,F.quaternion.z,F.quaternion.w);B&&(B.material.uniforms.cameraPositionDefault.value.copy(F.position),e.x=-e.x,e.y=-e.y,e.z=-e.z,B.material.uniforms.cameraPositionDefault.value.applyQuaternion(e))},this.isDisplay=function(){return N.display},this.updateCloudPoints=function(){D.children.forEach(function(e){e.userData.cloud&&(4!==e.geometry.attributes.position.itemSize?console.error("mesh.geometry.attributes.position.itemSize = "+e.geometry.attributes.position.itemSize):z.updateMesh(e))}),o()},this.updateCloudPoint=function(e){z.updateMesh(e),o()},this.updateCloudPointItem=function(e,t){void 0!==e.userData.cloud&&(4!==e.geometry.attributes.position.itemSize&&console.error("points.geometry.attributes.position.itemSize = "+e.geometry.attributes.position.itemSize),z.cloudPoints.updateItem(e.userData.cloud.indexArray+t,sn(e,(new V.Vector4).fromArray(e.geometry.attributes.position.array,t*e.geometry.attributes.position.itemSize)),!0),o())},this.animate=function(){return!(!B||void 0===B.userData.shaderMaterial||k===B.userData.shaderMaterial.point.opacity||(k=B.userData.shaderMaterial.point.opacity,B.material.uniforms.opacity.value=B.userData.shaderMaterial.point.opacity,0))},this.updateGuiSelectPoint=function(){var e=I.guiSelectPoint?I.guiSelectPoint.getMeshIndex(B):void 0;n(),e&&I.guiSelectPoint.setIndexMesh(e,B)},this.gui=function(e){var t=me.dat;if(!(e=e||I.dat.gui)||!1===I.dat.guiFrustumPoints)return;const n={frustumPoints:"Frustum Points",frustumPointsTitle:"A cloud of the fixed points in front of the camera for describe the properties of space.",display:"Display",displayTitle:"Display or hide Frustum Points.",info:"Information",infoTitle:"Display information about frustum point if user move mouse over or click this point.",stereo:"Stereo",stereoTitle:"Frustum Points setting for stereo mode of the canvas",hide:"Hide Nearby Points",hideTitle:"Hide the nearby to the camera points in percentage to all points for more comfortable visualisation.",opacity:"Opacity",opacityTitle:"Float in the range of 0.0 - 1.0 indicating how transparent the lines is. A value of 0.0 indicates fully transparent, 1.0 is fully opaque.",near:"Near Layer",nearTitle:"Shift of the frustum layer near to the camera in percents.",far:"Far Layer",farTitle:"Shift of the frustum layer far to the camera in percents.",base:"Scale",baseTitle:"Scale of the base of the frustum points in percents.",square:"Square Base",squareTitle:"Square base of the frustum points.",defaultButton:"Default",defaultTitle:"Restore default Frustum Points settings.",zCount:"Z Count",zCountTitle:"The count of layers of the frustum of the camera's field of view.",yCount:"Y Count",yCountTitle:"The count of vertical points for each z level of the  frustum of the camera's field of view."};function o(){v.setObject(b,N)}"ru"===I.getLanguageCode()?(n.frustumPoints="Неподвижные точки",n.frustumPointsTitle="Облако точек перед камерой для описания свойств пространства",n.display="Показать",n.displayTitle="Показать или скрыть неподвижные точки.",n.info="Информация",n.infoTitle="Отображать информацию о неподвижной точке, если пользователь наведет курсор мыши или щелкнет эту точку.",n.stereo="Стерео",n.stereoTitle="Настройки неподвижных точек для стерео режима холста",n.hide="Близкие точки",n.hideTitle="Скрыть близкие к камере точки в процентах ко всем точкам для более удобной визуализации.",n.opacity="Непрозрачность",n.opacityTitle="Число в диапазоне 0.0 - 1.0, указывающее, насколько прозрачены линии. Значение 0.0 означает полностью прозрачный, 1.0 - полностью непрозрачный.",n.near="Ближний слой",n.nearTitle="Смещение ближайшего к камере слоя точек в процентах.",n.far="Дальний слой",n.farTitle="Смещение дальнего от камеры слоя точек в процентах.",n.base="Масштаб",n.baseTitle="Масштаб неподвижных точек в процентах.",n.square="Квадратное основание",n.squareTitle="Неподвиждые точки образуют пирамиду с квадратным основанием.",n.defaultButton="Восстановить",n.defaultTitle="Восстановить настройки неподвижных точек.",n.zCount="Z cлои",n.zCountTitle="Количество слоев усеченной пирамиды, образующей поле зрения камеры",n.yCount="Y точки",n.yCountTitle="Количество вертикальных точек в каждом слое усеченной пирамиды, образующей поле зрения камеры."):void 0!==I.lang&&I.lang.languageCode==languageCode&&Object.keys(I.lang).forEach(function(e){void 0!==n[e]&&(n[e]=I.lang[e])});e=e.addFolder(n.frustumPoints);function i(e){e=e?"block":"none";d.display(e),g.__li.style.display=e,y.__li.style.display=e}t.folderNameAndTitle(e,n.frustumPoints,n.frustumPointsTitle);const r=e.add(N,"display").onChange(function(e){(N.display?h:(I.raycaster&&I.raycaster.removeParticle(B),L))(),i(N.display),o()}),a=(t.controllerNameAndTitle(r,n.display,n.displayTitle),I.raycaster?e.add(N,"info").onChange(function(e){void 0===B||(N.info?I.raycaster&&I.raycaster.addParticle(B):(I.guiSelectPoint&&I.guiSelectPoint.selectPoint(-1),I.raycaster&&I.raycaster.removeParticle(B))),o()}):void 0),s=(a&&t.controllerNameAndTitle(a,n.info,n.infoTitle),e.add(N,"near",0,100,1).onChange(function(e){h()})),l=(t.controllerNameAndTitle(s,n.near,n.nearTitle),e.add(N,"far",0,100,1).onChange(function(e){h()})),c=(t.controllerNameAndTitle(l,n.far,n.farTitle),e.add(N,"base",0,100,1).onChange(function(e){h()})),u=(t.controllerNameAndTitle(c,n.base,n.baseTitle),e.add(N,"square").onChange(function(e){h()})),d=(t.controllerNameAndTitle(u,n.square,n.squareTitle),new io(N.point,function(e){void 0===e&&console.warn("under constraction"),B.material.uniforms.pointSize.value=e=e<0?0:e,d.size.setValue(e),N.point.size=e,o()},new A({dat:{gui:I.dat.gui}}),{folder:e,defaultPoint:{size:.01},PCOptions:{settings:{offset:.1},max:.1}}));var p=!0,f=!0,m=this;function h(){if(p&&f){f=!1;const e=I.guiSelectPoint?I.guiSelectPoint.getMeshIndex(B):void 0;I.raycaster&&I.raycaster.removeParticle(B),L(!0),m.update(function(){I.guiSelectPoint&&I.guiSelectPoint.setIndexMesh(e,B),o(),f=!0,B.userData.controllers()})}}const g=e.add(N,"zCount").min(3).step(1).onChange(function(e){h()}),y=(t.controllerNameAndTitle(g,n.zCount,n.zCountTitle),e.add(N,"yCount").min(3).step(1).onChange(function(e){h()}));t.controllerNameAndTitle(y,n.yCount,n.yCountTitle),t.controllerNameAndTitle(e.add({defaultF:function(e){p=!1,r.setValue(H.display),a&&a.setValue(H.info),s.setValue(H.near),l.setValue(H.far),c.setValue(H.base),u.setValue(H.square),d.size.setValue(H.point.size),g.setValue(H.zCount),y.setValue(H.yCount),p=!0,h(),o()}},"defaultF"),n.defaultButton,n.defaultTitle),i(N.display)},this;function n(e){if(void 0===B){var t=e;if(N.display){const g=new V.CameraHelper(F);var c,u=0;const y=m("n1"),v=m("n2"),b=m("n3"),_=m("f1"),x=m("f2"),w=m("f3");y.x=y.x*N.base/100,v.x=v.x*N.base/100,b.x=b.x*N.base/100,y.y=y.y*N.base/100,v.y=v.y*N.base/100,b.y=b.y*N.base/100,_.x=_.x*N.base/100,x.x=x.x*N.base/100,w.x=w.x*N.base/100,_.y=_.y*N.base/100,x.y=x.y*N.base/100,w.y=w.y*N.base/100,N.square&&(y.x/=F.aspect,v.x/=F.aspect,b.x/=F.aspect,_.x/=F.aspect,x.x/=F.aspect,w.x/=F.aspect);var e=y.x,n=v.x,o=b.x,i=y.y,r=v.y,a=b.y,s=y.z;y.x=y.x+(_.x-y.x)*N.near/100,v.x=v.x+(x.x-v.x)*N.near/100,b.x=b.x+(w.x-b.x)*N.near/100,y.y=y.y+(_.y-y.y)*N.near/100,v.y=v.y+(x.y-v.y)*N.near/100,b.y=b.y+(w.y-b.y)*N.near/100,y.z=v.z=b.z=y.z+(_.z-y.z)*N.near/100,_.x=_.x+(e-_.x)*N.far/100,x.x=x.x+(n-x.x)*N.far/100,w.x=w.x+(o-w.x)*N.far/100,_.y=_.y+(i-_.y)*N.far/100,x.y=x.y+(r-x.y)*N.far/100,w.y=w.y+(a-w.y)*N.far/100,_.z=x.z=w.z=_.z+(s-_.z)*N.far/100;const S=(new V.Vector3).copy(y),T=N.zCount,E=(_.z-y.z)/((T-1)*(T-1));var d=0;const C=N.yCount,A=C*(N.square?1:parseInt(F.aspect));var p=0;N.zCount=H.zCount,N.yCount=H.yCount;const P=parseInt(T*N.stereo.hide/100),O=P+T-1;N.zCount=T,N.yCount=C,L(!0),M.pointIndexes=function(e){var t,n,o;if(void 0!==j)return t=j[e],o=e,e=("object"==typeof t?n=0:(n=t,i()),t.y),r(),{x:n,y:e,z:t.z};function i(){for(o--;0<=o&&"object"!=typeof j[o];)o--;t=j[o]}function r(){for(;0<=o&&void 0===t.z;)i()}console.error("_names = "+j)};var e=function(){var e=document.currentScript&&""!==document.currentScript.src?document.currentScript.src:""!==(e=document.getElementsByTagName("script"))[e.length-1].src?src:(new Error).stack.match(/(https?:[^:]*)/)[0];return e.substring(0,e.lastIndexOf("/"))}(),l=new V.Vector3(F.position.x,F.position.y,F.position.z),f=new V.Vector4(F.quaternion.x,F.quaternion.y,F.quaternion.z,F.quaternion.w);function m(e){var e=g.pointMap[e],t=g.geometry.attributes.position;return(new V.Vector3).fromArray(t.array,e[0]*t.itemSize)}function h(e){var t=(b.y-y.y)/(C-1),n=((w.y-_.y)/(C-1)-t)/((T-1)*(T-1))*e*e+t,t=parseInt(Math.sqrt(T)),o=n/(t+parseInt(Math.sqrt(T-t*t))),t=(v.x-y.x)/(A-1),i=((x.x-_.x)/(A-1)-t)/((T-1)*(T-1))*e*e+t,r=i/parseInt(Math.sqrt(T));S.y=-n*(C-1)/2,S.x=-i*(A-1)/2;for(var a,s=0;s<C;s++)for(var l=0;l<A;l++)e>=P&&(a=new V.Vector3(S.x+i*l+r*d,S.y+n*s+o*p,S.z+E*e*e),j.push(0===l?0===s?{y:s,z:e}:{y:s}:l),c[u]=a.x,c[++u]=a.y,c[++u]=a.z,u++);++d>=parseInt(Math.sqrt(T))&&(d=0,p++)}B=!1,new jn(function(){var e=new V.BufferGeometry,t=(O-P+1)*A*C;return c=new Float32Array(3*t),u=0,j=[],function e(t,n){if(n<t)return;h(t);if(n<=t)return;h(n);var o=parseInt((t+n)/2);if(o===t)return;h(o);e(t+1,o-1);e(o+1,n-1)}(P,O),e.setAttribute("position",new V.BufferAttribute(c,3)),e},D,{options:I,pointsOptions:{name:"frustum points",shaderMaterial:N,boFrustumPoints:!0,position:F.position,scale:F.scale,rotation:F.rotation,opacity:!0,pointIndexes:function(e){return M.pointIndexes(e)},path:{vertex:e+"/frustumPoints/vertex.c"},pointName:function(e){var t=M.pointIndexes(e);return void 0===t?t:"x = "+t.x+", y = "+t.y+", z = "+(t.z+P)+", i = "+e},controllers:function(){R&&R.appendChild({xCount:A,yCount:C,zCount:T})},uniforms:function(e){return z.create(e),f.x=-f.x,f.y=-f.y,f.z=-f.z,l.applyQuaternion(f),e.cameraPositionDefault={value:l},e.cameraQuaternion={value:F.quaternion},new z.addUniforms(V.RGBAFormat,256,"palette",{onReady:function(e,t,n){I.scales.setW();for(var o=I.scales.w.min,i=I.scales.w.max,r=e.length/t,a=0;a<r;a++)n(a,I.palette.toColor((i-o)*a/(r-1)+o,o,i))}}),z},onReady:function(e){(B=e).userData.isInfo=function(){return N.info},N.info&&I.raycaster&&I.raycaster.addParticle(B),N.display||L(),k=void 0===B?1:(void 0===B.userData.shaderMaterial?N:B.userData.shaderMaterial).point.opacity,void 0!==t&&t(),M.update(),I.guiSelectPoint&&I.guiSelectPoint.addMesh(B)}}})}}}function o(){B&&(B.material.uniforms.cloudPoints.value.needsUpdate=!0)}function L(e){void 0!==B&&(!e&&I.guiSelectPoint&&I.guiSelectPoint.removeMesh(B),D.remove(B),t.renderLists.dispose(),Xn(B),B=void 0)}}},this.guiSelectPoint=function(){var r=null,a=null,s=null;(R=this).create=function(n,o){const i=me.dat;function e(e){var t={notSelected:"Not selected"},t=("ru"===o&&(t.notSelected="Не выбран"),n.add({Points:t.notSelected},"Points",{[t.notSelected]:-1}).onChange(function(e){var t=R.getSelectedIndex();null===t?I.axesHelper&&I.axesHelper.exposePosition():I.guiSelectPoint.select({object:B,index:t})}));return t.__select[0].selected=!0,i.controllerNameAndTitle(t,e),t}r=e("x"),a=e("y"),s=e("z")},this.appendChild=function(e){function t(e,t){e.domElement.querySelectorAll("select option").forEach(e=>{"-1"!=e.value&&e.remove()});for(var n=0;n<t;n++){var o=document.createElement("option");o.innerHTML=n,e.__select.appendChild(o)}e.setValue(-1)}t(r,e.xCount),t(a,e.yCount),t(s,e.zCount)},this.pointIndexes=function(e){void 0!==e&&(parseInt(r.getValue())!==e.x&&r.setValue(e.x),parseInt(a.getValue())!==e.y&&a.setValue(e.y),parseInt(s.getValue())!==e.z)&&s.setValue(e.z)},this.getSelectedIndex=function(){if(void 0===j)console.warn("Сюда попадает во время отладки когда не задаю имени каждой точки или когда the cDisplay checkbox of the frustumPoints is not checked");else{var e=parseInt(r.getValue()),t=parseInt(a.getValue()),n=parseInt(s.getValue());if(!(isNaN(e)||-1===e||isNaN(t)||-1===t||isNaN(n)||-1===n)){for(var o=0;o<j.length;o++){var i=j[o];if("object"==typeof i&&void 0!==i.z&&i.z===n)for(;o<j.length;o++)if("object"==typeof(i=j[o])&&i.y===t)for(;o<j.length;o++){if("object"==typeof(i=j[o])&&0===e&&i.y===t)return o;if(i===e)return o}}console.error("FrustumPoints.selectPoint: not selected")}}return null},this.display=function(e){r.domElement.parentElement.parentElement.style.display=e,a.domElement.parentElement.parentElement.style.display=e,s.domElement.parentElement.parentElement.style.display=e},this.isDisplay=function(){return r.domElement.parentElement.parentElement.style.display===a.domElement.parentElement.parentElement.style.display&&r.domElement.parentElement.parentElement.style.display===s.domElement.parentElement.parentElement.style.display||console.error("cFrustumPointsF.isDisplay failed!"),"none"!==r.domElement.parentElement.parentElement.style.display}},this.gui=function(){console.warn("FrustumPoints.gui(): First, call FrustumPoints.pushArrayCloud(...) for push a points to the clouds array and call FrustumPoints.create(...).")},this.animate=function(){},this.updateGuiSelectPoint=function(){},this.isDisplay=function(){},this.onChangeControls=function(){},this.updateCloudPoints=function(){},this.updateCloudPoint=function(){},this.updateCloudPointItem=function(){}}}else console.error("FrustumPoints: call options = new Options( options ) first")}}
/**
 * @module pointLight
 * @description A light that gets emitted from a single point in all directions.
 * @see [PointLight]{@link https://threejs.org/docs/index.html?q=pointLight#api/en/lights/PointLight}
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */class so{constructor(c,e={}){const u=new A(e.options);if(!1!==u.pointLight){const d=me.dat,p=me.THREE,f={},m=2*u.scale,h=e.position||new p.Vector3,g=new p.PointLight(16777215,1);return g.position.copy(h),g.name="mathBoxLight",c.add(g),this.controls=function(e={}){const t=e.group||c,n=e.folder||u.dat.gui,o=e.folderName;if(void 0!==n&&!1!==u.dat.pointLightGui){const a={light:"Light",displayLight:"Display",displayLightTitle:"Display or hide the light source.",defaultButton:"Default",restoreLightTitle:"Restore position of the light source"},s=("ru"===u.getLanguageCode()?(a.light="Свет",a.displayLight="Показать",a.displayLightTitle="Показать или скрыть источник света.",a.defaultButton="Восстановить",a.restoreLightTitle="Восстановить положение источника света"):void 0!==u.lang&&u.lang.languageCode==_languageCode&&Object.keys(u.lang).forEach(function(e){void 0!==a[e]&&(a[e]=u.lang[e])}),u.scales),l=n.addFolder(o||a.light);d.controllerNameAndTitle(l.add({display:!1},"display").onChange(function(e){e?new jn(g.position,t,{pointsOptions:{onReady(e){i=e}}}):(t.remove(i),i=void 0)}),a.displayLight,a.displayLightTitle),r("x"),r("y"),r("z");var i,e={restore:function(){f.x.setValue(h.x),f.y.setValue(h.y),f.z.setValue(h.z)}};function r(o){var e=s[o];e&&(f[o]=l.add(g.position,o,e.min*m,e.max*m).onChange(function(e){var t,n;void 0!==i&&(t=i.geometry.attributes.position.itemSize,(n=(new p.Vector3).fromArray(i.geometry.attributes.position.array,0*t))[o]=e,n.toArray(i.geometry.attributes.position.array,0*t),i.geometry.attributes.position.needsUpdate=!0)}),d.controllerNameAndTitle(f[o],e.name))}d.controllerNameAndTitle(l.add(e,"restore"),a.defaultButton,a.restoreLightTitle)}},this}this.add=function(){},this.controls=function(){}}}
/**
 * @module ProgressBar
 * @description Creates a [progress bar element]{@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/range} on your web page.
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
*/class lo{set value(e){this.setValue(e)}constructor(n,o,i={}){let r,e,a;if(n){a=document.createElement("div"),e=document.createElement("div"),r=document.createElement("input"),e.style.backgroundColor="white",e.style.margin="2px",e.style.padding="2px",a.innerHTML=i.sTitle||"",a.style.color="black",e.appendChild(a),void 0===i.min&&(i.min=0),r.min=i.min,r.max=null!=i.max?i.max:null!=i.iterationCount?i.iterationCount:1,r.type="range",r.disabled=!0,e.appendChild(r);let t;var s="ProgressContainer";for(let e=0;e<n.children.length;e++){var l=n.children[e];if(l.name&&l.name===s){t=l;break}}t||((t=document.createElement("table")).name=s,t.style.position="absolute",t.style.top=0,t.style.left=0,n.appendChild(t));var c=document.createElement("tr");c.appendChild(e),t.appendChild(c)}this.setValue=e=>{r&&(r.value=e)},void 0===i.timeoutPeriod&&(i.timeoutPeriod=0);let u=i.timeoutPeriod,d=null!=i.iterationCount?i.min:void 0;this.step=e=>{const t=()=>{o(this,d,e),void 0!==d&&(this.value=d,++d<i.iterationCount?this.step():this.remove())};u<i.timeoutPeriod?(u++,t()):(u=0,window.setTimeout(()=>{t()},0))},this.remove=()=>{e&&e.parentElement.remove()},this.step(),this.newStep=e=>{o=e},this.title=e=>{a.innerHTML=e}}}
/**
 * @module Intersections
 * @description Creates an intersection lines for graphic objects.
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * @see [How to detect collision in three.js?]{@link https://newbedev.com/how-to-detect-collision-in-three-js}
 * @see [Collision detection example]{@link http://stemkoski.github.io/Three.js/Collision-Detection.html}
 * @see [Three JS - Find all points where a mesh intersects a plane]{@link https://stackoverflow.com/questions/42348495/three-js-find-all-points-where-a-mesh-intersects-a-plane}
*/
/**
 * @module MyThree
 * @description I use MyThree in my projects for displaying of my 3D objects in the canvas.
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 */
void 0!==d&&(me.dat=d);const co=new function(){const o=[];this.push=function(e){o.push(e)},this.display=function(t,n){o.forEach(function(e){e.style.display=e!==t&&n?"none":"block"})},Object.defineProperties(this,{length:{get:function(){return o.length}}})};var uo=[];class z{constructor(r,a){a=a||{};const s=me.THREE;if(uo.push({createXDobjects:r,options:a}),!(1<uo.length)){var l,c,u,d,p,f,m,e,h,g,t,y=void 0===a.elContainer?document.getElementById("containerDSE"):"string"==typeof a.elContainer?document.getElementById(a.elContainer):a.elContainer;null===y&&("string"==typeof a.elContainer&&console.warn("The "+a.elContainer+" element was not detected."),y=document.createElement("div"),document.querySelector("body").appendChild(y)),co.push(y),y.querySelector("canvas")||(y.innerHTML="",(n=document.createElement("div")).className="container",n.appendChild(document.createElement("canvas")),y.appendChild(n),y=n),me.dat&&!1!==a.dat&&(a.dat=a.dat||{},a.dat.parent=y),a.title&&((n=document.createElement("div")).style.position="absolute",n.style.top="0px",n.style.color="white",n.style.padding="3px",n.innerHTML=a.title,y.appendChild(n)),(a=new A(a)).saveMeshDefault=function(e){e.userData.default=e.userData.default||{},e.userData.default.scale=new s.Vector3,e.userData.default.scale.copy(e.scale),e.userData.default.position=new s.Vector3,e.userData.default.position.copy(e.position),e.userData.default.rotation=new s.Euler,e.userData.default.rotation.copy(e.rotation)};const b={};new s.Vector2;(d=y.querySelector("canvas"))||(d=document.createElement("canvas"),y.appendChild(d));var n=y.querySelector("img"),n=(n&&y.removeChild(n),(d="undefined"!=typeof WebGLDebugUtils?WebGLDebugUtils.makeLostContextSimulatingCanvas(d):d).addEventListener("webglcontextlost",function(e){e.preventDefault(),void 0!==t?window.cancelAnimationFrame(t):console.error("myThreejs.create.onloadScripts: requestId = "+t),clearThree(u),m.onFullScreenToggle(!0),alert(L.webglcontextlost)},!1),d.addEventListener("webglcontextrestored",function(){console.warn("webglcontextrestored"),o(),i()},!1),o(),i(),this.setSize=function(e,t){"object"==typeof e&&(t=e.height,e=e.width),void 0===e?p.getSize({set:function(e,t){p.setSize(e,t)}}):p.setSize(e,t)},uo.shift(),uo.shift());function o(){(l=new s.PerspectiveCamera(a.camera.fov||70,a.camera.aspect||window.innerWidth/window.innerHeight,a.camera.near||.01,a.camera.far||10)).position.copy(a.camera.position),l.scale.copy(a.camera.scale),a.camera=l,a.point.sizePointsMaterial=100,a.cameraTarget&&(a.cameraTarget.camera=l,a.playerOptions.cameraTarget.init(a.cameraTarget,a)),(u=new s.Scene).background=new s.Color(0),u.fog=new s.Fog(0,250,1400),u.userData.optionsSpriteText={textHeight:.04},c=new s.Group,u.add(c);var e=new ao(l,c,d,{options:a}).gl;(p=new s.WebGLRenderer({antialias:!0,canvas:d,context:e})).setSize(window.innerWidth,window.innerHeight),a.renderer=p,a.cursor=p.domElement.style.cursor,!1!==a.stereoEffect&&(a.stereoEffect=a.stereoEffect||{},a.stereoEffect.rememberSize=!0),new T(p,a),a.eventListeners=new A.raycaster.EventListeners(l,p,{options:a,scene:u});var t,e=new so(u,{options:a,position:a.pointLight&&a.pointLight.pointLight1&&a.pointLight.pointLight1.position?a.pointLight.pointLight1.position:new s.Vector3(2*a.scale,2*a.scale,2*a.scale)}),n=new so(u,{options:a,position:a.pointLight&&a.pointLight.pointLight2&&a.pointLight.pointLight2.position?a.pointLight.pointLight2.position:new s.Vector3(-2*a.scale,-2*a.scale,-2*a.scale)});a.dat.gui&&("undefined"!=typeof WebGLDebugUtils&&a.dat.gui.add({loseContext:function(e){d.loseContext()}},"loseContext"),void 0!==a.dat.gui.__closeButton.click)&&a.dat.gui.__closeButton.click(),new ge(c,{onSelectScene:function(e,t){if(a.boPlayer=!0,void 0!==a.frustumPoints&&a.frustumPoints.updateCloudPoints(),void 0!==a.onSelectScene)return a.onSelectScene(e,t)},options:a,cameraTarget:{camera:l},onChangeScaleT:function(e){void 0!==a.player&&a.player.onChangeScale(e),c.children.forEach(function(e){void 0!==e.userData.player&&void 0!==e.userData.player.arrayFuncs&&"function"!=typeof e.userData.player.arrayFuncs&&e.userData.player.arrayFuncs.forEach(function(e){void 0!==e.line&&(e.line.remove(),e.line=new ge.traceLine(a))})})}}),a.player&&new a.player.PlayController,a.dat.gui&&(f=a.dat.gui.addFolder(L.settings),a.player)&&a.player.gui(f),f&&Yn(u,a,{folder:f,options:{textHeight:.05,fov:l.fov}}),a.stereoEffect&&a.stereoEffect.gui({folder:f,onChangeMode:function(e){switch(e){case T.spatialMultiplexsIndexs.Mono:break;case T.spatialMultiplexsIndexs.SbS:case T.spatialMultiplexsIndexs.TaB:break;default:return void console.error("myThreejs: Invalid spatialMultiplexIndex = "+e)}void 0!==a.frustumPoints&&a.frustumPoints.updateGuiSelectPoint()}}),p.domElement.style.position,p.domElement.style.left,p.domElement.style.top,p.domElement.style.width,p.domElement.style.height,t=new s.Vector2,p.getSize(t),m={onFullScreenToggle:function(e){co.display(y.parentElement,!e)}},p.setSize(void 0!==a.canvas&&void 0!==a.canvas.width?a.canvas.width:d.clientWidth,void 0!==a.canvas&&void 0!==a.canvas.height?a.canvas.height:d.clientHeight),new Un(p,{fullScreen:{fullScreen:a.canvas.fullScreen,camera:l,arrayContainersLength:function(){return co.length},onFullScreenToggle:function(e){function o(e,n){setTimeout(function(){!function t(e){e.forEach(function(e){t(e.children),e instanceof s.Group?o(e,n):void 0!==e.userData.player&&void 0!==e.userData.player.arrayFuncs&&"function"!=typeof e.userData.player.arrayFuncs&&e.userData.player.arrayFuncs.forEach(function(e){e.controllers&&e.controllers.w&&e.controllers.w.position&&e.controllers.w.position.elSlider&&(e.controllers.w.position.elSlider.style.display=n?"block":"none"),void 0!==e.line&&(e.line.remove(),e.line=new ge.traceLine(a))})})}(e.children)},0)}m.onFullScreenToggle(e),o(u,e)}},options:a}),a.createOrbitControls(l,p,u),f&&(new to(a,{cameraTarget:{camera:l,orbitControls:a.orbitControls},pointsControls:function(e,t,n){},pointControls:function(e,t,n){}}),a.guiSelectPoint)&&a.guiSelectPoint.add(),b.size=a.point.size;const o=a.dat?a.dat.getCookieName("Point"):"Point";if(a.dat&&a.dat.cookie.getObject(o,a.point,a.point),me.group=c,r&&r(c,a),new qn(u,a),a.frustumPoints&&a.frustumPoints.create(p),a.player||ge.selectPlayScene(c,{options:a}),a.boPlayer=!1,c.children.forEach(function(e){a.saveMeshDefault(e)}),a.dat.gui){Zn(a,f),new no(c,a,{folder:f}),!1!==a.orbitControls&&new Jn(a,f),new oo(l,a,f),e.controls({group:c,folder:f,folderName:L.light+" 1"}),n.controls({group:c,folder:f,folderName:L.light+" 2"});const i=new io(a.point,function(t){(t=void 0===t?a.point.size:t)<0&&(t=0),c.children.forEach(function(e){"Points"!==e.type||e.userData.boFrustumPoints||(void 0===e.material.uniforms?e.material.size=t/a.point.sizePointsMaterial:e.material.uniforms.pointSize.value=t)}),i.size.setValue(t),a.point.size=t,a.dat.cookie.setObject(o,a.point)},a,{folder:f,defaultPoint:b});a.frustumPoints&&a.frustumPoints.gui(f),a.restoreSceneController(l,u)}if(void 0!==a.stats)try{g=new Stats,y.appendChild(g.dom)}catch(e){console.error(e+". Please import Stats from '../../../three.js/dev/examples/jsm/libs/stats.module.js';")}window.addEventListener("resize",v,!1)}function v(){var e;(a.canvasMenu?a.canvasMenu.isFullScreen():!a.canvas||!1!==a.canvas.fullScreen)?e=new s.Vector2(window.innerWidth,window.innerHeight):(e=new s.Vector2,p.getSize(e)),l.aspect=e.x/e.y,l.updateProjectionMatrix(),p.setSize(e.x,e.y),void 0!==a.frustumPoints&&a.frustumPoints.update()}function i(){void 0!==g&&g.begin(),t=requestAnimationFrame(i),(a.stereoEffect&&a.stereoEffect.render?a.stereoEffect:p).render(u,l),void 0===e&&(e=new s.Vector3),void 0===h&&(h=a.point.size),(!e.equals(l.position)||h!=a.point.size||void 0!==a.frustumPoints&&a.frustumPoints.animate())&&(e.copy(l.position),h=a.point.size,c.children.forEach(function(e){if(e instanceof s.Points!=!1)if(void 0===e.geometry.attributes.size)e.material.size=h/a.point.sizePointsMaterial;else{void 0!==a.point.opacity&&(e.material.uniforms.opacity.value=a.point.opacity);for(var t=myPoints.getGlobalScale(e),n=new s.Vector3(l.position.x/t.x,l.position.y/t.y,l.position.z/t.z),t=(t.x+t.y+t.z)/3,o=0;o<e.geometry.attributes.position.count;o++){var i=ln(e,o),i=new s.Vector3(i.x,i.y,i.z).distanceTo(n);e.geometry.attributes.size.setX(o,Math.tan((void 0!==e.userData.shaderMaterial.point&&void 0!==e.userData.shaderMaterial.point.size?e.userData.shaderMaterial:a).point.size)*i*t*1),e.geometry.attributes.size.needsUpdate=!0}}})),void 0!==g&&g.end()}void 0!==n&&this.create(n.createXDobjects,n.options)}}}z.release="v1.3";const L={defaultButton:"Default",settings:"Settings",webglcontextlost:"The user agent has detected that the drawing buffer associated with a WebGLRenderingContext object has been lost.",light:"Light",opacity:"Opacity"};"ru"===An()&&(L.defaultButton="Восстановить",L.name="Имя",L.settings="Настройки",L.webglcontextlost="Пользовательский агент обнаружил, что буфер рисунка, связанный с объектом WebGLRenderingContext, потерян.",L.light="Свет",L.opacity="Непрозрачность"),z.MyPoints=jn,z.StereoEffect={spatialMultiplexsIndexs:T.spatialMultiplexsIndexs},z.ColorPicker=vn,z.getWorldPosition=sn,z.limitAngles=function(t){function e(e){for(;t[e]>2*Math.PI;)t[e]-=2*Math.PI}e("x"),e("y"),e("z")},z.Player=ge,z.three=me,z.Options=A,window.__myThree__=window.__myThree__||{},window.__myThree__.boMyThree&&console.error("myThree: duplicate myThree. Please use one instance of the myThree class."),window.__myThree__.boMyThree=!0,z.Intersections=class{constructor(S,e,o={}){const T=me.THREE,E=me.options||{},C=o.scene||me.group,c=(S=S instanceof T.Mesh==!1?S.mesh:S).geometry.attributes.position,A=(Array.isArray(e)||(e=[e]),[]),P=[];if(e.forEach(function(e){e instanceof T.Mesh?(A.push(e),P.push(16777215)):(A.push(e.mesh),P.push(e.color||16777215))}),!S.geometry.index){for(var t=[],n=0;n<c.count;n++)t.push(n);S.geometry.index=new T.Uint16BufferAttribute(t,1)}for(let t=1;t<S.geometry.index.count;t++){var i=(new T.Vector3).fromBufferAttribute(c,S.geometry.index.array[t]);for(let e=t-1;0<=e;e--){var r=(new T.Vector3).fromBufferAttribute(c,S.geometry.index.array[e]);function a(e,t){e=Math.abs(e-t);return 0===e?0:0<e&&e<=4e-15?1:4}if(a(r.x,i.x)+a(r.y,i.y)+a(r.z,i.z)<4){S.geometry.index.array[t]=S.geometry.index.array[e];break}}}const O=[],k=[],u=[];for(var s=0;s<S.geometry.index.count;s+=3){class y{constructor(e,t){function n(t){var n;return{get index(){t>=S.geometry.index.array.length&&(t=0);var e=S.geometry.index.array[t];return void 0===e&&console.error("Intersections.createIntersections.Edge.Vertex: i = "+e),e},get pointLocal(){return(3===c.itemSize||4===c.itemSize?new T.Vector3:void 0).fromBufferAttribute(c,this.index)},get point(){var e=this.pointLocal.applyMatrix4(S.matrix);return"undefined"==typeof SpriteText||n||(n=new SpriteText(this.index,this.pointLocal),S.add(n)),e}}}var o,i,r,a;const s=[],l=[];this.spliceIntersection=function(e,t){s.push({index:e,uuid:t}),l.length=0},Object.defineProperties(this,{intersection:{get:function(){var e,t;if(r||(e=this.vertex2.point.clone().sub(this.vertex1.point).clone().normalize(),e=new T.Raycaster(this.vertex1.point,e,0,this.vertex2.point.distanceTo(this.vertex1.point)),"undefined"!=typeof SpriteText&&(e.camera=E.camera),r=e.intersectObjects(A),this.faces)||console.error("edge "+this.vertex1.index+" "+this.vertex2.index+" intersects "+r.length),this.intersectionObject){if(0===l.length){const a=this.intersectionObject;r.forEach(function(e,t){if(e.object.uuid===a.uuid){for(var n=l,o=e.point,i=0;i<n.length;i++){var r=n[i].point;if(o.x===r.x&&o.y===r.y&&o.z===r.z)return}n.push(e)}}),1<s.length&&console.error("under construction");for(var n=0;n<s.length;n++)s[n].uuid===a.uuid&&l.splice(s[n].index,1)}t=l}else t=r;return t},set:function(e){this.vertex1.update=void 0,this.vertex2.update=void 0,r=e}},intersectionObject:{get:function(){return a},set:function(e){a=e,s.length=0,l.length=0}},vertex1:{get:function(){return o=o||n(e)}},vertex2:{get:function(){return i=i||n(t)}}}),this.isCollision=function(){return 0<r.length},this.isSame=function(e){e=this.vertex1.index===e.vertex1.index&&this.vertex2.index===e.vertex2.index||this.vertex1.index===e.vertex2.index&&this.vertex2.index===e.vertex1.index;return e=void 0===e?!1:e}}}var l=new y(s,s+1);u.push(l),l=new y(s+1,s+2),u.push(l),l=new y(s,s+2),u.push(l)}const d=[];e=E.renderer||o.renderer;let p;if(e){e=e.domElement.parentElement;if("DIV"!==e.tagName)return void console.error("Intersections: elContainer.tagName = "+e.tagName);e.classList.contains("container")||e.classList.add("container");var f={progressTitle:"Intersections preparing.<br>Wait please..."};"ru"===E.getLanguageCode()&&(f.progressTitle="Подготовка пересечений.<br>Пожалуйста подождите..."),p=new lo(e,function(e){p&&(p.value=s);if(s>=S.geometry.index.count)p.remove(),m=!0,setTimeout(function(){h()},0);else d.push(new class{constructor(e){const t=new T.Vector3,h=[];function n(){return{intersection:[],isSame:function(){return!0}}}t.fromBufferAttribute(S.geometry.index,e),Object.defineProperties(this,{faceEdges:{get:function(){return g}},id:{get:function(){return t}},name:{get:function(){return"Face "+t.x+", "+t.y+", "+t.z}},vertices:{get:function(){return{vertex1:g.edge1.vertex1,vertex2:g.edge1.vertex2,get vertex3(){return g.edge3?g.edge1.vertex1.index!==g.edge3.vertex1.index&&g.edge1.vertex2.index!==g.edge3.vertex1.index?g.edge3.vertex1:g.edge3.vertex2:(console.error("faceEdges.edge3 = "+g.edge3),g.edge1.vertex1.index===g.edge2.vertex1.index?g.edge2.vertex2:g.edge1.vertex1.index===g.edge2.vertex2.index?g.edge2.vertex1:g.edge1.vertex2.index===g.edge2.vertex1.index?g.edge2.vertex2:g.edge1.vertex2.index===g.edge2.vertex2.index?g.edge2.vertex1:void 0)}}}}});const o={},g={set edge1(e){o.edge1=e},get edge1(){return o.edge1||n()},set edge2(e){o.edge2=e},get edge2(){return o.edge2||n()},set edge3(e){o.edge3=e},get edge3(){return o.edge3||n()},get intersectionObjects(){const o=[];function e(e){e.forEach(function(e){for(var t=!1,n=0;n<o.length;n++)if(e.object.uuid===o[n].uuid){t=!0;break}t||o.push(e.object)})}return e(g.edge1.intersection),e(g.edge2.intersection),e(g.edge3.intersection),o},set intersectionObject(e){g.edge1.intersectionObject=e,g.edge2.intersectionObject=e,g.edge3.intersectionObject=e},get intersectionObject(){return g.edge1.intersectionObject}};for(var i=u.length-1;0<=i;i--){const a=u[i],s=a.vertex1.index,l=a.vertex2.index;function r(e){a.faces||(a.faces={}),a.faces.face1?a.faces.face2?console.error("Face: too many edge.faces"):a.faces.face2=e:a.faces.face1=e}t.x===s&&t.y===l||t.x===l&&t.y===s?g.edge1.isSame(a)?(g.edge1=a,r(this)):console.error("Face: duplicate faceEdges.edge1"):t.z===s&&t.y===l||t.z===l&&t.y===s?g.edge2.isSame(a)?(g.edge2=a,r(this)):console.error("Face: duplicate faceEdges.edge2"):(t.z===s&&t.x===l||t.z===l&&t.x===s)&&(g.edge3.isSame(a)?(g.edge3=a,r(this)):console.error("Face: duplicate faceEdges.edge3"))}this.isCollision=function(){return g.edge1.intersection.length||g.edge2.intersection.length||g.edge3.intersection.length},this.nextIntersectPoint=function(e){for(var t=0;t<h.length;t++){function n(e){return h.splice(t,1),e}var o=h[t],i=e.uuid;if(e.edge.isSame(o.point1.edge)&&e.intersectionIndex===o.point1.intersectionIndex&&i===o.point1.uuid)return n(o.point2);if(e.edge.isSame(o.point2.edge)&&e.intersectionIndex===o.point2.intersectionIndex&&i===o.point2.uuid)return n(o.point1)}},this.intersectLines=function(){return h},this.intersections=function(){for(var e=g.intersectionObjects,t=0;t<e.length;t++)if(g.intersectionObject=e[t],this.isCollision()){for(var n=g.edge1.intersection.length-1;0<=n;n--)for(var o=g.edge2.intersection.length-1;0<=o;o--){g.edge1.intersection.length>n&&g.edge2.intersection.length>o&&z(g.edge1.intersection[n].point,g.edge2.intersection[o].point)&&g.edge2.spliceIntersection(o,g.intersectionObject.uuid);for(var i=g.edge3.intersection.length-1;0<=i;i--)g.edge1.intersection.length>n&&g.edge3.intersection.length>i&&z(g.edge1.intersection[n].point,g.edge3.intersection[i].point)&&g.edge3.spliceIntersection(i,g.intersectionObject.uuid),g.edge2.intersection.length>o&&g.edge3.intersection.length>i&&z(g.edge2.intersection[o].point,g.edge3.intersection[i].point)&&g.edge3.spliceIntersection(i,g.intersectionObject.uuid)}const m=[];for(n=0;n<g.edge1.intersection.length;n++)f(g.edge1,n);switch(g.edge1.vertex2.index){case g.edge2.vertex1.index:for(var r=g.edge3,n=0;n<g.edge2.intersection.length;n++)f(g.edge2,n);d(g.edge2.vertex2.index);break;case g.edge2.vertex2.index:r=g.edge3;for(n=g.edge2.intersection.length-1;0<=n;n--)f(g.edge2,n);d(g.edge2.vertex1.index);break;case g.edge3.vertex1.index:r=g.edge2;for(n=0;n<g.edge3.intersection.length;n++)f(g.edge3,n);p(g.edge3.vertex2.index);break;case g.edge3.vertex2.index:r=g.edge2;for(n=g.edge3.intersection.length-1;0<=n;n--)f(g.edge3,n);p(g.edge3.vertex1.index);break;default:console.error("Face.intersections: arrayIntersections push failed!")}var a=m.length;if(!(a%2)){let e;for(n=0;n<k.length;n++)if(k[n].mesh.uuid===g.intersectionObject.uuid){e=k[n];break}if(e||((e=[]).mesh=g.intersectionObject,k.push(e)),e.push(this),2===a)c(m[0],m[1]);else if(g.edge1.intersection.length%2&&r.intersection.length%2)for(n=0;n<a;n+=2)c(m[n],m[n+1]);else{var s=!1;function l(e,t){return e.a===t.a&&e.b===t.b&&e.c===t.c}if(6===a&&(l(m[0].intersection.face,m[5].intersection.face)&&l(m[1].intersection.face,m[2].intersection.face)&&l(m[3].intersection.face,m[4].intersection.face)?(c(m[0],m[5]),c(m[1],m[2]),c(m[3],m[4]),s=!0):l(m[0].intersection.face,m[1].intersection.face)&&l(m[2].intersection.face,m[3].intersection.face)&&l(m[4].intersection.face,m[5].intersection.face)&&(console.error("under constraction"),c(m[0],m[1]),c(m[2],m[3]),c(m[4],m[5]),s=!0)),!s)for(n=0;n<a/2;n++)c(m[n],m[a-1-n])}function c(e,t){h.push({point1:e,point2:t})}}function u(e,t){switch(e){case t.vertex1.index:for(var n=0;n<t.intersection.length;n++)f(t,n);break;case t.vertex2.index:for(n=t.intersection.length-1;0<=n;n--)f(t,n);break;default:console.error("Face.intersections: arrayIntersections push failed!")}}function d(e){u(e,g.edge3)}function p(e){u(e,g.edge2)}function f(e,t){const n=e.intersection[t];m.push({get edge(){return e},get intersectionIndex(){return t},get uuid(){return n.object.uuid},get faces(){return e.faces},get point(){return n.point},get intersection(){return n}})}}g.intersectionObject=void 0}}}(s,d.length)),s+=3,p.step()},{sTitle:f.progressTitle,max:S.geometry.index.count})}function z(e,t){return e.distanceTo(t)<=9e-10}var s=0,m=!1;function h(){if(m){k.length=0;for(var e=O.length-1;0<=e;e--){function t(e){e instanceof T.Object3D&&(e.geometry.dispose(),e.material instanceof Array?e.material.forEach(e=>e.dispose()):e.material.dispose(),e.removeFromParent())}var n=O[e];n.intersectLine&&(t(n.intersectLine),E.guiSelectPoint&&E.guiSelectPoint.removeMesh(n.intersectLine),n.intersectLine=null),n.intersectPoints&&(t(n.intersectPoints),E.guiSelectPoint&&E.guiSelectPoint.removeMesh(n.intersectPoints),n.intersectPoints=null),O.pop()}u.forEach(function(e){e.intersection=void 0,e.intersection}),d.forEach(function(e){e.intersections()}),k.forEach(function(w){w.forEach(function(e){for(var t=e.intersectLines(),n=t.length-1;0<=n;n--){var o=t[n];if(o&&w.mesh.uuid===o.point1.uuid){t.splice(n,1);for(var i=[o.point1.point],r=o.point2,a=e,s=!0;;){s?z(i[i.length-1],r.point)||i.push(r.point):z(i[0],r.point)||i.unshift(r.point);var l=r.faces;if(a.id.equals(l.face1.id)?a=l.face2:a.id.equals(l.face2.id)?a=l.face1:console.error("Intersections.createIntersections: get twin face failed"),!a)break;var c=r;if(!(r=a.nextIntersectPoint(r))){var u=z(c.point,c.edge.vertex1.point)?c.edge.vertex1.index:z(c.point,c.edge.vertex2.point)?c.edge.vertex2.index:void 0,a=void 0;if(u)for(var d=0;d<k.length;d++)if(c.uuid===k[d].mesh.uuid){for(var p=0;p<k[d].length;p++){const e=k[d][p];if(e.faceEdges.edge1.vertex1.index===u||e.faceEdges.edge1.vertex2.index===u||e.faceEdges.edge2.vertex1.index===u||e.faceEdges.edge2.vertex2.index===u||e.faceEdges.edge3.vertex1.index===u||e.faceEdges.edge3.vertex2.index===u){for(var f=e.intersectLines(),m=0;m<f.length;m++){var h=f[m];if(z(c.point,h.point1.point)?r=h.point1:z(c.point,h.point2.point)&&(r=h.point2),r){r=(a=e).nextIntersectPoint(r);break}}if(a)break}}if(a)break}if(!a){const _=(c=o.point1).faces.face1.intersectLines(),e=_.length?c.faces.face1:c.faces.face2,x=e.intersectLines();for(var g=0;g<x.length;g++){var y=x[g];if(y.point1.uuid===c.uuid&&y.point1.edge.isSame(c.edge)&&y.point1.intersectionIndex===c.intersectionIndex?r=y.point1:y.point2.uuid===c.uuid&&y.point2.edge.isSame(c.edge)&&y.point2.intersectionIndex===c.intersectionIndex&&(r=y.point2),r){r=(a=e).nextIntersectPoint(r),s=!1;break}}if(!a)break}}}if(1<i.length){for(var v=16777215,n=0;n<A.length;n++)if(A[n].uuid===w.mesh.uuid){v=P[n];break}var b={intersectLine:new T.Line((new T.BufferGeometry).setFromPoints(i),new T.LineBasicMaterial({color:v})),mesh:w.mesh,color:v,points:i};O.push(b),C.add(b.intersectLine),E.guiSelectPoint&&(b.intersectLine.name=(""===b.mesh.name?O.length:b.mesh.name)+"-"+(""===S.name?"intersection":S.name),E.guiSelectPoint.addMesh(b.intersectLine))}}}})}),o.onReady&&o.onReady(O)}}const g=[S];A.forEach(function(e){g.push(e)}),g.forEach(function(e){e.userData.position=e.position.clone(),e.userData.rotation=e.rotation.clone(),e.userData.scale=e.scale.clone()}),window.requestAnimationFrame(function e(){for(var t=0;t<g.length;t++){var n=g[t];if(!n.userData.position.equals(n.position)||!n.userData.rotation.equals(n.rotation)||!n.userData.scale.equals(n.scale)){n.userData.position=n.position.clone(),n.userData.rotation=n.rotation.clone(),n.userData.scale=n.scale.clone(),h();break}}window.requestAnimationFrame(e)})}}
/**
 * @module TreeView
 * @description Tree view with CSS and JavaScript. Thanks to [Learn how to create a tree view with CSS and JavaScript.]{@link https://www.w3schools.com/howto/howto_js_treeview.asp}
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */,z.TreeView=class{constructor(t={}){const n=document.getElementsByClassName("caret");for(var o=1,i=0;i<n.length;i++){var r,a=n[i].parentElement.querySelector(".nested"),s=a.classList.contains("hide");void 0!==t.animate&&(a.style.display=s?"none":"block",a.classList.add("b-toggle")),void 0!==t.paddingInlineStart&&(a.style.paddingInlineStart=t.paddingInlineStart);let e=t.open||!1;if(t.cookie)switch(""===a.id&&(r="branch_"+o,o++,document.getElementById(r)?console.error("duplicate branch id: "+r):a.id=r),Cn.get("TreeView_"+a.id)){case"false":e=!1;break;case"true":e=!0;break;case"":break;default:console.error("TreeView: Invalid cookie value")}void 0!==e&&e===s&&(a.classList.toggle("hide"),a.classList.toggle("active"),a.style.display=s?"block":"none"),a.classList.contains("hide")||(r=a.parentElement.querySelector(".caret").classList).contains("caret-down")||r.toggle("caret-down"),n[i].addEventListener("click",function(){const e=this.parentElement.querySelector(".nested");e.classList.contains("hide")?(e.style.display="block",e.boTimeout=!1):(e.boTimeout=!0,setTimeout(function(){e.boTimeout&&(e.style.display="none")},1e3)),e.classList.toggle("hide"),e.classList.toggle("active"),e.style.maxHeight=this.parentElement.querySelector(".active")?e.offsetHeight+"px":"",this.classList.toggle("caret-down"),t.cookie&&Cn.set("TreeView_"+e.id,!e.classList.contains("hide")),e.myThree&&e.myThree.setSize()})}this.setCanvas=function(e,t,n={}){n.size=n.size||{},void 0===n.size.width&&(n.size.width=300),void 0===n.size.height&&(n.size.height=150),t.setSize(n.size),document.getElementById(e).myThree=t}}};
/**
* @module Matrix
* @description A matrix (plural matrices) is a rectangular array or table of numbers, arranged in rows and columns, which is used to represent a mathematical object or a property of such an object.
* @see [Matrix (mathematics)]{@link https://en.wikipedia.org/wiki/Matrix_(mathematics)}
* @author [Andrej Hristoliubov]{@link https://github.com/anhr}
*
* @copyright 2011 Data Arts Team, Google Creative Lab
*
* @license under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* */
new Proxy([],{get:function(e,t,n){var o=parseInt(t);return isNaN(o)?"multiply"===t?function(e){return[]}:void console.error("Matrix: Invalid name: "+t):[e[o]]},set:function(e,t,n){return e[t]=n,!0}}),
/**
 * @module MyMath
 * @description Math library.
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
*/
/**
 * @module ND
 * @description N-dimensional graphics
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * @see [4D Geometry Viewer]{@link https://github.com/anhr/humke-4d-geometry}
 * @see [Tesseract]{@link https://ciechanow.ski/tesseract/}
 * @see [4D-Shapes]{@link https://artemonigiri.github.io/4D-Shapes/}
 * @see [The Regular Polychora]{@link https://www.qfbox.info/4d/regular}
*/
Number.prototype.between||(Number.prototype.between=function(e,t,n){var o=Math.min.apply(Math,[e,t]),e=Math.max.apply(Math,[e,t]);return n?o<=this&&this<=e:o<this&&this<e}),Array.prototype.equals&&console.warn("Overriding existing Array.prototype.equals. Possible causes: New API defines the method, there's a framework conflict or you've got double inclusions in your code."),Array.prototype.equals=function(e){if(!e)return!1;if(this.length!=e.length)return!1;for(var t=0,n=this.length;t<n;t++)if(this[t]instanceof Array&&e[t]instanceof Array){if(!this[t].equals(e[t]))return!1}else if(this[t]!=e[t])return!1;return!0},Object.defineProperty(Array.prototype,"equals",{enumerable:!1}),Math.PI;Object.freeze({Random:0,NearestVertice:1}),
/**
 * @module Universe
 * @description Base class for n dimensional hypersphere universe.
 *
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
*/
z.three.THREE=THREE;N.default=
/**
 * @module ND
 * @description N-dimensional graphics
 * @author [Andrej Hristoliubov]{@link https://github.com/anhr}
 *
 * @copyright 2011 Data Arts Team, Google Creative Lab
 *
 * @license under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
*/
class{constructor(){}},Object.defineProperty(N,"__esModule",{value:!0})});
